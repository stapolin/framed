{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"server/encryption.ts":{"content":"import crypto from \"crypto\";\n\nconst ALGORITHM = \"aes-256-gcm\";\nconst IV_LENGTH = 16;\nconst AUTH_TAG_LENGTH = 16;\n\nfunction getEncryptionKey(): Buffer {\n  const secret = process.env.SESSION_SECRET;\n  if (!secret) {\n    throw new Error(\"SESSION_SECRET environment variable is required for encryption\");\n  }\n  return crypto.scryptSync(secret, \"woocommerce-credentials-salt\", 32);\n}\n\nexport function encrypt(text: string): string {\n  const key = getEncryptionKey();\n  const iv = crypto.randomBytes(IV_LENGTH);\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n  \n  let encrypted = cipher.update(text, \"utf8\", \"hex\");\n  encrypted += cipher.final(\"hex\");\n  \n  const authTag = cipher.getAuthTag();\n  \n  return iv.toString(\"hex\") + \":\" + authTag.toString(\"hex\") + \":\" + encrypted;\n}\n\nexport function decrypt(encryptedText: string): string {\n  const key = getEncryptionKey();\n  const parts = encryptedText.split(\":\");\n  \n  if (parts.length !== 3) {\n    throw new Error(\"Invalid encrypted text format\");\n  }\n  \n  const iv = Buffer.from(parts[0], \"hex\");\n  const authTag = Buffer.from(parts[1], \"hex\");\n  const encrypted = parts[2];\n  \n  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n  decipher.setAuthTag(authTag);\n  \n  let decrypted = decipher.update(encrypted, \"hex\", \"utf8\");\n  decrypted += decipher.final(\"utf8\");\n  \n  return decrypted;\n}\n","path":null,"size_bytes":1359,"size_tokens":null},"client/src/pages/stock-ledger.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useCredentials } from \"@/contexts/credentials-context\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ArrowLeft, History, Package, TrendingDown, TrendingUp } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { format } from \"date-fns\";\nimport type { StockLedgerEntry, LocalRawMaterialWithVariations } from \"@shared/schema\";\nimport { Link } from \"wouter\";\n\nexport default function StockLedger() {\n  const { hasCredentials } = useCredentials();\n  const [materialFilter, setMaterialFilter] = useState<string>(\"all\");\n\n  const { data: rawMaterials, isLoading: materialsLoading } = useQuery<LocalRawMaterialWithVariations[]>({\n    queryKey: [\"/api/local-materials\"],\n  });\n\n  const { data: ledgerEntries, isLoading: ledgerLoading } = useQuery<StockLedgerEntry[]>({\n    queryKey: [\"/api/stock-ledger\", materialFilter],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (materialFilter !== \"all\") {\n        params.append(\"materialProductId\", materialFilter);\n      }\n      params.append(\"limit\", \"200\");\n      const response = await fetch(`/api/stock-ledger?${params}`);\n      if (!response.ok) throw new Error(\"Failed to fetch stock ledger\");\n      return response.json();\n    },\n  });\n\n  const getMaterialName = (materialId: number) => {\n    return rawMaterials?.find((m) => m.id === materialId)?.name || `Material #${materialId}`;\n  };\n\n  const getReasonBadge = (reason: string) => {\n    switch (reason) {\n      case \"order\":\n        return <Badge variant=\"destructive\">Order</Badge>;\n      case \"adjustment\":\n        return <Badge variant=\"outline\">Adjustment</Badge>;\n      case \"restock\":\n        return <Badge className=\"bg-green-600 hover:bg-green-700\">Restock</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{reason}</Badge>;\n    }\n  };\n\n  if (!hasCredentials) {\n    return (\n      <main className=\"container mx-auto px-6 py-8\">\n        <div className=\"flex flex-col gap-6\">\n          <div className=\"flex items-center gap-4\">\n            <Link href=\"/inventory\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n            </Link>\n            <div>\n              <h1 className=\"text-3xl font-bold\" data-testid=\"text-ledger-title\">\n                Stock Ledger\n              </h1>\n              <p className=\"text-muted-foreground\">\n                Track all inventory changes and order deductions\n              </p>\n            </div>\n          </div>\n          <Card>\n            <CardHeader>\n              <CardTitle>Configure WooCommerce</CardTitle>\n              <CardDescription>\n                Please configure your WooCommerce credentials in Settings to view the stock ledger.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Link href=\"/settings\">\n                <Button data-testid=\"button-go-to-settings\">Go to Settings</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"container mx-auto px-6 py-8\">\n      <div className=\"flex flex-col gap-6\">\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Link href=\"/inventory\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n            </Link>\n            <div>\n              <h1 className=\"text-3xl font-bold\" data-testid=\"text-ledger-title\">\n                Stock Ledger\n              </h1>\n              <p className=\"text-muted-foreground\">\n                Track all inventory changes and order deductions\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader className=\"pb-4\">\n            <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <History className=\"h-5 w-5 text-muted-foreground\" />\n                <CardTitle className=\"text-lg\">Transaction History</CardTitle>\n              </div>\n              <Select value={materialFilter} onValueChange={setMaterialFilter}>\n                <SelectTrigger className=\"w-full sm:w-[250px]\" data-testid=\"select-material-filter\">\n                  <SelectValue placeholder=\"Filter by material\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Materials</SelectItem>\n                  {rawMaterials?.map((material) => (\n                    <SelectItem key={material.id} value={material.id.toString()}>\n                      {material.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {ledgerLoading || materialsLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(5)].map((_, i) => (\n                  <Skeleton key={i} className=\"h-12 w-full\" />\n                ))}\n              </div>\n            ) : ledgerEntries && ledgerEntries.length > 0 ? (\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Date</TableHead>\n                      <TableHead>Material</TableHead>\n                      <TableHead>Reason</TableHead>\n                      <TableHead>Order</TableHead>\n                      <TableHead className=\"text-right\">Change</TableHead>\n                      <TableHead className=\"text-right\">Previous</TableHead>\n                      <TableHead className=\"text-right\">New</TableHead>\n                      <TableHead>Notes</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {ledgerEntries.map((entry) => (\n                      <TableRow key={entry.id} data-testid={`row-ledger-${entry.id}`}>\n                        <TableCell className=\"whitespace-nowrap\">\n                          {format(new Date(entry.createdAt), \"MMM d, yyyy HH:mm\")}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Package className=\"h-4 w-4 text-muted-foreground\" />\n                            <span className=\"font-medium\">\n                              {getMaterialName(entry.materialProductId)}\n                            </span>\n                          </div>\n                        </TableCell>\n                        <TableCell>{getReasonBadge(entry.reason)}</TableCell>\n                        <TableCell>\n                          {entry.orderNumber ? (\n                            <span className=\"font-mono text-sm\">#{entry.orderNumber}</span>\n                          ) : (\n                            <span className=\"text-muted-foreground\">-</span>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex items-center justify-end gap-1\">\n                            {entry.quantityChange < 0 ? (\n                              <TrendingDown className=\"h-4 w-4 text-destructive\" />\n                            ) : (\n                              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n                            )}\n                            <span\n                              className={\n                                entry.quantityChange < 0\n                                  ? \"text-destructive font-medium\"\n                                  : \"text-green-600 font-medium\"\n                              }\n                            >\n                              {entry.quantityChange > 0 ? \"+\" : \"\"}\n                              {entry.quantityChange}\n                            </span>\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"text-right text-muted-foreground\">\n                          {entry.previousStock}\n                        </TableCell>\n                        <TableCell className=\"text-right font-medium\">{entry.newStock}</TableCell>\n                        <TableCell className=\"max-w-[200px] truncate text-muted-foreground\">\n                          {entry.notes || \"-\"}\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            ) : (\n              <div className=\"flex flex-col items-center justify-center py-12\">\n                <History className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-medium mb-2\">No Transactions Yet</h3>\n                <p className=\"text-muted-foreground text-center max-w-md\">\n                  Stock changes will appear here when orders are processed or manual adjustments are\n                  made.\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </main>\n  );\n}\n","path":null,"size_bytes":9816,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\n\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const [baseUrl, paramsObj] = queryKey;\n    let url = baseUrl as string;\n    \n    if (paramsObj && typeof paramsObj === \"object\") {\n      const searchParams = new URLSearchParams();\n      Object.entries(paramsObj).forEach(([key, value]) => {\n        if (value !== undefined && value !== null && value !== \"\") {\n          searchParams.append(key, String(value));\n        }\n      });\n      const paramString = searchParams.toString();\n      if (paramString) {\n        url = `${url}?${paramString}`;\n      }\n    }\n    \n    const res = await fetch(url, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1878,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"shared/schema.ts":{"content":"import { z } from \"zod\";\nimport { pgTable, serial, integer, varchar, timestamp, text, boolean, numeric, pgEnum, uniqueIndex } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { relations } from \"drizzle-orm\";\n\n// Database Tables\n\n// Users table for authentication\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: varchar(\"username\", { length: 255 }).notNull().unique(),\n  password: text(\"password\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// WooCommerce API credentials (encrypted at rest)\nexport const wooCommerceCredentials = pgTable(\"woocommerce_credentials\", {\n  id: serial(\"id\").primaryKey(),\n  storeUrl: varchar(\"store_url\", { length: 500 }).notNull(),\n  consumerKey: text(\"consumer_key\").notNull(), // Encrypted\n  consumerSecret: text(\"consumer_secret\").notNull(), // Encrypted\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertWooCommerceCredentialsSchema = createInsertSchema(wooCommerceCredentials).omit({\n  id: true,\n  updatedAt: true,\n  createdAt: true,\n});\n\nexport type InsertWooCommerceCredentials = z.infer<typeof insertWooCommerceCredentialsSchema>;\nexport type WooCommerceCredentials = typeof wooCommerceCredentials.$inferSelect;\n\n// Maps product variations to raw materials they consume\nexport const materialProductMappings = pgTable(\"material_product_mappings\", {\n  id: serial(\"id\").primaryKey(),\n  productId: integer(\"product_id\").notNull(), // WooCommerce product ID (parent product being sold)\n  variationId: integer(\"variation_id\"), // WooCommerce variation ID of product being sold (null if simple)\n  materialProductId: integer(\"material_product_id\").notNull(), // Raw material product ID in WooCommerce\n  materialVariationId: integer(\"material_variation_id\"), // Raw material variation ID (null if simple material)\n  quantityUsed: integer(\"quantity_used\").notNull().default(1), // How many of this material per product\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => ({\n  // Prevent duplicate mappings for the same material-product combination\n  uniqueMapping: uniqueIndex(\"unique_material_product_mapping\").on(\n    table.materialProductId,\n    table.materialVariationId,\n    table.productId,\n    table.variationId\n  ),\n}));\n\nexport const insertMaterialProductMappingSchema = createInsertSchema(materialProductMappings).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertMaterialProductMapping = z.infer<typeof insertMaterialProductMappingSchema>;\nexport type MaterialProductMapping = typeof materialProductMappings.$inferSelect;\n\n// Stock ledger for tracking all inventory changes\nexport const stockLedger = pgTable(\"stock_ledger\", {\n  id: serial(\"id\").primaryKey(),\n  materialProductId: integer(\"material_product_id\").notNull(), // Raw material product ID (parent for variations)\n  materialVariationId: integer(\"material_variation_id\"), // Variation ID (null for simple products)\n  orderId: integer(\"order_id\"), // WooCommerce order ID (null for manual adjustments)\n  orderNumber: varchar(\"order_number\", { length: 50 }), // Order number for display\n  quantityChange: integer(\"quantity_change\").notNull(), // Positive for restocks, negative for usage\n  previousStock: integer(\"previous_stock\"), // Stock level before change\n  newStock: integer(\"new_stock\"), // Stock level after change\n  reason: varchar(\"reason\", { length: 255 }).notNull(), // \"order\", \"refund\", \"manual\", \"reconciliation\"\n  notes: text(\"notes\"), // Additional notes\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertStockLedgerSchema = createInsertSchema(stockLedger).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertStockLedger = z.infer<typeof insertStockLedgerSchema>;\nexport type StockLedgerEntry = typeof stockLedger.$inferSelect;\n\n// Tracks which orders have had their inventory processed\nexport const processedOrders = pgTable(\"processed_orders\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().unique(),\n  orderNumber: varchar(\"order_number\", { length: 50 }),\n  processedAt: timestamp(\"processed_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertProcessedOrderSchema = createInsertSchema(processedOrders).omit({\n  id: true,\n  processedAt: true,\n  createdAt: true,\n});\n\nexport type InsertProcessedOrder = z.infer<typeof insertProcessedOrderSchema>;\nexport type ProcessedOrder = typeof processedOrders.$inferSelect;\n\n// Zod Schemas for WooCommerce API responses\n\nexport const orderSchema = z.object({\n  id: z.number(),\n  number: z.string(),\n  status: z.string(),\n  currency: z.string(),\n  total: z.string(),\n  total_tax: z.string(),\n  shipping_total: z.string().optional(),\n  discount_total: z.string().optional(),\n  date_created: z.string(),\n  date_modified: z.string(),\n  payment_method_title: z.string().optional(),\n  billing: z.object({\n    first_name: z.string(),\n    last_name: z.string(),\n    email: z.string(),\n    phone: z.string().optional(),\n    address_1: z.string().optional(),\n    address_2: z.string().optional(),\n    city: z.string().optional(),\n    state: z.string().optional(),\n    postcode: z.string().optional(),\n    country: z.string().optional(),\n  }),\n  shipping: z.object({\n    first_name: z.string().optional(),\n    last_name: z.string().optional(),\n    address_1: z.string().optional(),\n    address_2: z.string().optional(),\n    city: z.string().optional(),\n    state: z.string().optional(),\n    postcode: z.string().optional(),\n    country: z.string().optional(),\n  }).optional(),\n  line_items: z.array(z.object({\n    id: z.number(),\n    name: z.string(),\n    product_id: z.number(),\n    variation_id: z.number().optional(),\n    quantity: z.number(),\n    total: z.string(),\n    subtotal: z.string().optional(),\n    price: z.number().optional(),\n    sku: z.string().optional(),\n    meta_data: z.array(z.object({\n      id: z.number(),\n      key: z.string(),\n      value: z.any(),\n      display_key: z.string().optional(),\n      display_value: z.string().optional(),\n    })).optional(),\n  })),\n  shipping_lines: z.array(z.object({\n    id: z.number(),\n    method_title: z.string(),\n    total: z.string(),\n  })).optional(),\n  meta_data: z.array(z.object({\n    id: z.number(),\n    key: z.string(),\n    value: z.any(),\n  })).optional(),\n});\n\nexport type Order = z.infer<typeof orderSchema>;\n\nexport const orderStatusSchema = z.object({\n  slug: z.string(),\n  name: z.string(),\n  total: z.number(),\n});\n\nexport type OrderStatus = z.infer<typeof orderStatusSchema>;\n\nexport const dashboardMetricsSchema = z.object({\n  totalRevenue: z.number(),\n  totalOrders: z.number(),\n  averageOrderValue: z.number(),\n  ordersByStatus: z.record(z.string(), z.number()),\n});\n\nexport type DashboardMetrics = z.infer<typeof dashboardMetricsSchema>;\n\nexport const orderTrendSchema = z.object({\n  date: z.string(),\n  orders: z.number(),\n  revenue: z.number(),\n});\n\nexport type OrderTrend = z.infer<typeof orderTrendSchema>;\n\nexport const wooCommerceConfigSchema = z.object({\n  storeUrl: z.string().url(\"Please enter a valid URL\"),\n  consumerKey: z.string().min(1, \"Consumer Key is required\"),\n  consumerSecret: z.string().min(1, \"Consumer Secret is required\"),\n});\n\nexport type WooCommerceConfig = z.infer<typeof wooCommerceConfigSchema>;\n\nexport const dateRangePresets = [\n  \"today\",\n  \"last7days\",\n  \"last30days\",\n  \"last90days\",\n  \"custom\"\n] as const;\n\nexport type DateRangePreset = typeof dateRangePresets[number];\n\n// Raw Material Variation schema (for variable products)\nexport const rawMaterialVariationSchema = z.object({\n  id: z.number(),\n  parentId: z.number(),\n  name: z.string(), // Generated from attributes (e.g., \"Black\", \"White - Large\")\n  sku: z.string().optional(),\n  stock_quantity: z.number().nullable(),\n  stock_status: z.string(),\n  manage_stock: z.boolean(),\n  attributes: z.array(z.object({\n    id: z.number(),\n    name: z.string(),\n    option: z.string(),\n  })),\n});\n\nexport type RawMaterialVariation = z.infer<typeof rawMaterialVariationSchema>;\n\n// Raw Material schema (from WooCommerce products in Raw Materials category)\nexport const rawMaterialSchema = z.object({\n  id: z.number(),\n  name: z.string(),\n  type: z.enum([\"simple\", \"variable\"]).default(\"simple\"),\n  sku: z.string().optional(),\n  stock_quantity: z.number().nullable(), // For simple products, or total of variations for variable\n  stock_status: z.string(),\n  manage_stock: z.boolean(),\n  categories: z.array(z.object({\n    id: z.number(),\n    name: z.string(),\n    slug: z.string(),\n  })),\n  images: z.array(z.object({\n    id: z.number(),\n    src: z.string(),\n  })).optional(),\n  variations: z.array(rawMaterialVariationSchema).optional(), // For variable products\n});\n\nexport type RawMaterial = z.infer<typeof rawMaterialSchema>;\n\n// Variable product with variations\nexport const variableProductSchema = z.object({\n  id: z.number(),\n  name: z.string(),\n  type: z.string(),\n  sku: z.string().optional(),\n  variations: z.array(z.number()).optional(), // variation IDs\n});\n\nexport type VariableProduct = z.infer<typeof variableProductSchema>;\n\n// Product variation\nexport const productVariationSchema = z.object({\n  id: z.number(),\n  sku: z.string().optional(),\n  attributes: z.array(z.object({\n    id: z.number(),\n    name: z.string(),\n    option: z.string(),\n  })),\n});\n\nexport type ProductVariation = z.infer<typeof productVariationSchema>;\n\n// ============================================\n// PURCHASE ORDER SYSTEM\n// ============================================\n\n// Purchase Order Status Enum\nexport const purchaseOrderStatusEnum = pgEnum(\"purchase_order_status\", [\n  \"draft\",\n  \"ordered\",\n  \"partially_received\",\n  \"received\",\n  \"cancelled\"\n]);\n\n// Suppliers table\nexport const suppliers = pgTable(\"suppliers\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  contactName: varchar(\"contact_name\", { length: 255 }),\n  email: varchar(\"email\", { length: 255 }),\n  phone: varchar(\"phone\", { length: 50 }),\n  address: text(\"address\"),\n  notes: text(\"notes\"),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertSupplierSchema = createInsertSchema(suppliers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertSupplier = z.infer<typeof insertSupplierSchema>;\nexport type Supplier = typeof suppliers.$inferSelect;\n\n// Purchase Orders table\nexport const purchaseOrders = pgTable(\"purchase_orders\", {\n  id: serial(\"id\").primaryKey(),\n  poNumber: varchar(\"po_number\", { length: 50 }).notNull().unique(),\n  supplierId: integer(\"supplier_id\").notNull(),\n  status: purchaseOrderStatusEnum(\"status\").default(\"draft\").notNull(),\n  orderDate: timestamp(\"order_date\"),\n  expectedDeliveryDate: timestamp(\"expected_delivery_date\"),\n  receivedDate: timestamp(\"received_date\"),\n  subtotal: numeric(\"subtotal\", { precision: 10, scale: 2 }).default(\"0\").notNull(),\n  shippingCost: numeric(\"shipping_cost\", { precision: 10, scale: 2 }).default(\"0\").notNull(),\n  shippingVatRate: numeric(\"shipping_vat_rate\", { precision: 5, scale: 2 }).default(\"0\").notNull(),\n  shippingVat: numeric(\"shipping_vat\", { precision: 10, scale: 2 }).default(\"0\").notNull(),\n  vatTotal: numeric(\"vat_total\", { precision: 10, scale: 2 }).default(\"0\").notNull(),\n  grandTotal: numeric(\"grand_total\", { precision: 10, scale: 2 }).default(\"0\").notNull(),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertPurchaseOrderSchema = createInsertSchema(purchaseOrders).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertPurchaseOrder = z.infer<typeof insertPurchaseOrderSchema>;\nexport type PurchaseOrder = typeof purchaseOrders.$inferSelect;\n\n// Purchase Order Items table\nexport const purchaseOrderItems = pgTable(\"purchase_order_items\", {\n  id: serial(\"id\").primaryKey(),\n  purchaseOrderId: integer(\"purchase_order_id\").notNull(),\n  materialProductId: integer(\"material_product_id\").notNull(),\n  materialVariationId: integer(\"material_variation_id\"),\n  materialName: varchar(\"material_name\", { length: 500 }).notNull(),\n  quantityOrdered: integer(\"quantity_ordered\").notNull(),\n  quantityReceived: integer(\"quantity_received\").default(0).notNull(),\n  unitPrice: numeric(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  vatRate: numeric(\"vat_rate\", { precision: 5, scale: 2 }).default(\"23\").notNull(),\n  lineSubtotal: numeric(\"line_subtotal\", { precision: 10, scale: 2 }).notNull(),\n  lineVat: numeric(\"line_vat\", { precision: 10, scale: 2 }).notNull(),\n  lineTotal: numeric(\"line_total\", { precision: 10, scale: 2 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertPurchaseOrderItemSchema = createInsertSchema(purchaseOrderItems).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertPurchaseOrderItem = z.infer<typeof insertPurchaseOrderItemSchema>;\nexport type PurchaseOrderItem = typeof purchaseOrderItems.$inferSelect;\n\n// Relations\nexport const suppliersRelations = relations(suppliers, ({ many }) => ({\n  purchaseOrders: many(purchaseOrders),\n}));\n\nexport const purchaseOrdersRelations = relations(purchaseOrders, ({ one, many }) => ({\n  supplier: one(suppliers, {\n    fields: [purchaseOrders.supplierId],\n    references: [suppliers.id],\n  }),\n  items: many(purchaseOrderItems),\n}));\n\nexport const purchaseOrderItemsRelations = relations(purchaseOrderItems, ({ one }) => ({\n  purchaseOrder: one(purchaseOrders, {\n    fields: [purchaseOrderItems.purchaseOrderId],\n    references: [purchaseOrders.id],\n  }),\n}));\n\n// Zod schemas for API\nexport const purchaseOrderWithItemsSchema = z.object({\n  id: z.number(),\n  poNumber: z.string(),\n  supplierId: z.number(),\n  supplierName: z.string().optional(),\n  status: z.enum([\"draft\", \"ordered\", \"partially_received\", \"received\", \"cancelled\"]),\n  orderDate: z.string().nullable(),\n  expectedDeliveryDate: z.string().nullable(),\n  receivedDate: z.string().nullable(),\n  subtotal: z.string(),\n  shippingCost: z.string(),\n  shippingVatRate: z.string(),\n  shippingVat: z.string(),\n  vatTotal: z.string(),\n  grandTotal: z.string(),\n  notes: z.string().nullable(),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n  items: z.array(z.object({\n    id: z.number(),\n    purchaseOrderId: z.number(),\n    materialProductId: z.number(),\n    materialVariationId: z.number().nullable(),\n    materialName: z.string(),\n    quantityOrdered: z.number(),\n    quantityReceived: z.number(),\n    unitPrice: z.string(),\n    vatRate: z.string(),\n    lineSubtotal: z.string(),\n    lineVat: z.string(),\n    lineTotal: z.string(),\n  })),\n});\n\nexport type PurchaseOrderWithItems = z.infer<typeof purchaseOrderWithItemsSchema>;\n\n// Receive items request schema\nexport const receiveItemsRequestSchema = z.object({\n  items: z.array(z.object({\n    itemId: z.number(),\n    quantityReceived: z.number().min(0),\n  })),\n});\n\nexport type ReceiveItemsRequest = z.infer<typeof receiveItemsRequestSchema>;\n\n// ============================================\n// LOCAL RAW MATERIALS SYSTEM\n// ============================================\n\n// Raw Materials table - stores materials locally instead of fetching from WooCommerce\nexport const rawMaterials = pgTable(\"raw_materials\", {\n  id: serial(\"id\").primaryKey(),\n  woocommerceId: integer(\"woocommerce_id\"), // Original WooCommerce ID (for reference during import)\n  name: varchar(\"name\", { length: 500 }).notNull(),\n  sku: varchar(\"sku\", { length: 100 }),\n  type: varchar(\"type\", { length: 50 }).default(\"simple\").notNull(), // \"simple\" or \"variable\"\n  stockQuantity: integer(\"stock_quantity\").default(0),\n  manageStock: boolean(\"manage_stock\").default(true).notNull(),\n  lowStockThreshold: integer(\"low_stock_threshold\").default(5),\n  imageUrl: text(\"image_url\"),\n  notes: text(\"notes\"),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertRawMaterialSchema = createInsertSchema(rawMaterials).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertRawMaterial = z.infer<typeof insertRawMaterialSchema>;\nexport type LocalRawMaterial = typeof rawMaterials.$inferSelect;\n\n// Raw Material Variations table - for variable materials\nexport const rawMaterialVariations = pgTable(\"raw_material_variations\", {\n  id: serial(\"id\").primaryKey(),\n  materialId: integer(\"material_id\").notNull(), // References rawMaterials.id\n  woocommerceId: integer(\"woocommerce_id\"), // Original WooCommerce variation ID\n  name: varchar(\"name\", { length: 500 }).notNull(), // e.g., \"Black\", \"White - Large\"\n  sku: varchar(\"sku\", { length: 100 }),\n  stockQuantity: integer(\"stock_quantity\").default(0),\n  manageStock: boolean(\"manage_stock\").default(true).notNull(),\n  lowStockThreshold: integer(\"low_stock_threshold\").default(5),\n  attributes: text(\"attributes\"), // JSON string of attributes [{name: \"Color\", option: \"Black\"}]\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertRawMaterialVariationSchema = createInsertSchema(rawMaterialVariations).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertRawMaterialVariation = z.infer<typeof insertRawMaterialVariationSchema>;\nexport type LocalRawMaterialVariation = typeof rawMaterialVariations.$inferSelect;\n\n// Relations for local raw materials\nexport const rawMaterialsRelations = relations(rawMaterials, ({ many }) => ({\n  variations: many(rawMaterialVariations),\n}));\n\nexport const rawMaterialVariationsRelations = relations(rawMaterialVariations, ({ one }) => ({\n  material: one(rawMaterials, {\n    fields: [rawMaterialVariations.materialId],\n    references: [rawMaterials.id],\n  }),\n}));\n\n// Type for material with variations (for API responses)\nexport type LocalRawMaterialWithVariations = LocalRawMaterial & {\n  variations?: LocalRawMaterialVariation[];\n};\n","path":null,"size_bytes":18615,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { z } from \"zod\";\nimport PDFDocument from \"pdfkit\";\nimport { \n  fetchOrders, \n  getOrderStats, \n  getDateRange, \n  generateOrderTrends, \n  fetchOrderStatuses,\n  fetchRawMaterials,\n  fetchVariableProducts,\n  fetchProductVariations,\n  fetchAllProductsWithVariations,\n  updateProductStock,\n  updateVariationStock,\n  updateOrderStatus,\n  getProductById,\n  getVariationById,\n  fetchCustomers,\n  fetchCustomerById,\n  fetchCustomerOrders,\n  type Customer\n} from \"./woocommerce\";\nimport { storage, type DecryptedCredentials } from \"./storage\";\nimport { \n  insertMaterialProductMappingSchema, \n  wooCommerceConfigSchema,\n  insertSupplierSchema,\n  receiveItemsRequestSchema,\n  type ProcessedOrder,\n} from \"@shared/schema\";\nimport { invalidateStockCache, invalidateOrdersCache, invalidateAllCache, apiCache } from \"./cache\";\nimport { setupAuth, requireAuth } from \"./auth\";\n\nasync function getCredentialsFromStorage(): Promise<DecryptedCredentials | null> {\n  return await storage.getCredentials();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  setupAuth(app);\n  \n  app.get(\"/api/credentials/status\", requireAuth, async (req, res) => {\n    try {\n      const hasCredentials = await storage.hasCredentials();\n      const credentials = hasCredentials ? await storage.getCredentials() : null;\n      res.json({ \n        configured: hasCredentials,\n        storeUrl: credentials?.storeUrl || null \n      });\n    } catch (error: any) {\n      console.error(\"Error checking credentials:\", error);\n      res.status(500).json({ error: \"Failed to check credentials status\" });\n    }\n  });\n\n  app.post(\"/api/credentials\", requireAuth, async (req, res) => {\n    try {\n      const validated = wooCommerceConfigSchema.parse(req.body);\n      await storage.saveCredentials(\n        validated.storeUrl, \n        validated.consumerKey, \n        validated.consumerSecret\n      );\n      res.json({ success: true, storeUrl: validated.storeUrl });\n    } catch (error: any) {\n      console.error(\"Error saving credentials:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Invalid credentials format\", details: error.errors });\n      }\n      res.status(500).json({ error: \"Failed to save credentials\" });\n    }\n  });\n\n  app.delete(\"/api/credentials\", requireAuth, async (req, res) => {\n    try {\n      await storage.deleteCredentials();\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error deleting credentials:\", error);\n      res.status(500).json({ error: \"Failed to delete credentials\" });\n    }\n  });\n\n  // Cache management endpoints\n  app.post(\"/api/cache/refresh\", requireAuth, async (req, res) => {\n    try {\n      invalidateAllCache();\n      res.json({ success: true, message: \"Cache cleared. Fresh data will be fetched on next request.\" });\n    } catch (error: any) {\n      console.error(\"Error clearing cache:\", error);\n      res.status(500).json({ error: \"Failed to clear cache\" });\n    }\n  });\n\n  app.get(\"/api/cache/stats\", requireAuth, async (req, res) => {\n    try {\n      const stats = apiCache.getStats();\n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"Error getting cache stats:\", error);\n      res.status(500).json({ error: \"Failed to get cache stats\" });\n    }\n  });\n\n  app.get(\"/api/orders\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const dateRangePreset = (req.query.dateRange as string) || \"last30days\";\n      const status = req.query.status as string | undefined;\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const dateRange = getDateRange(dateRangePreset);\n      const orders = await fetchOrders(\n        credentials,\n        { \n          after: dateRange.after, \n          per_page: 100,\n          status: status \n        }\n      );\n\n      res.json(orders);\n    } catch (error: any) {\n      console.error(\"Error fetching orders:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch orders\" \n      });\n    }\n  });\n\n  // Customers endpoints\n  app.get(\"/api/customers\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      \n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      // Fetch customers - WooCommerce REST API includes native orders_count and total_spent fields\n      // These are more accurate than computing from a limited order set\n      const customers = await fetchCustomers(credentials);\n\n      res.json(customers);\n    } catch (error: any) {\n      console.error(\"Error fetching customers:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch customers\" \n      });\n    }\n  });\n\n  app.get(\"/api/customers/:id\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const customerId = parseInt(req.params.id);\n      \n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const customer = await fetchCustomerById(credentials, customerId);\n      res.json(customer);\n    } catch (error: any) {\n      console.error(\"Error fetching customer:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch customer\" \n      });\n    }\n  });\n\n  app.get(\"/api/customers/:id/orders\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const customerId = parseInt(req.params.id);\n      \n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const orders = await fetchCustomerOrders(credentials, customerId);\n      res.json(orders);\n    } catch (error: any) {\n      console.error(\"Error fetching customer orders:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch customer orders\" \n      });\n    }\n  });\n\n  app.get(\"/api/metrics\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const dateRangePreset = (req.query.dateRange as string) || \"last30days\";\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const dateRange = getDateRange(dateRangePreset);\n      const orders = await fetchOrders(\n        credentials,\n        { after: dateRange.after, per_page: 100 }\n      );\n\n      const stats = await getOrderStats(orders);\n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"Error fetching metrics:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch metrics\" \n      });\n    }\n  });\n\n  app.get(\"/api/trends\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const dateRangePreset = (req.query.dateRange as string) || \"last30days\";\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const dateRange = getDateRange(dateRangePreset);\n      const orders = await fetchOrders(\n        credentials,\n        { after: dateRange.after, per_page: 100 }\n      );\n\n      const trends = generateOrderTrends(orders);\n      res.json(trends);\n    } catch (error: any) {\n      console.error(\"Error fetching trends:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch trends\" \n      });\n    }\n  });\n\n  app.get(\"/api/order-statuses\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const statuses = await fetchOrderStatuses(credentials);\n      res.json(statuses);\n    } catch (error: any) {\n      console.error(\"Error fetching order statuses:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch order statuses\" \n      });\n    }\n  });\n\n  app.get(\"/api/export/csv\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const dateRangePreset = (req.query.dateRange as string) || \"last30days\";\n      const statusFilter = req.query.status as string | undefined;\n      const searchFilter = req.query.search as string | undefined;\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const dateRange = getDateRange(dateRangePreset);\n      let orders = await fetchOrders(\n        credentials,\n        { after: dateRange.after, per_page: 100 }\n      );\n\n      if (statusFilter) {\n        orders = orders.filter((order: any) => order.status === statusFilter);\n      }\n\n      if (searchFilter) {\n        const searchLower = searchFilter.toLowerCase();\n        orders = orders.filter((order: any) => \n          order.number.toLowerCase().includes(searchLower) ||\n          `${order.billing.first_name} ${order.billing.last_name}`.toLowerCase().includes(searchLower) ||\n          order.billing.email.toLowerCase().includes(searchLower)\n        );\n      }\n\n      const csvHeaders = [\"Order\", \"Customer\", \"Email\", \"Date\", \"Status\", \"Total\"];\n      const csvRows = orders.map((order: any) => [\n        order.number,\n        `${order.billing.first_name} ${order.billing.last_name}`,\n        order.billing.email,\n        new Date(order.date_created).toLocaleDateString(),\n        order.status,\n        `${order.currency} ${order.total}`,\n      ]);\n\n      const csvContent = [\n        csvHeaders.join(\",\"),\n        ...csvRows.map((row: any[]) => row.map((cell: any) => `\"${cell}\"`).join(\",\"))\n      ].join(\"\\n\");\n\n      res.setHeader(\"Content-Type\", \"text/csv\");\n      res.setHeader(\"Content-Disposition\", `attachment; filename=\"woocommerce-orders-${dateRangePreset}-${new Date().toISOString().split(\"T\")[0]}.csv\"`);\n      res.send(csvContent);\n    } catch (error: any) {\n      console.error(\"Error exporting CSV:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to export CSV\" \n      });\n    }\n  });\n\n  // Raw Materials endpoints\n  app.get(\"/api/raw-materials\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const materials = await fetchRawMaterials(credentials);\n      res.json(materials);\n    } catch (error: any) {\n      console.error(\"Error fetching raw materials:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch raw materials\" \n      });\n    }\n  });\n\n  // Variable products endpoints\n  app.get(\"/api/variable-products\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const products = await fetchVariableProducts(credentials);\n      res.json(products);\n    } catch (error: any) {\n      console.error(\"Error fetching variable products:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch variable products\" \n      });\n    }\n  });\n\n  app.get(\"/api/products/:productId/variations\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const productId = parseInt(req.params.productId);\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const variations = await fetchProductVariations(credentials, productId);\n      res.json(variations);\n    } catch (error: any) {\n      console.error(\"Error fetching product variations:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch product variations\" \n      });\n    }\n  });\n\n  app.get(\"/api/products-with-variations\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const products = await fetchAllProductsWithVariations(credentials);\n      res.json(products);\n    } catch (error: any) {\n      console.error(\"Error fetching products with variations:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch products with variations\" \n      });\n    }\n  });\n\n  // Material mappings endpoints\n  app.get(\"/api/material-mappings\", requireAuth, async (req, res) => {\n    try {\n      const mappings = await storage.getMaterialMappings();\n      res.json(mappings);\n    } catch (error: any) {\n      console.error(\"Error fetching material mappings:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch material mappings\" \n      });\n    }\n  });\n\n  app.post(\"/api/material-mappings\", requireAuth, async (req, res) => {\n    try {\n      const validated = insertMaterialProductMappingSchema.parse(req.body);\n      const mapping = await storage.createMaterialMapping(validated);\n      res.status(201).json(mapping);\n    } catch (error: any) {\n      console.error(\"Error creating material mapping:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to create material mapping\" \n      });\n    }\n  });\n\n  app.delete(\"/api/material-mappings/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteMaterialMapping(id);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting material mapping:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to delete material mapping\" \n      });\n    }\n  });\n\n  // Get mappings for a specific material (with optional variation filter)\n  app.get(\"/api/material-mappings/by-material/:materialProductId\", requireAuth, async (req, res) => {\n    try {\n      const materialProductId = parseInt(req.params.materialProductId);\n      const materialVariationId = req.query.materialVariationId !== undefined \n        ? (req.query.materialVariationId === 'null' ? null : parseInt(req.query.materialVariationId as string))\n        : undefined;\n      \n      const mappings = await storage.getMaterialMappingsForMaterial(materialProductId, materialVariationId);\n      res.json(mappings);\n    } catch (error: any) {\n      console.error(\"Error fetching material mappings:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch material mappings\" \n      });\n    }\n  });\n\n  // Bulk create mappings for a material to multiple products\n  app.post(\"/api/material-mappings/bulk\", requireAuth, async (req, res) => {\n    try {\n      const { materialProductId, materialVariationId, targets } = req.body;\n      \n      if (!materialProductId || !Array.isArray(targets) || targets.length === 0) {\n        return res.status(400).json({ \n          error: \"materialProductId and non-empty targets array required\" \n        });\n      }\n\n      // Validate targets\n      for (const target of targets) {\n        if (typeof target.productId !== 'number' || typeof target.quantityUsed !== 'number') {\n          return res.status(400).json({ \n            error: \"Each target must have productId and quantityUsed as numbers\" \n          });\n        }\n      }\n\n      const mappings = await storage.bulkCreateMaterialMappings(\n        materialProductId, \n        materialVariationId ?? null, \n        targets\n      );\n      \n      res.status(201).json(mappings);\n    } catch (error: any) {\n      console.error(\"Error creating bulk material mappings:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to create bulk material mappings\" \n      });\n    }\n  });\n\n  // Update a mapping's quantity\n  app.patch(\"/api/material-mappings/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { quantityUsed } = req.body;\n      \n      if (typeof quantityUsed !== 'number' || quantityUsed < 1) {\n        return res.status(400).json({ \n          error: \"quantityUsed must be a positive number\" \n        });\n      }\n\n      const mapping = await storage.updateMaterialMapping(id, quantityUsed);\n      \n      if (!mapping) {\n        return res.status(404).json({ error: \"Mapping not found\" });\n      }\n      \n      res.json(mapping);\n    } catch (error: any) {\n      console.error(\"Error updating material mapping:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to update material mapping\" \n      });\n    }\n  });\n\n  // ============================================\n  // LOCAL RAW MATERIALS API\n  // ============================================\n\n  // Get all local raw materials with their variations\n  app.get(\"/api/local-materials\", requireAuth, async (req, res) => {\n    try {\n      const activeOnly = req.query.activeOnly !== 'false';\n      const materials = await storage.getLocalRawMaterials(activeOnly);\n      res.json(materials);\n    } catch (error: any) {\n      console.error(\"Error fetching local materials:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch local materials\" \n      });\n    }\n  });\n\n  // Get a single local raw material by ID\n  app.get(\"/api/local-materials/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const material = await storage.getLocalRawMaterial(id);\n      \n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n      \n      res.json(material);\n    } catch (error: any) {\n      console.error(\"Error fetching local material:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch local material\" \n      });\n    }\n  });\n\n  // Create a new local raw material\n  app.post(\"/api/local-materials\", requireAuth, async (req, res) => {\n    try {\n      const { name, sku, type, stockQuantity, manageStock, lowStockThreshold, imageUrl, notes } = req.body;\n      \n      if (!name) {\n        return res.status(400).json({ error: \"Material name is required\" });\n      }\n\n      const material = await storage.createLocalRawMaterial({\n        name,\n        sku: sku || null,\n        type: type || 'simple',\n        stockQuantity: stockQuantity || 0,\n        manageStock: manageStock !== false,\n        lowStockThreshold: lowStockThreshold || 5,\n        imageUrl: imageUrl || null,\n        notes: notes || null,\n      });\n      \n      res.status(201).json(material);\n    } catch (error: any) {\n      console.error(\"Error creating local material:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to create local material\" \n      });\n    }\n  });\n\n  // Update a local raw material\n  app.patch(\"/api/local-materials/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      \n      const material = await storage.updateLocalRawMaterial(id, updates);\n      \n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n      \n      res.json(material);\n    } catch (error: any) {\n      console.error(\"Error updating local material:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to update local material\" \n      });\n    }\n  });\n\n  // Delete (soft delete) a local raw material\n  app.delete(\"/api/local-materials/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteLocalRawMaterial(id);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting local material:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to delete local material\" \n      });\n    }\n  });\n\n  // Update stock for a local raw material\n  app.patch(\"/api/local-materials/:id/stock\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { stockQuantity } = req.body;\n      \n      if (typeof stockQuantity !== 'number') {\n        return res.status(400).json({ error: \"stockQuantity must be a number\" });\n      }\n\n      const material = await storage.updateLocalRawMaterialStock(id, stockQuantity);\n      \n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n      \n      res.json(material);\n    } catch (error: any) {\n      console.error(\"Error updating local material stock:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to update local material stock\" \n      });\n    }\n  });\n\n  // ============================================\n  // LOCAL RAW MATERIAL VARIATIONS API\n  // ============================================\n\n  // Get variations for a specific material\n  app.get(\"/api/local-materials/:materialId/variations\", requireAuth, async (req, res) => {\n    try {\n      const materialId = parseInt(req.params.materialId);\n      const variations = await storage.getLocalRawMaterialVariations(materialId);\n      res.json(variations);\n    } catch (error: any) {\n      console.error(\"Error fetching local material variations:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch local material variations\" \n      });\n    }\n  });\n\n  // Create a variation for a material\n  app.post(\"/api/local-materials/:materialId/variations\", requireAuth, async (req, res) => {\n    try {\n      const materialId = parseInt(req.params.materialId);\n      const { name, sku, stockQuantity, manageStock, lowStockThreshold, attributes } = req.body;\n      \n      if (!name) {\n        return res.status(400).json({ error: \"Variation name is required\" });\n      }\n\n      const variation = await storage.createLocalRawMaterialVariation({\n        materialId,\n        name,\n        sku: sku || null,\n        stockQuantity: stockQuantity || 0,\n        manageStock: manageStock !== false,\n        lowStockThreshold: lowStockThreshold || 5,\n        attributes: attributes ? JSON.stringify(attributes) : null,\n      });\n      \n      res.status(201).json(variation);\n    } catch (error: any) {\n      console.error(\"Error creating local material variation:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to create local material variation\" \n      });\n    }\n  });\n\n  // Update a variation\n  app.patch(\"/api/local-material-variations/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      \n      // If attributes is an object, stringify it\n      if (updates.attributes && typeof updates.attributes === 'object') {\n        updates.attributes = JSON.stringify(updates.attributes);\n      }\n      \n      const variation = await storage.updateLocalRawMaterialVariation(id, updates);\n      \n      if (!variation) {\n        return res.status(404).json({ error: \"Variation not found\" });\n      }\n      \n      res.json(variation);\n    } catch (error: any) {\n      console.error(\"Error updating local material variation:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to update local material variation\" \n      });\n    }\n  });\n\n  // Delete (soft delete) a variation\n  app.delete(\"/api/local-material-variations/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteLocalRawMaterialVariation(id);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting local material variation:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to delete local material variation\" \n      });\n    }\n  });\n\n  // Update stock for a variation\n  app.patch(\"/api/local-material-variations/:id/stock\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { stockQuantity } = req.body;\n      \n      if (typeof stockQuantity !== 'number') {\n        return res.status(400).json({ error: \"stockQuantity must be a number\" });\n      }\n\n      const variation = await storage.updateLocalRawMaterialVariationStock(id, stockQuantity);\n      \n      if (!variation) {\n        return res.status(404).json({ error: \"Variation not found\" });\n      }\n      \n      res.json(variation);\n    } catch (error: any) {\n      console.error(\"Error updating local material variation stock:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to update local material variation stock\" \n      });\n    }\n  });\n\n  // ============================================\n  // IMPORT FROM WOOCOMMERCE\n  // ============================================\n\n  // Import raw materials from WooCommerce into local database\n  app.post(\"/api/local-materials/import-from-woocommerce\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      // Fetch raw materials from WooCommerce\n      const wooMaterials = await fetchRawMaterials(credentials);\n      \n      let imported = 0;\n      let skipped = 0;\n      let updated = 0;\n      const errors: string[] = [];\n\n      for (const material of wooMaterials) {\n        try {\n          // Check if material already exists by WooCommerce ID\n          const existing = await storage.getLocalRawMaterialByWooId(material.id);\n          \n          if (existing) {\n            skipped++;\n            continue;\n          }\n\n          // Determine type\n          const type = material.type === 'variable' ? 'variable' : 'simple';\n\n          // Create the material\n          const newMaterial = await storage.createLocalRawMaterial({\n            woocommerceId: material.id,\n            name: material.name,\n            sku: material.sku || null,\n            type,\n            stockQuantity: material.stock_quantity || 0,\n            manageStock: material.manage_stock !== false,\n            lowStockThreshold: material.low_stock_amount || 5,\n            imageUrl: material.images?.[0]?.src || null,\n            notes: null,\n          });\n\n          // If variable product, fetch and import variations\n          if (type === 'variable' && material.variations && material.variations.length > 0) {\n            const variations = await fetchProductVariations(credentials, material.id);\n            \n            for (const variation of variations) {\n              try {\n                // Create variation name from attributes\n                const attrNames = variation.attributes?.map((a: any) => a.option).join(' - ') || `Variation ${variation.id}`;\n                \n                await storage.createLocalRawMaterialVariation({\n                  materialId: newMaterial.id,\n                  woocommerceId: variation.id,\n                  name: attrNames,\n                  sku: variation.sku || null,\n                  stockQuantity: variation.stock_quantity || 0,\n                  manageStock: variation.manage_stock !== false,\n                  lowStockThreshold: variation.low_stock_amount || 5,\n                  attributes: variation.attributes ? JSON.stringify(variation.attributes) : null,\n                });\n              } catch (varErr: any) {\n                console.error(`Error importing variation ${variation.id}:`, varErr);\n                errors.push(`Variation ${variation.id}: ${varErr.message}`);\n              }\n            }\n          }\n\n          imported++;\n        } catch (err: any) {\n          console.error(`Error importing material ${material.id} (${material.name}):`, err);\n          errors.push(`${material.name}: ${err.message}`);\n        }\n      }\n\n      res.json({\n        success: true,\n        imported,\n        skipped,\n        updated,\n        errors: errors.length > 0 ? errors : undefined,\n        message: `Imported ${imported} materials, skipped ${skipped} already existing.${errors.length > 0 ? ` ${errors.length} errors occurred.` : ''}`\n      });\n    } catch (error: any) {\n      console.error(\"Error importing from WooCommerce:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to import from WooCommerce\" \n      });\n    }\n  });\n\n  // ============================================\n  // LOCAL MATERIALS STOCK MANAGEMENT (with ledger)\n  // ============================================\n\n  // Add stock to a local raw material (creates ledger entry)\n  app.post(\"/api/local-materials/:id/add-stock\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { quantity, notes } = req.body;\n      \n      if (typeof quantity !== 'number' || quantity <= 0) {\n        return res.status(400).json({ error: \"Quantity must be a positive number\" });\n      }\n\n      const material = await storage.getLocalRawMaterial(id);\n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n\n      const previousStock = material.stockQuantity || 0;\n      const newStock = previousStock + quantity;\n\n      await storage.updateLocalRawMaterialStock(id, newStock);\n\n      await storage.createStockLedgerEntry({\n        materialProductId: id,\n        materialVariationId: null,\n        quantityChange: quantity,\n        previousStock,\n        newStock,\n        reason: \"manual\",\n        notes: notes || \"Stock added manually\",\n      });\n\n      res.json({\n        success: true,\n        previousStock,\n        quantityAdded: quantity,\n        newStock,\n        materialName: material.name,\n      });\n    } catch (error: any) {\n      console.error(\"Error adding stock to local material:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to add stock\" \n      });\n    }\n  });\n\n  // Set stock level for a local raw material (stock take - creates ledger entry)\n  app.post(\"/api/local-materials/:id/set-stock\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { newStockLevel, notes } = req.body;\n      \n      if (typeof newStockLevel !== 'number' || newStockLevel < 0) {\n        return res.status(400).json({ error: \"Stock level must be a non-negative number\" });\n      }\n\n      const material = await storage.getLocalRawMaterial(id);\n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n\n      const previousStock = material.stockQuantity || 0;\n      const quantityChange = newStockLevel - previousStock;\n\n      await storage.updateLocalRawMaterialStock(id, newStockLevel);\n\n      await storage.createStockLedgerEntry({\n        materialProductId: id,\n        materialVariationId: null,\n        quantityChange,\n        previousStock,\n        newStock: newStockLevel,\n        reason: \"stock_take\",\n        notes: notes || \"Stock level set during stock take\",\n      });\n\n      res.json({\n        success: true,\n        previousStock,\n        quantityChange,\n        newStock: newStockLevel,\n        materialName: material.name,\n      });\n    } catch (error: any) {\n      console.error(\"Error setting stock for local material:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to set stock\" \n      });\n    }\n  });\n\n  // Add stock to a local raw material variation (creates ledger entry)\n  app.post(\"/api/local-materials/:materialId/variations/:variationId/add-stock\", requireAuth, async (req, res) => {\n    try {\n      const materialId = parseInt(req.params.materialId);\n      const variationId = parseInt(req.params.variationId);\n      const { quantity, notes } = req.body;\n      \n      if (typeof quantity !== 'number' || quantity <= 0) {\n        return res.status(400).json({ error: \"Quantity must be a positive number\" });\n      }\n\n      const material = await storage.getLocalRawMaterial(materialId);\n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n\n      const variation = await storage.getLocalRawMaterialVariation(variationId);\n      if (!variation || variation.materialId !== materialId) {\n        return res.status(404).json({ error: \"Variation not found\" });\n      }\n\n      const previousStock = variation.stockQuantity || 0;\n      const newStock = previousStock + quantity;\n\n      await storage.updateLocalRawMaterialVariationStock(variationId, newStock);\n\n      await storage.createStockLedgerEntry({\n        materialProductId: materialId,\n        materialVariationId: variationId,\n        quantityChange: quantity,\n        previousStock,\n        newStock,\n        reason: \"manual\",\n        notes: notes || \"Stock added manually\",\n      });\n\n      res.json({\n        success: true,\n        previousStock,\n        quantityAdded: quantity,\n        newStock,\n        materialName: material.name,\n        variationName: variation.name,\n      });\n    } catch (error: any) {\n      console.error(\"Error adding stock to local material variation:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to add stock to variation\" \n      });\n    }\n  });\n\n  // Set stock level for a local raw material variation (stock take - creates ledger entry)\n  app.post(\"/api/local-materials/:materialId/variations/:variationId/set-stock\", requireAuth, async (req, res) => {\n    try {\n      const materialId = parseInt(req.params.materialId);\n      const variationId = parseInt(req.params.variationId);\n      const { newStockLevel, notes } = req.body;\n      \n      if (typeof newStockLevel !== 'number' || newStockLevel < 0) {\n        return res.status(400).json({ error: \"Stock level must be a non-negative number\" });\n      }\n\n      const material = await storage.getLocalRawMaterial(materialId);\n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n\n      const variation = await storage.getLocalRawMaterialVariation(variationId);\n      if (!variation || variation.materialId !== materialId) {\n        return res.status(404).json({ error: \"Variation not found\" });\n      }\n\n      const previousStock = variation.stockQuantity || 0;\n      const quantityChange = newStockLevel - previousStock;\n\n      await storage.updateLocalRawMaterialVariationStock(variationId, newStockLevel);\n\n      await storage.createStockLedgerEntry({\n        materialProductId: materialId,\n        materialVariationId: variationId,\n        quantityChange,\n        previousStock,\n        newStock: newStockLevel,\n        reason: \"stock_take\",\n        notes: notes || \"Stock level set during stock take\",\n      });\n\n      res.json({\n        success: true,\n        previousStock,\n        quantityChange,\n        newStock: newStockLevel,\n        materialName: material.name,\n        variationName: variation.name,\n      });\n    } catch (error: any) {\n      console.error(\"Error setting stock for local material variation:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to set variation stock\" \n      });\n    }\n  });\n\n  // Stock ledger endpoints\n  app.get(\"/api/stock-ledger\", requireAuth, async (req, res) => {\n    try {\n      const materialProductId = req.query.materialProductId \n        ? parseInt(req.query.materialProductId as string) \n        : undefined;\n      const limit = req.query.limit \n        ? parseInt(req.query.limit as string) \n        : 100;\n      \n      const entries = await storage.getStockLedgerEntries(materialProductId, limit);\n      res.json(entries);\n    } catch (error: any) {\n      console.error(\"Error fetching stock ledger:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch stock ledger\" \n      });\n    }\n  });\n\n  // Check if order has been processed for inventory\n  app.get(\"/api/processed-orders/:orderId\", requireAuth, async (req, res) => {\n    try {\n      const orderId = parseInt(req.params.orderId);\n      const processed = await storage.getProcessedOrder(orderId);\n      res.json({ processed: !!processed, data: processed });\n    } catch (error: any) {\n      console.error(\"Error checking processed order:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to check processed order\" \n      });\n    }\n  });\n\n  // Update order status\n  app.put(\"/api/orders/:orderId/status\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const orderId = parseInt(req.params.orderId);\n      const { status } = req.body;\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      if (!status) {\n        return res.status(400).json({ \n          error: \"Status is required\" \n        });\n      }\n\n      const updatedOrder = await updateOrderStatus(\n        credentials, \n        orderId, \n        status\n      );\n      \n      res.json(updatedOrder);\n    } catch (error: any) {\n      console.error(\"Error updating order status:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to update order status\" \n      });\n    }\n  });\n\n  // Calculate order fulfillment status based on available raw materials stock\n  // Prioritizes older orders first for stock allocation\n  // Uses local PostgreSQL materials instead of WooCommerce API\n  app.get(\"/api/orders/fulfillment-status\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const dateRangePreset = (req.query.dateRange as string) || \"last30days\";\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      const dateRange = getDateRange(dateRangePreset);\n      const orders = await fetchOrders(\n        credentials,\n        { after: dateRange.after, per_page: 100 }\n      );\n\n      // Fetch raw materials from local PostgreSQL database\n      const localMaterials = await storage.getLocalRawMaterials();\n      const materialsMap = new Map<string, number>();\n      \n      // Build maps for looking up materials by local ID or WooCommerce ID\n      const materialsByLocalId = new Map(localMaterials.map(m => [m.id, m]));\n      const materialsByWooId = new Map(localMaterials.map(m => [m.woocommerceId, m]));\n      \n      // Helper to find material by either local ID or WooCommerce ID\n      const findMaterial = (id: number) => materialsByLocalId.get(id) || materialsByWooId.get(id);\n      \n      // Helper to normalize any material ID to canonical local ID\n      const normalizeId = (id: number): number => {\n        const byLocal = materialsByLocalId.get(id);\n        if (byLocal) return byLocal.id;\n        const byWoo = materialsByWooId.get(id);\n        if (byWoo) return byWoo.id;\n        return id; // Not found, return as-is\n      };\n      \n      // Helper to normalize variation ID to canonical local variation ID\n      const normalizeVariationId = (material: any, varId: number | null): number | null => {\n        if (!varId || !material?.variations) return varId;\n        const variation = material.variations.find((v: any) => v.id === varId || v.woocommerceId === varId);\n        return variation ? variation.id : varId;\n      };\n      \n      // Build stock map using CANONICAL local IDs only\n      // This prevents double-counting when mappings reference same material with different IDs\n      for (const material of localMaterials) {\n        if (material.type === \"variable\" && material.variations && material.variations.length > 0) {\n          let totalVariationStock = 0;\n          for (const variation of material.variations) {\n            const stock = variation.stockQuantity || 0;\n            totalVariationStock += stock;\n            // Store under canonical local ID only\n            materialsMap.set(`${material.id}-${variation.id}`, stock);\n          }\n          // Store total stock for mappings without specific variation\n          materialsMap.set(`${material.id}-null`, totalVariationStock);\n        } else {\n          // Simple product\n          const stock = material.stockQuantity || 0;\n          materialsMap.set(`${material.id}-null`, stock);\n        }\n      }\n\n      // Get all mappings\n      const allMappings = await storage.getMaterialMappings();\n\n      // Get processed orders\n      const processedOrdersList = await storage.getAllProcessedOrders();\n      const processedOrderIds = new Set(processedOrdersList.map((p: ProcessedOrder) => p.orderId));\n\n      // Sort orders by date (oldest first) to prioritize older orders\n      const sortedOrders = [...orders].sort((a: any, b: any) => \n        new Date(a.date_created).getTime() - new Date(b.date_created).getTime()\n      );\n\n      // Track cumulative stock usage\n      const cumulativeStockUsed = new Map<string, number>();\n\n      const fulfillmentStatus: Record<number, { \n        canFulfill: boolean; \n        missingMaterials: Array<{ \n          materialId: number; \n          variationId: number | null;\n          materialName: string;\n          needed: number; \n          available: number;\n        }>;\n        isProcessed: boolean;\n      }> = {};\n\n      for (const order of sortedOrders) {\n        const isProcessed = processedOrderIds.has(order.id);\n        const orderMissingMaterials: Array<{\n          materialId: number;\n          variationId: number | null;\n          materialName: string;\n          needed: number;\n          available: number;\n        }> = [];\n\n        // Skip already processed orders for stock calculation but still mark them\n        if (isProcessed) {\n          fulfillmentStatus[order.id] = { \n            canFulfill: true, \n            missingMaterials: [], \n            isProcessed: true \n          };\n          continue;\n        }\n\n        // Calculate materials needed for this order\n        const materialsNeeded = new Map<string, { needed: number; materialName: string; materialId: number; variationId: number | null }>();\n\n        for (const item of order.line_items) {\n          const productId = item.product_id;\n          const variationId = (item as any).variation_id || null;\n          \n          // Find mappings for this product/variation\n          const itemMappings = allMappings.filter((m: any) => \n            m.productId === productId && \n            (variationId ? m.variationId === variationId : m.variationId === null)\n          );\n\n          for (const mapping of itemMappings) {\n            // Find material and normalize IDs to canonical local IDs\n            const material = findMaterial(mapping.materialProductId);\n            const normalizedMaterialId = normalizeId(mapping.materialProductId);\n            const normalizedVariationId = normalizeVariationId(material, mapping.materialVariationId);\n            const key = `${normalizedMaterialId}-${normalizedVariationId || 'null'}`;\n            const quantityNeeded = mapping.quantityUsed * item.quantity;\n            \n            let materialName = material?.name || `Material ${mapping.materialProductId}`;\n            \n            if (mapping.materialVariationId && material?.variations) {\n              // Find variation by local ID or WooCommerce ID\n              const variation = material.variations.find(v => \n                v.id === mapping.materialVariationId || v.woocommerceId === mapping.materialVariationId\n              );\n              if (variation) {\n                materialName = `${materialName} - ${variation.name}`;\n              }\n            }\n\n            const existing = materialsNeeded.get(key);\n            if (existing) {\n              existing.needed += quantityNeeded;\n            } else {\n              materialsNeeded.set(key, { \n                needed: quantityNeeded, \n                materialName,\n                materialId: normalizedMaterialId,\n                variationId: normalizedVariationId\n              });\n            }\n          }\n        }\n\n        // Check if we can fulfill this order with remaining stock\n        let canFulfill = true;\n\n        for (const [key, { needed, materialName, materialId, variationId }] of Array.from(materialsNeeded.entries())) {\n          const originalStock = materialsMap.get(key) || 0;\n          const alreadyUsed = cumulativeStockUsed.get(key) || 0;\n          const availableStock = originalStock - alreadyUsed;\n\n          if (availableStock < needed) {\n            canFulfill = false;\n            orderMissingMaterials.push({\n              materialId,\n              variationId,\n              materialName,\n              needed,\n              available: Math.max(0, availableStock)\n            });\n          }\n        }\n\n        // If can fulfill, add to cumulative usage\n        if (canFulfill) {\n          for (const [key, { needed }] of Array.from(materialsNeeded.entries())) {\n            const current = cumulativeStockUsed.get(key) || 0;\n            cumulativeStockUsed.set(key, current + needed);\n          }\n        }\n\n        fulfillmentStatus[order.id] = { \n          canFulfill, \n          missingMaterials: orderMissingMaterials,\n          isProcessed: false\n        };\n      }\n\n      res.json(fulfillmentStatus);\n    } catch (error: any) {\n      console.error(\"Error calculating fulfillment status:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to calculate fulfillment status\" \n      });\n    }\n  });\n\n  // Get required raw materials for a specific order\n  // Uses local PostgreSQL materials instead of WooCommerce API\n  app.get(\"/api/orders/:orderId/required-materials\", requireAuth, async (req, res) => {\n    try {\n      const credentials = await getCredentialsFromStorage();\n      const orderId = parseInt(req.params.orderId);\n\n      if (!credentials) {\n        return res.status(400).json({ \n          error: \"WooCommerce credentials not configured. Please set up credentials in Settings.\" \n        });\n      }\n\n      // Fetch the order\n      const orders = await fetchOrders(credentials, { per_page: 100 });\n      const order = orders.find((o: any) => o.id === orderId);\n\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n\n      // Fetch raw materials from local PostgreSQL database\n      const localMaterials = await storage.getLocalRawMaterials();\n      const allMappings = await storage.getMaterialMappings();\n\n      // Calculate materials needed for this order\n      const requiredMaterials: Array<{\n        materialId: number;\n        variationId: number | null;\n        materialName: string;\n        quantityNeeded: number;\n        currentStock: number;\n        hasSufficientStock: boolean;\n        productName: string;\n        variationName: string | null;\n      }> = [];\n\n      for (const item of order.line_items) {\n        const productId = item.product_id;\n        const variationId = (item as any).variation_id || null;\n        \n        // Find mappings for this product/variation\n        const itemMappings = allMappings.filter((m: any) => \n          m.productId === productId && \n          (variationId ? m.variationId === variationId : m.variationId === null)\n        );\n\n        for (const mapping of itemMappings) {\n          const quantityNeeded = mapping.quantityUsed * item.quantity;\n          \n          // Find material and its current stock from local database\n          const material = localMaterials.find(m => m.id === mapping.materialProductId);\n          if (!material) continue;\n\n          let materialName = material.name;\n          let currentStock = material.stockQuantity || 0;\n\n          if (mapping.materialVariationId && material.variations) {\n            const variation = material.variations.find(v => v.id === mapping.materialVariationId);\n            if (variation) {\n              materialName = `${material.name} - ${variation.name}`;\n              currentStock = variation.stockQuantity || 0;\n            }\n          }\n\n          // Get variation name from item metadata\n          let variationName: string | null = null;\n          if (variationId && item.meta_data) {\n            const attrs = item.meta_data\n              .filter((m: any) => m.display_key && m.display_value && !m.key.startsWith('_') && typeof m.display_value !== 'object')\n              .map((m: any) => `${m.display_key}: ${m.display_value}`)\n              .join(', ');\n            if (attrs) variationName = attrs;\n          }\n\n          requiredMaterials.push({\n            materialId: mapping.materialProductId,\n            variationId: mapping.materialVariationId,\n            materialName,\n            quantityNeeded,\n            currentStock,\n            hasSufficientStock: currentStock >= quantityNeeded,\n            productName: item.name,\n            variationName\n          });\n        }\n      }\n\n      // Check if order is already processed\n      const processedStatus = await storage.getProcessedOrder(orderId);\n\n      res.json({\n        orderId,\n        orderNumber: order.number,\n        isProcessed: !!processedStatus,\n        processedAt: processedStatus?.processedAt,\n        requiredMaterials,\n        canFulfill: requiredMaterials.every(m => m.hasSufficientStock)\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching required materials:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to fetch required materials\" \n      });\n    }\n  });\n\n  // Add stock to raw material (stock in from suppliers) - uses local PostgreSQL\n  app.post(\"/api/raw-materials/:productId/add-stock\", requireAuth, async (req, res) => {\n    try {\n      const productId = parseInt(req.params.productId);\n      const { quantity, notes } = req.body;\n\n      if (!quantity || quantity <= 0) {\n        return res.status(400).json({ \n          error: \"Quantity must be a positive number\" \n        });\n      }\n      \n      // Get current material from local database\n      const material = await storage.getLocalRawMaterial(productId);\n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n      \n      const previousStock = material.stockQuantity || 0;\n      const newStock = previousStock + quantity;\n\n      // Update stock in local PostgreSQL\n      await storage.updateLocalRawMaterialStock(productId, newStock);\n\n      // Log to stock ledger\n      const ledgerEntry = await storage.createStockLedgerEntry({\n        materialProductId: productId,\n        orderId: null,\n        orderNumber: null,\n        quantityChange: quantity,\n        previousStock,\n        newStock,\n        reason: \"stock_in\",\n        notes: notes || \"Stock received from supplier\",\n      });\n\n      // Invalidate stock cache\n      invalidateStockCache();\n\n      res.json({\n        success: true,\n        productId,\n        productName: material.name,\n        previousStock,\n        newStock,\n        quantityAdded: quantity,\n        ledgerEntryId: ledgerEntry.id,\n      });\n    } catch (error: any) {\n      console.error(\"Error adding stock:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to add stock\" \n      });\n    }\n  });\n\n  // Set absolute stock level (stock take) - uses local PostgreSQL\n  app.post(\"/api/raw-materials/:productId/set-stock\", requireAuth, async (req, res) => {\n    try {\n      const productId = parseInt(req.params.productId);\n      const { newStockLevel, notes } = req.body;\n\n      if (newStockLevel === undefined || newStockLevel === null || newStockLevel < 0) {\n        return res.status(400).json({ \n          error: \"New stock level must be a non-negative number\" \n        });\n      }\n      \n      // Get current material from local database\n      const material = await storage.getLocalRawMaterial(productId);\n      if (!material) {\n        return res.status(404).json({ error: \"Material not found\" });\n      }\n      \n      const previousStock = material.stockQuantity || 0;\n      const quantityChange = newStockLevel - previousStock;\n\n      // Update stock in local PostgreSQL\n      await storage.updateLocalRawMaterialStock(productId, newStockLevel);\n\n      // Log to stock ledger\n      const ledgerEntry = await storage.createStockLedgerEntry({\n        materialProductId: productId,\n        orderId: null,\n        orderNumber: null,\n        quantityChange,\n        previousStock,\n        newStock: newStockLevel,\n        reason: \"stock_take\",\n        notes: notes || \"Stock take adjustment\",\n      });\n\n      // Invalidate stock cache\n      invalidateStockCache();\n\n      res.json({\n        success: true,\n        productId,\n        productName: material.name,\n        previousStock,\n        newStock: newStockLevel,\n        quantityChange,\n        ledgerEntryId: ledgerEntry.id,\n      });\n    } catch (error: any) {\n      console.error(\"Error setting stock:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to set stock level\" \n      });\n    }\n  });\n\n  // Add stock to raw material variation (stock in from suppliers) - uses local PostgreSQL\n  app.post(\"/api/raw-materials/:productId/variations/:variationId/add-stock\", requireAuth, async (req, res) => {\n    try {\n      const productId = parseInt(req.params.productId);\n      const variationId = parseInt(req.params.variationId);\n      const { quantity, notes } = req.body;\n\n      if (!quantity || quantity <= 0) {\n        return res.status(400).json({ \n          error: \"Quantity must be a positive number\" \n        });\n      }\n      \n      // Get current variation from local database\n      const variation = await storage.getLocalRawMaterialVariation(variationId);\n      if (!variation) {\n        return res.status(404).json({ error: \"Variation not found\" });\n      }\n      \n      const previousStock = variation.stockQuantity || 0;\n      const newStock = previousStock + quantity;\n\n      // Update stock in local PostgreSQL\n      await storage.updateLocalRawMaterialVariationStock(variationId, newStock);\n\n      // Log to stock ledger with variation ID\n      const ledgerEntry = await storage.createStockLedgerEntry({\n        materialProductId: productId,\n        materialVariationId: variationId,\n        orderId: null,\n        orderNumber: null,\n        quantityChange: quantity,\n        previousStock,\n        newStock,\n        reason: \"stock_in\",\n        notes: notes || \"Stock received from supplier\",\n      });\n\n      // Parse variation name from attributes\n      let variationName = `Variation ${variationId}`;\n      if (variation.attributes) {\n        try {\n          const attrs = typeof variation.attributes === 'string' ? JSON.parse(variation.attributes) : variation.attributes;\n          if (Array.isArray(attrs)) {\n            variationName = attrs.map((a: any) => a.option).join(\" / \");\n          }\n        } catch (e) {}\n      }\n\n      // Invalidate stock cache\n      invalidateStockCache();\n\n      res.json({\n        success: true,\n        productId,\n        variationId,\n        variationName,\n        previousStock,\n        newStock,\n        quantityAdded: quantity,\n        ledgerEntryId: ledgerEntry.id,\n      });\n    } catch (error: any) {\n      console.error(\"Error adding variation stock:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to add variation stock\" \n      });\n    }\n  });\n\n  // Set absolute stock level for variation (stock take) - uses local PostgreSQL\n  app.post(\"/api/raw-materials/:productId/variations/:variationId/set-stock\", requireAuth, async (req, res) => {\n    try {\n      const productId = parseInt(req.params.productId);\n      const variationId = parseInt(req.params.variationId);\n      const { newStockLevel, notes } = req.body;\n\n      if (newStockLevel === undefined || newStockLevel === null || newStockLevel < 0) {\n        return res.status(400).json({ \n          error: \"New stock level must be a non-negative number\" \n        });\n      }\n      \n      // Get current variation from local database\n      const variation = await storage.getLocalRawMaterialVariation(variationId);\n      if (!variation) {\n        return res.status(404).json({ error: \"Variation not found\" });\n      }\n      \n      const previousStock = variation.stockQuantity || 0;\n      const quantityChange = newStockLevel - previousStock;\n\n      // Update stock in local PostgreSQL\n      await storage.updateLocalRawMaterialVariationStock(variationId, newStockLevel);\n\n      // Log to stock ledger with variation ID\n      const ledgerEntry = await storage.createStockLedgerEntry({\n        materialProductId: productId,\n        materialVariationId: variationId,\n        orderId: null,\n        orderNumber: null,\n        quantityChange,\n        previousStock,\n        newStock: newStockLevel,\n        reason: \"stock_take\",\n        notes: notes || \"Stock take adjustment\",\n      });\n\n      // Parse variation name from attributes\n      let variationName = `Variation ${variationId}`;\n      if (variation.attributes) {\n        try {\n          const attrs = typeof variation.attributes === 'string' ? JSON.parse(variation.attributes) : variation.attributes;\n          if (Array.isArray(attrs)) {\n            variationName = attrs.map((a: any) => a.option).join(\" / \");\n          }\n        } catch (e) {}\n      }\n\n      // Invalidate stock cache\n      invalidateStockCache();\n\n      res.json({\n        success: true,\n        productId,\n        variationId,\n        variationName,\n        previousStock,\n        newStock: newStockLevel,\n        quantityChange,\n        ledgerEntryId: ledgerEntry.id,\n      });\n    } catch (error: any) {\n      console.error(\"Error setting variation stock:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to set variation stock level\" \n      });\n    }\n  });\n\n  // Process order and update local PostgreSQL stock\n  app.post(\"/api/process-order-stock\", requireAuth, async (req, res) => {\n    try {\n      const { orderId, orderNumber, lineItems } = req.body;\n\n      // Check if order was already processed\n      const existingProcessed = await storage.getProcessedOrder(orderId);\n      if (existingProcessed) {\n        return res.status(400).json({ \n          error: \"This order has already been processed for inventory\",\n          processedAt: existingProcessed.processedAt\n        });\n      }\n      \n      const results: any[] = [];\n      const skippedItems: any[] = [];\n      const unmappedItems: any[] = [];\n      const failedUpdates: any[] = [];\n\n      // Prefetch all raw materials from local PostgreSQL database\n      const allLocalMaterials = await storage.getLocalRawMaterials();\n      const materialsMap = new Map(allLocalMaterials.map((m) => [m.id, m]));\n\n      // Log all line items for debugging\n      console.log(`[Order ${orderNumber}] Processing ${lineItems.length} line items:`, \n        lineItems.map((i: any) => ({ \n          name: i.name, \n          product_id: i.product_id, \n          variation_id: i.variation_id, \n          quantity: i.quantity \n        }))\n      );\n\n      for (let itemIndex = 0; itemIndex < lineItems.length; itemIndex++) {\n        const item = lineItems[itemIndex];\n        console.log(`[Order ${orderNumber}] Processing line item ${itemIndex + 1}/${lineItems.length}: ${item.name} (product_id=${item.product_id}, variation_id=${item.variation_id}, qty=${item.quantity})`);\n        \n        const mappings = await storage.getMaterialMappingsForProduct(\n          item.product_id, \n          item.variation_id\n        );\n\n        console.log(`[Order ${orderNumber}] Found ${mappings.length} mapping(s) for ${item.name}`);\n\n        // Track items without any mappings\n        if (mappings.length === 0) {\n          console.log(`[Order ${orderNumber}] NO MAPPING for ${item.name} (product_id=${item.product_id}, variation_id=${item.variation_id})`);\n          unmappedItems.push({\n            productId: item.product_id,\n            variationId: item.variation_id,\n            name: item.name,\n            quantity: item.quantity,\n            reason: \"No material mapping found for this product/variation\"\n          });\n          continue;\n        }\n\n        for (const mapping of mappings) {\n          const material = materialsMap.get(mapping.materialProductId);\n          \n          // Track materials that no longer exist\n          if (!material) {\n            console.log(`[Order ${orderNumber}] SKIPPED: ${item.name} -> material ID ${mapping.materialProductId} (no longer exists)`);\n            skippedItems.push({\n              productId: item.product_id,\n              variationId: item.variation_id,\n              name: item.name,\n              materialId: mapping.materialProductId,\n              reason: \"Material product no longer exists in inventory\"\n            });\n            continue;\n          }\n          \n          // Check if this is a variation mapping\n          const isVariationMapping = mapping.materialVariationId !== null && mapping.materialVariationId !== undefined;\n          let variation: any = null;\n          \n          if (isVariationMapping && material.variations) {\n            variation = material.variations.find((v: any) => v.id === mapping.materialVariationId);\n            if (!variation) {\n              console.log(`[Order ${orderNumber}] SKIPPED: ${item.name} -> ${material.name} variation ${mapping.materialVariationId} (variation no longer exists)`);\n              skippedItems.push({\n                productId: item.product_id,\n                variationId: item.variation_id,\n                name: item.name,\n                materialId: mapping.materialProductId,\n                materialVariationId: mapping.materialVariationId,\n                reason: \"Material variation no longer exists in inventory\"\n              });\n              continue;\n            }\n          }\n          \n          // Check stock management - for variations, check the variation's manageStock\n          const manageStock = isVariationMapping && variation ? variation.manageStock : material.manageStock;\n          if (!manageStock) {\n            const displayName = isVariationMapping && variation \n              ? `${material.name} - ${variation.name}` \n              : material.name;\n            console.log(`[Order ${orderNumber}] SKIPPED: ${item.name} -> ${displayName} (stock management disabled)`);\n            skippedItems.push({\n              productId: item.product_id,\n              variationId: item.variation_id,\n              name: item.name,\n              materialId: mapping.materialProductId,\n              materialName: displayName,\n              reason: \"Material does not have stock management enabled\"\n            });\n            continue;\n          }\n          \n          const quantityToDeduct = mapping.quantityUsed * item.quantity;\n          \n          // Get correct stock based on whether it's a variation or parent material\n          const previousStock = isVariationMapping && variation \n            ? (variation.stockQuantity || 0) \n            : (material.stockQuantity || 0);\n          const newStock = previousStock - quantityToDeduct;\n          \n          const displayName = isVariationMapping && variation \n            ? `${material.name} - ${variation.name}` \n            : material.name;\n\n          console.log(`[Order ${orderNumber}] Deducting: ${item.name} -> ${displayName}: ${previousStock} - ${quantityToDeduct} = ${newStock}`);\n\n          try {\n            // Update local PostgreSQL stock - use correct function for variation vs parent\n            if (isVariationMapping && variation) {\n              await storage.updateLocalRawMaterialVariationStock(mapping.materialVariationId!, newStock);\n              // Update the variation in memory for subsequent calculations\n              variation.stockQuantity = newStock;\n            } else {\n              await storage.updateLocalRawMaterialStock(mapping.materialProductId, newStock);\n              // Update the materialsMap with new stock for subsequent calculations\n              material.stockQuantity = newStock;\n            }\n\n            const ledgerEntry = await storage.createStockLedgerEntry({\n              materialProductId: mapping.materialProductId,\n              materialVariationId: mapping.materialVariationId || null,\n              orderId,\n              orderNumber,\n              quantityChange: -quantityToDeduct,\n              previousStock,\n              newStock,\n              reason: \"order\",\n              notes: `Order #${orderNumber} - ${item.name} x${item.quantity}`,\n            });\n\n            console.log(`[Order ${orderNumber}] SUCCESS: ${item.name} -> ${displayName} (ledger entry ${ledgerEntry.id})`);\n\n            results.push({\n              materialId: mapping.materialProductId,\n              materialVariationId: mapping.materialVariationId || null,\n              materialName: displayName,\n              previousStock,\n              newStock,\n              quantityDeducted: quantityToDeduct,\n              ledgerEntryId: ledgerEntry.id,\n              lineItemName: item.name,\n            });\n          } catch (updateError: any) {\n            console.error(`[Order ${orderNumber}] FAILED to update local stock for ${displayName}:`, updateError);\n            failedUpdates.push({\n              productId: item.product_id,\n              variationId: item.variation_id,\n              name: item.name,\n              materialId: mapping.materialProductId,\n              materialName: displayName,\n              reason: `Local stock update failed: ${updateError.message || 'Unknown error'}`\n            });\n          }\n        }\n      }\n\n      // Mark order as processed\n      await storage.markOrderProcessed({ orderId, orderNumber });\n\n      // Invalidate stock cache since materials have changed\n      invalidateStockCache();\n\n      // Build response with detailed information about what happened\n      const response: any = { \n        success: true, \n        results,\n        totalItemsProcessed: results.length,\n        totalLineItems: lineItems.length\n      };\n      \n      // Include warnings if some items were skipped\n      if (unmappedItems.length > 0) {\n        response.unmappedItems = unmappedItems;\n        response.warning = `${unmappedItems.length} item(s) had no material mappings and were skipped.`;\n      }\n      \n      if (skippedItems.length > 0) {\n        response.skippedItems = skippedItems;\n        if (response.warning) {\n          response.warning += ` ${skippedItems.length} mapping(s) were skipped due to missing or unmanaged materials.`;\n        } else {\n          response.warning = `${skippedItems.length} mapping(s) were skipped due to missing or unmanaged materials.`;\n        }\n      }\n      \n      if (failedUpdates.length > 0) {\n        response.failedUpdates = failedUpdates;\n        if (response.warning) {\n          response.warning += ` ${failedUpdates.length} stock update(s) failed.`;\n        } else {\n          response.warning = `${failedUpdates.length} stock update(s) failed.`;\n        }\n      }\n\n      console.log(`[Order ${orderNumber}] Processing complete. Results: ${results.length}, Unmapped: ${unmappedItems.length}, Skipped: ${skippedItems.length}, Failed: ${failedUpdates.length}`);\n\n      res.json(response);\n    } catch (error: any) {\n      console.error(\"Error processing order stock:\", error);\n      res.status(500).json({ \n        error: error.message || \"Failed to process order stock\" \n      });\n    }\n  });\n\n  // ============================================\n  // SUPPLIERS ENDPOINTS\n  // ============================================\n\n  app.get(\"/api/suppliers\", requireAuth, async (req, res) => {\n    try {\n      const activeOnly = req.query.activeOnly !== \"false\";\n      const suppliers = await storage.getSuppliers(activeOnly);\n      res.json(suppliers);\n    } catch (error: any) {\n      console.error(\"Error fetching suppliers:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch suppliers\" });\n    }\n  });\n\n  app.get(\"/api/suppliers/statistics\", requireAuth, async (req, res) => {\n    try {\n      const stats = await storage.getSupplierStatistics();\n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"Error fetching supplier statistics:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch supplier statistics\" });\n    }\n  });\n\n  app.get(\"/api/suppliers/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const supplier = await storage.getSupplier(id);\n      if (!supplier) {\n        return res.status(404).json({ error: \"Supplier not found\" });\n      }\n      res.json(supplier);\n    } catch (error: any) {\n      console.error(\"Error fetching supplier:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch supplier\" });\n    }\n  });\n\n  app.post(\"/api/suppliers\", requireAuth, async (req, res) => {\n    try {\n      const validated = insertSupplierSchema.parse(req.body);\n      const supplier = await storage.createSupplier(validated);\n      res.status(201).json(supplier);\n    } catch (error: any) {\n      console.error(\"Error creating supplier:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Invalid supplier data\", details: error.errors });\n      }\n      res.status(500).json({ error: error.message || \"Failed to create supplier\" });\n    }\n  });\n\n  app.put(\"/api/suppliers/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validated = insertSupplierSchema.partial().parse(req.body);\n      const supplier = await storage.updateSupplier(id, validated);\n      if (!supplier) {\n        return res.status(404).json({ error: \"Supplier not found\" });\n      }\n      res.json(supplier);\n    } catch (error: any) {\n      console.error(\"Error updating supplier:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Invalid supplier data\", details: error.errors });\n      }\n      res.status(500).json({ error: error.message || \"Failed to update supplier\" });\n    }\n  });\n\n  app.delete(\"/api/suppliers/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteSupplier(id);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting supplier:\", error);\n      res.status(500).json({ error: error.message || \"Failed to delete supplier\" });\n    }\n  });\n\n  app.get(\"/api/suppliers/:id/purchase-orders\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const orders = await storage.getSupplierPurchaseOrders(id);\n      res.json(orders);\n    } catch (error: any) {\n      console.error(\"Error fetching supplier purchase orders:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch supplier purchase orders\" });\n    }\n  });\n\n  // ============================================\n  // PURCHASE ORDERS ENDPOINTS\n  // ============================================\n\n  app.get(\"/api/purchase-orders\", requireAuth, async (req, res) => {\n    try {\n      const filters = {\n        status: req.query.status as string | undefined,\n        supplierId: req.query.supplierId ? parseInt(req.query.supplierId as string) : undefined,\n        search: req.query.search as string | undefined,\n      };\n      const orders = await storage.getPurchaseOrders(filters);\n      res.json(orders);\n    } catch (error: any) {\n      console.error(\"Error fetching purchase orders:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch purchase orders\" });\n    }\n  });\n\n  app.get(\"/api/purchase-orders/next-number\", requireAuth, async (req, res) => {\n    try {\n      const poNumber = await storage.getNextPONumber();\n      res.json({ poNumber });\n    } catch (error: any) {\n      console.error(\"Error getting next PO number:\", error);\n      res.status(500).json({ error: error.message || \"Failed to get next PO number\" });\n    }\n  });\n\n  app.get(\"/api/purchase-orders/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const order = await storage.getPurchaseOrder(id);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      res.json(order);\n    } catch (error: any) {\n      console.error(\"Error fetching purchase order:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch purchase order\" });\n    }\n  });\n\n  const createPurchaseOrderSchema = z.object({\n    poNumber: z.string(),\n    supplierId: z.number(),\n    status: z.enum([\"draft\", \"ordered\", \"partially_received\", \"received\", \"cancelled\"]).optional(),\n    orderDate: z.string().nullable().optional(),\n    expectedDeliveryDate: z.string().nullable().optional(),\n    shippingCost: z.string().optional(),\n    notes: z.string().nullable().optional(),\n    items: z.array(z.object({\n      materialProductId: z.number(),\n      materialVariationId: z.number().nullable().optional(),\n      materialName: z.string(),\n      quantityOrdered: z.number(),\n      unitPrice: z.string(),\n      vatRate: z.string(),\n    })),\n  });\n\n  app.post(\"/api/purchase-orders\", requireAuth, async (req, res) => {\n    try {\n      const validated = createPurchaseOrderSchema.parse(req.body);\n      \n      // Calculate line totals and order totals\n      let subtotal = 0;\n      let vatTotal = 0;\n      const items = validated.items.map(item => {\n        const lineSubtotal = item.quantityOrdered * parseFloat(item.unitPrice);\n        const lineVat = lineSubtotal * (parseFloat(item.vatRate) / 100);\n        const lineTotal = lineSubtotal + lineVat;\n        \n        subtotal += lineSubtotal;\n        vatTotal += lineVat;\n        \n        return {\n          purchaseOrderId: 0, // Will be set by storage\n          materialProductId: item.materialProductId,\n          materialVariationId: item.materialVariationId || null,\n          materialName: item.materialName,\n          quantityOrdered: item.quantityOrdered,\n          quantityReceived: 0,\n          unitPrice: item.unitPrice,\n          vatRate: item.vatRate,\n          lineSubtotal: lineSubtotal.toFixed(2),\n          lineVat: lineVat.toFixed(2),\n          lineTotal: lineTotal.toFixed(2),\n        };\n      });\n\n      const shippingCost = parseFloat(validated.shippingCost || \"0\");\n      const grandTotal = subtotal + vatTotal + shippingCost;\n\n      const order = await storage.createPurchaseOrder({\n        poNumber: validated.poNumber,\n        supplierId: validated.supplierId,\n        status: validated.status || \"draft\",\n        orderDate: validated.orderDate ? new Date(validated.orderDate) : null,\n        expectedDeliveryDate: validated.expectedDeliveryDate ? new Date(validated.expectedDeliveryDate) : null,\n        subtotal: subtotal.toFixed(2),\n        shippingCost: shippingCost.toFixed(2),\n        vatTotal: vatTotal.toFixed(2),\n        grandTotal: grandTotal.toFixed(2),\n        notes: validated.notes || null,\n      }, items);\n\n      res.status(201).json(order);\n    } catch (error: any) {\n      console.error(\"Error creating purchase order:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Invalid purchase order data\", details: error.errors });\n      }\n      res.status(500).json({ error: error.message || \"Failed to create purchase order\" });\n    }\n  });\n\n  app.put(\"/api/purchase-orders/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validated = createPurchaseOrderSchema.partial().parse(req.body);\n      \n      // Get existing order\n      const existing = await storage.getPurchaseOrder(id);\n      if (!existing) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n\n      // Calculate new totals if items provided\n      let updateData: any = {\n        supplierId: validated.supplierId,\n        status: validated.status,\n        orderDate: validated.orderDate ? new Date(validated.orderDate) : existing.orderDate,\n        expectedDeliveryDate: validated.expectedDeliveryDate ? new Date(validated.expectedDeliveryDate) : existing.expectedDeliveryDate,\n        notes: validated.notes !== undefined ? validated.notes : existing.notes,\n      };\n\n      let items: any[] | undefined;\n      if (validated.items) {\n        let subtotal = 0;\n        let vatTotal = 0;\n        items = validated.items.map(item => {\n          const lineSubtotal = item.quantityOrdered * parseFloat(item.unitPrice);\n          const lineVat = lineSubtotal * (parseFloat(item.vatRate) / 100);\n          const lineTotal = lineSubtotal + lineVat;\n          \n          subtotal += lineSubtotal;\n          vatTotal += lineVat;\n          \n          return {\n            purchaseOrderId: id,\n            materialProductId: item.materialProductId,\n            materialVariationId: item.materialVariationId || null,\n            materialName: item.materialName,\n            quantityOrdered: item.quantityOrdered,\n            quantityReceived: 0,\n            unitPrice: item.unitPrice,\n            vatRate: item.vatRate,\n            lineSubtotal: lineSubtotal.toFixed(2),\n            lineVat: lineVat.toFixed(2),\n            lineTotal: lineTotal.toFixed(2),\n          };\n        });\n\n        const shippingCost = parseFloat(validated.shippingCost || existing.shippingCost);\n        const grandTotal = subtotal + vatTotal + shippingCost;\n\n        updateData.subtotal = subtotal.toFixed(2);\n        updateData.shippingCost = shippingCost.toFixed(2);\n        updateData.vatTotal = vatTotal.toFixed(2);\n        updateData.grandTotal = grandTotal.toFixed(2);\n      } else if (validated.shippingCost !== undefined) {\n        const shippingCost = parseFloat(validated.shippingCost);\n        const grandTotal = parseFloat(existing.subtotal) + parseFloat(existing.vatTotal) + shippingCost;\n        updateData.shippingCost = shippingCost.toFixed(2);\n        updateData.grandTotal = grandTotal.toFixed(2);\n      }\n\n      const order = await storage.updatePurchaseOrder(id, updateData, items);\n      res.json(order);\n    } catch (error: any) {\n      console.error(\"Error updating purchase order:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Invalid purchase order data\", details: error.errors });\n      }\n      res.status(500).json({ error: error.message || \"Failed to update purchase order\" });\n    }\n  });\n\n  // Add item to draft PO\n  app.post(\"/api/purchase-orders/:id/items\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const order = await storage.getPurchaseOrder(id);\n      \n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      \n      if (order.status !== \"draft\") {\n        return res.status(400).json({ error: \"Can only add items to draft purchase orders\" });\n      }\n\n      const { materialProductId, materialVariationId, materialName, quantityOrdered, unitPrice, vatRate } = req.body;\n      \n      const lineSubtotal = quantityOrdered * parseFloat(unitPrice);\n      const lineVat = lineSubtotal * (parseFloat(vatRate) / 100);\n      const lineTotal = lineSubtotal + lineVat;\n\n      const item = await storage.addPurchaseOrderItem(id, {\n        purchaseOrderId: id,\n        materialProductId,\n        materialVariationId: materialVariationId || null,\n        materialName,\n        quantityOrdered,\n        quantityReceived: 0,\n        unitPrice,\n        vatRate,\n        lineSubtotal: lineSubtotal.toFixed(2),\n        lineVat: lineVat.toFixed(2),\n        lineTotal: lineTotal.toFixed(2),\n      });\n\n      const updatedOrder = await storage.recalculatePurchaseOrderTotals(id);\n      res.status(201).json({ item, order: updatedOrder });\n    } catch (error: any) {\n      console.error(\"Error adding item to purchase order:\", error);\n      res.status(500).json({ error: error.message || \"Failed to add item\" });\n    }\n  });\n\n  // Remove item from draft PO\n  app.delete(\"/api/purchase-orders/:id/items/:itemId\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const itemId = parseInt(req.params.itemId);\n      \n      const order = await storage.getPurchaseOrder(id);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      \n      if (order.status !== \"draft\") {\n        return res.status(400).json({ error: \"Can only remove items from draft purchase orders\" });\n      }\n\n      const item = order.items.find(i => i.id === itemId);\n      if (!item) {\n        return res.status(404).json({ error: \"Item not found\" });\n      }\n\n      await storage.deletePurchaseOrderItem(itemId);\n      const updatedOrder = await storage.recalculatePurchaseOrderTotals(id);\n      res.json(updatedOrder);\n    } catch (error: any) {\n      console.error(\"Error removing item from purchase order:\", error);\n      res.status(500).json({ error: error.message || \"Failed to remove item\" });\n    }\n  });\n\n  // Update shipping details (cost and VAT)\n  app.patch(\"/api/purchase-orders/:id/shipping\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { shippingCost, shippingVatRate } = req.body;\n      \n      const order = await storage.getPurchaseOrder(id);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      \n      if (order.status !== \"draft\") {\n        return res.status(400).json({ error: \"Can only update shipping on draft purchase orders\" });\n      }\n\n      await storage.updatePurchaseOrder(id, {\n        shippingCost: parseFloat(shippingCost || \"0\").toFixed(2),\n        shippingVatRate: parseFloat(shippingVatRate || \"0\").toFixed(2),\n      });\n\n      const updatedOrder = await storage.recalculatePurchaseOrderTotals(id);\n      res.json(updatedOrder);\n    } catch (error: any) {\n      console.error(\"Error updating shipping:\", error);\n      res.status(500).json({ error: error.message || \"Failed to update shipping\" });\n    }\n  });\n\n  app.delete(\"/api/purchase-orders/:id\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const order = await storage.getPurchaseOrder(id);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n      \n      // Only allow deletion of draft or cancelled orders\n      if (order.status !== \"draft\" && order.status !== \"cancelled\") {\n        return res.status(400).json({ \n          error: \"Only draft or cancelled purchase orders can be deleted\" \n        });\n      }\n\n      await storage.deletePurchaseOrder(id);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting purchase order:\", error);\n      res.status(500).json({ error: error.message || \"Failed to delete purchase order\" });\n    }\n  });\n\n  // Receive items endpoint - updates local PostgreSQL stock and creates ledger entries\n  app.post(\"/api/purchase-orders/:id/receive\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validated = receiveItemsRequestSchema.parse(req.body);\n\n      const order = await storage.getPurchaseOrder(id);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n\n      if (order.status === \"cancelled\") {\n        return res.status(400).json({ error: \"Cannot receive items for a cancelled order\" });\n      }\n\n      if (order.status === \"received\") {\n        return res.status(400).json({ error: \"This order has already been fully received\" });\n      }\n\n      // Process each item receipt and update local PostgreSQL stock\n      const results: any[] = [];\n      const validatedReceipts: { itemId: number; quantityReceived: number }[] = [];\n      \n      for (const receipt of validated.items) {\n        const item = order.items.find(i => i.id === receipt.itemId);\n        if (!item || receipt.quantityReceived <= 0) continue;\n\n        const remainingToReceive = item.quantityOrdered - item.quantityReceived;\n        const quantityToReceive = Math.min(receipt.quantityReceived, remainingToReceive);\n        \n        if (quantityToReceive <= 0) continue;\n        \n        // Track the clamped quantities for database update\n        validatedReceipts.push({\n          itemId: receipt.itemId,\n          quantityReceived: quantityToReceive,\n        });\n\n        // Update local PostgreSQL stock\n        if (item.materialVariationId) {\n          // Get current stock from local variation\n          const variation = await storage.getLocalRawMaterialVariation(item.materialVariationId);\n          const previousStock = variation?.stockQuantity || 0;\n          const newStock = previousStock + quantityToReceive;\n          \n          // Update local variation stock\n          await storage.updateLocalRawMaterialVariationStock(item.materialVariationId, newStock);\n          \n          await storage.createStockLedgerEntry({\n            materialProductId: item.materialProductId,\n            materialVariationId: item.materialVariationId,\n            orderId: null,\n            orderNumber: order.poNumber,\n            quantityChange: quantityToReceive,\n            previousStock,\n            newStock,\n            reason: \"purchase_order\",\n            notes: `PO ${order.poNumber} - ${item.materialName} received`,\n          });\n\n          results.push({\n            itemId: item.id,\n            materialName: item.materialName,\n            quantityReceived: quantityToReceive,\n            previousStock,\n            newStock,\n          });\n        } else {\n          // Get current stock from local material\n          const material = await storage.getLocalRawMaterial(item.materialProductId);\n          const previousStock = material?.stockQuantity || 0;\n          const newStock = previousStock + quantityToReceive;\n          \n          // Update local material stock\n          await storage.updateLocalRawMaterialStock(item.materialProductId, newStock);\n          \n          await storage.createStockLedgerEntry({\n            materialProductId: item.materialProductId,\n            materialVariationId: null,\n            orderId: null,\n            orderNumber: order.poNumber,\n            quantityChange: quantityToReceive,\n            previousStock,\n            newStock,\n            reason: \"purchase_order\",\n            notes: `PO ${order.poNumber} - ${item.materialName} received`,\n          });\n\n          results.push({\n            itemId: item.id,\n            materialName: item.materialName,\n            quantityReceived: quantityToReceive,\n            previousStock,\n            newStock,\n          });\n        }\n      }\n\n      // Update the purchase order items received quantities with clamped values\n      const updatedOrder = await storage.receivePurchaseOrderItems(id, validatedReceipts);\n\n      res.json({\n        success: true,\n        order: updatedOrder,\n        results,\n      });\n    } catch (error: any) {\n      console.error(\"Error receiving purchase order items:\", error);\n      if (error.name === \"ZodError\") {\n        return res.status(400).json({ error: \"Invalid receive data\", details: error.errors });\n      }\n      res.status(500).json({ error: error.message || \"Failed to receive items\" });\n    }\n  });\n\n  // Update purchase order status\n  app.patch(\"/api/purchase-orders/:id/status\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { status } = req.body;\n      \n      const validStatuses = [\"draft\", \"ordered\", \"partially_received\", \"received\", \"cancelled\"];\n      if (!validStatuses.includes(status)) {\n        return res.status(400).json({ error: \"Invalid status\" });\n      }\n\n      const order = await storage.getPurchaseOrder(id);\n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n\n      const updatedOrder = await storage.updatePurchaseOrder(id, { status });\n      res.json(updatedOrder);\n    } catch (error: any) {\n      console.error(\"Error updating purchase order status:\", error);\n      res.status(500).json({ error: error.message || \"Failed to update status\" });\n    }\n  });\n\n  // Generate PDF for purchase order\n  app.get(\"/api/purchase-orders/:id/pdf\", requireAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const order = await storage.getPurchaseOrder(id);\n      \n      if (!order) {\n        return res.status(404).json({ error: \"Purchase order not found\" });\n      }\n\n      const credentials = await getCredentialsFromStorage();\n      const storeName = credentials?.storeUrl ? new URL(credentials.storeUrl).hostname : \"Your Company\";\n\n      const doc = new PDFDocument({ margin: 50 });\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${order.poNumber}.pdf\"`);\n      \n      doc.pipe(res);\n\n      // Header\n      doc.fontSize(24).font('Helvetica-Bold').text('PURCHASE ORDER', { align: 'center' });\n      doc.moveDown(0.5);\n      doc.fontSize(14).font('Helvetica').text(order.poNumber, { align: 'center' });\n      doc.moveDown(1.5);\n\n      // From/To section\n      const startY = doc.y;\n      \n      // From (left column)\n      doc.fontSize(10).font('Helvetica-Bold').text('FROM:', 50, startY);\n      doc.font('Helvetica').text(storeName, 50, startY + 15);\n      \n      // To (right column)\n      doc.font('Helvetica-Bold').text('TO:', 300, startY);\n      doc.font('Helvetica').text(order.supplier?.name || 'Unknown Supplier', 300, startY + 15);\n      if (order.supplier?.contactName) {\n        doc.text(`Attn: ${order.supplier.contactName}`, 300);\n      }\n      if (order.supplier?.email) {\n        doc.text(order.supplier.email, 300);\n      }\n      if (order.supplier?.phone) {\n        doc.text(order.supplier.phone, 300);\n      }\n      if (order.supplier?.address) {\n        doc.text(order.supplier.address, 300);\n      }\n\n      doc.moveDown(2);\n\n      // Dates\n      const dateY = doc.y;\n      const formatDate = (date: Date | string | null) => {\n        if (!date) return '-';\n        const d = typeof date === 'string' ? new Date(date) : date;\n        return d.toLocaleDateString('en-IE', { day: '2-digit', month: 'short', year: 'numeric' });\n      };\n      \n      doc.font('Helvetica-Bold').text('Order Date:', 50, dateY);\n      doc.font('Helvetica').text(formatDate(order.orderDate), 130, dateY);\n      doc.font('Helvetica-Bold').text('Expected Delivery:', 300, dateY);\n      doc.font('Helvetica').text(formatDate(order.expectedDeliveryDate), 410, dateY);\n      doc.font('Helvetica-Bold').text('Status:', 50, dateY + 20);\n      doc.font('Helvetica').text(order.status.replace('_', ' ').toUpperCase(), 130, dateY + 20);\n\n      doc.moveDown(3);\n\n      // Table Header\n      const tableTop = doc.y;\n      const tableLeft = 50;\n      const columnWidths = { item: 200, qty: 50, price: 80, vat: 60, total: 80 };\n      \n      doc.font('Helvetica-Bold').fontSize(10);\n      doc.rect(tableLeft, tableTop, 495, 20).fill('#f3f4f6');\n      doc.fillColor('#000');\n      doc.text('Item', tableLeft + 5, tableTop + 5);\n      doc.text('Qty', tableLeft + columnWidths.item + 5, tableTop + 5, { width: columnWidths.qty, align: 'right' });\n      doc.text('Unit Price', tableLeft + columnWidths.item + columnWidths.qty + 5, tableTop + 5, { width: columnWidths.price, align: 'right' });\n      doc.text('VAT %', tableLeft + columnWidths.item + columnWidths.qty + columnWidths.price + 5, tableTop + 5, { width: columnWidths.vat, align: 'right' });\n      doc.text('Total', tableLeft + columnWidths.item + columnWidths.qty + columnWidths.price + columnWidths.vat + 5, tableTop + 5, { width: columnWidths.total, align: 'right' });\n\n      // Table rows\n      doc.font('Helvetica').fontSize(9);\n      let rowY = tableTop + 25;\n      \n      for (const item of order.items) {\n        if (rowY > 700) {\n          doc.addPage();\n          rowY = 50;\n        }\n        \n        doc.text(item.materialName, tableLeft + 5, rowY, { width: columnWidths.item - 10 });\n        doc.text(item.quantityOrdered.toString(), tableLeft + columnWidths.item + 5, rowY, { width: columnWidths.qty, align: 'right' });\n        doc.text(`${parseFloat(item.unitPrice).toFixed(2)}`, tableLeft + columnWidths.item + columnWidths.qty + 5, rowY, { width: columnWidths.price, align: 'right' });\n        doc.text(`${parseFloat(item.vatRate).toFixed(0)}%`, tableLeft + columnWidths.item + columnWidths.qty + columnWidths.price + 5, rowY, { width: columnWidths.vat, align: 'right' });\n        doc.text(`${parseFloat(item.lineTotal).toFixed(2)}`, tableLeft + columnWidths.item + columnWidths.qty + columnWidths.price + columnWidths.vat + 5, rowY, { width: columnWidths.total, align: 'right' });\n        \n        rowY += 20;\n      }\n\n      // Line separator\n      doc.moveTo(tableLeft, rowY).lineTo(tableLeft + 495, rowY).stroke();\n      rowY += 15;\n\n      // Totals section\n      const totalsX = 370;\n      doc.font('Helvetica').fontSize(10);\n      \n      doc.text('Subtotal:', totalsX, rowY);\n      doc.text(`${parseFloat(order.subtotal).toFixed(2)}`, totalsX + 80, rowY, { width: 75, align: 'right' });\n      rowY += 18;\n\n      doc.text('Items VAT:', totalsX, rowY);\n      const itemsVat = parseFloat(order.vatTotal) - parseFloat(order.shippingVat || '0');\n      doc.text(`${itemsVat.toFixed(2)}`, totalsX + 80, rowY, { width: 75, align: 'right' });\n      rowY += 18;\n\n      doc.text('Shipping:', totalsX, rowY);\n      doc.text(`${parseFloat(order.shippingCost).toFixed(2)}`, totalsX + 80, rowY, { width: 75, align: 'right' });\n      rowY += 18;\n\n      const shippingVat = parseFloat(order.shippingVat || '0');\n      if (shippingVat > 0) {\n        doc.text('Shipping VAT:', totalsX, rowY);\n        doc.text(`${shippingVat.toFixed(2)}`, totalsX + 80, rowY, { width: 75, align: 'right' });\n        rowY += 18;\n      }\n\n      doc.font('Helvetica-Bold').fontSize(12);\n      doc.text('Grand Total:', totalsX, rowY);\n      doc.text(`${parseFloat(order.grandTotal).toFixed(2)}`, totalsX + 80, rowY, { width: 75, align: 'right' });\n\n      // Notes section\n      if (order.notes) {\n        rowY += 40;\n        doc.font('Helvetica-Bold').fontSize(10).text('Notes:', tableLeft, rowY);\n        doc.font('Helvetica').text(order.notes, tableLeft, rowY + 15, { width: 495 });\n      }\n\n      // Footer\n      doc.fontSize(8).font('Helvetica').fillColor('#666');\n      doc.text(\n        `Generated on ${new Date().toLocaleDateString('en-IE', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })}`,\n        50,\n        750,\n        { align: 'center' }\n      );\n\n      doc.end();\n    } catch (error: any) {\n      console.error(\"Error generating PDF:\", error);\n      res.status(500).json({ error: error.message || \"Failed to generate PDF\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":95916,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/pages/inventory.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useCredentials } from \"@/contexts/credentials-context\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Package, \n  Link as LinkIcon, \n  Trash2, \n  AlertTriangle,\n  CheckCircle,\n  Plus,\n  Search,\n  History,\n  TruckIcon,\n  Loader2,\n  ClipboardEdit,\n  ChevronRight,\n  ChevronDown,\n  Layers,\n  Settings2,\n  Check,\n  Pencil\n} from \"lucide-react\";\nimport { useState, useMemo, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport type { LocalRawMaterial, LocalRawMaterialVariation, LocalRawMaterialWithVariations, MaterialProductMapping } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\nimport { Download } from \"lucide-react\";\n\ninterface EnrichedMapping extends MaterialProductMapping {\n  materialName?: string;\n  productName?: string;\n  variationName?: string;\n}\n\ninterface ProductVariationSelection {\n  productId: number;\n  productName: string;\n  variationId: number;\n  variationName: string;\n  quantityUsed: number;\n  selected: boolean;\n  alreadyMapped: boolean;\n  existingMappingId?: number;\n}\n\ninterface ProductWithVariations {\n  id: number;\n  name: string;\n  type: string;\n  sku: string;\n  variations: Array<{ id: number; name: string; sku?: string }>;\n}\n\nexport default function Inventory() {\n  const { hasCredentials } = useCredentials();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [expandedProducts, setExpandedProducts] = useState<Set<number>>(new Set());\n  const [showMappingDialog, setShowMappingDialog] = useState(false);\n  const [showManageMappingsDialog, setShowManageMappingsDialog] = useState(false);\n  const [showStockDialog, setShowStockDialog] = useState(false);\n  const [showStockTakeDialog, setShowStockTakeDialog] = useState(false);\n  const [selectedMaterial, setSelectedMaterial] = useState<LocalRawMaterialWithVariations | null>(null);\n  const [selectedVariation, setSelectedVariation] = useState<LocalRawMaterialVariation | null>(null);\n  const [selectedMaterialVariation, setSelectedMaterialVariation] = useState<LocalRawMaterialVariation | null>(null);\n  const [selectedProductId, setSelectedProductId] = useState<string>(\"\");\n  const [selectedVariationId, setSelectedVariationId] = useState<string>(\"\");\n  const [quantityUsed, setQuantityUsed] = useState<number>(1);\n  const [stockQuantity, setStockQuantity] = useState<number>(1);\n  const [stockNotes, setStockNotes] = useState<string>(\"\");\n  const [stockTakeLevel, setStockTakeLevel] = useState<number>(0);\n  const [stockTakeNotes, setStockTakeNotes] = useState<string>(\"\");\n  const [bulkMappingSearch, setBulkMappingSearch] = useState<string>(\"\");\n  const [bulkSelections, setBulkSelections] = useState<Map<string, ProductVariationSelection>>(new Map());\n  const [defaultQuantity, setDefaultQuantity] = useState<number>(1);\n  const [editingMappingId, setEditingMappingId] = useState<number | null>(null);\n  const [editingQuantity, setEditingQuantity] = useState<number>(1);\n\n  const { data: localMaterials, isLoading: materialsLoading } = useQuery<LocalRawMaterialWithVariations[]>({\n    queryKey: [\"/api/local-materials\"],\n  });\n\n  const importFromWooCommerceMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/local-materials/import-from-woocommerce\");\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n      toast({\n        title: \"Import Complete\",\n        description: data.message || `Imported ${data.imported} materials.`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Import Failed\",\n        description: error.message || \"Failed to import from WooCommerce\",\n      });\n    },\n  });\n\n  const { data: productsWithVariations, isLoading: productsWithVariationsLoading } = useQuery<ProductWithVariations[]>({\n    queryKey: [\"/api/products-with-variations\"],\n    enabled: hasCredentials,\n    staleTime: 5 * 60 * 1000,\n    gcTime: 10 * 60 * 1000,\n  });\n\n  const { data: variations, isLoading: variationsLoading } = useQuery<Array<{ id: number; name: string }>>({\n    queryKey: [\"/api/products\", selectedProductId, \"variations\"],\n    queryFn: async () => {\n      const response = await fetch(`/api/products/${selectedProductId}/variations`);\n      if (!response.ok) throw new Error(\"Failed to fetch variations\");\n      return response.json();\n    },\n    enabled: !!selectedProductId && hasCredentials,\n  });\n\n  const { data: mappings, isLoading: mappingsLoading } = useQuery<MaterialProductMapping[]>({\n    queryKey: [\"/api/material-mappings\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/material-mappings\");\n      if (!response.ok) throw new Error(\"Failed to fetch mappings\");\n      return response.json();\n    },\n  });\n\n  const createMappingMutation = useMutation({\n    mutationFn: async (data: { \n      materialProductId: number; \n      materialVariationId?: number | null;\n      productId: number; \n      variationId: number; \n      quantityUsed: number;\n    }) => {\n      return apiRequest(\"POST\", \"/api/material-mappings\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/material-mappings\"] });\n      setShowMappingDialog(false);\n      setSelectedMaterial(null);\n      setSelectedMaterialVariation(null);\n      setSelectedProductId(\"\");\n      setSelectedVariationId(\"\");\n      setQuantityUsed(1);\n      toast({\n        title: \"Mapping Created\",\n        description: \"The product variation has been linked to the raw material.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create mapping\",\n      });\n    },\n  });\n\n  const deleteMappingMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/material-mappings/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/material-mappings\"] });\n      toast({\n        title: \"Mapping Deleted\",\n        description: \"The product mapping has been removed.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to delete mapping\",\n      });\n    },\n  });\n\n  const bulkCreateMappingsMutation = useMutation({\n    mutationFn: async (data: { \n      materialProductId: number; \n      materialVariationId: number | null;\n      targets: Array<{ productId: number; variationId: number | null; quantityUsed: number }>;\n    }) => {\n      return apiRequest(\"POST\", \"/api/material-mappings/bulk\", data);\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/material-mappings\"] });\n      setShowMappingDialog(false);\n      setBulkSelections(new Map());\n      setBulkMappingSearch(\"\");\n      setDefaultQuantity(1);\n      const count = Array.isArray(data) ? data.length : 0;\n      toast({\n        title: \"Mappings Created\",\n        description: `Successfully created ${count} product mapping${count !== 1 ? 's' : ''}.`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create mappings\",\n      });\n    },\n  });\n\n  const updateMappingMutation = useMutation({\n    mutationFn: async (data: { id: number; quantityUsed: number }) => {\n      return apiRequest(\"PATCH\", `/api/material-mappings/${data.id}`, { quantityUsed: data.quantityUsed });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/material-mappings\"] });\n      setEditingMappingId(null);\n      toast({\n        title: \"Mapping Updated\",\n        description: \"The quantity used has been updated.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to update mapping\",\n      });\n    },\n  });\n\n  // Add stock mutation for simple products\n  const addStockMutation = useMutation({\n    mutationFn: async (data: { materialId: number; quantity: number; notes: string }) => {\n      const response = await fetch(`/api/local-materials/${data.materialId}/add-stock`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ quantity: data.quantity, notes: data.notes || \"Stock received from supplier\" }),\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to add stock\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-ledger\"] });\n      setShowStockDialog(false);\n      setSelectedMaterial(null);\n      setSelectedVariation(null);\n      setStockQuantity(1);\n      setStockNotes(\"\");\n      toast({\n        title: \"Stock Added\",\n        description: `Added ${data.quantityAdded} units. New stock: ${data.newStock}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error Adding Stock\",\n        description: error.message || \"Failed to add stock\",\n      });\n    },\n  });\n\n  // Add stock mutation for variations\n  const addVariationStockMutation = useMutation({\n    mutationFn: async (data: { materialId: number; variationId: number; quantity: number; notes: string }) => {\n      const response = await fetch(`/api/local-materials/${data.materialId}/variations/${data.variationId}/add-stock`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ quantity: data.quantity, notes: data.notes || \"Stock received from supplier\" }),\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to add variation stock\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-ledger\"] });\n      setShowStockDialog(false);\n      setSelectedMaterial(null);\n      setSelectedVariation(null);\n      setStockQuantity(1);\n      setStockNotes(\"\");\n      toast({\n        title: \"Stock Added\",\n        description: `Added ${data.quantityAdded} units to ${data.variationName}. New stock: ${data.newStock}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error Adding Stock\",\n        description: error.message || \"Failed to add variation stock\",\n      });\n    },\n  });\n\n  // Set stock mutation for simple products\n  const setStockMutation = useMutation({\n    mutationFn: async (data: { materialId: number; newStockLevel: number; notes: string }) => {\n      const response = await fetch(`/api/local-materials/${data.materialId}/set-stock`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ newStockLevel: data.newStockLevel, notes: data.notes || \"Stock take adjustment\" }),\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to set stock\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-ledger\"] });\n      setShowStockTakeDialog(false);\n      setSelectedMaterial(null);\n      setSelectedVariation(null);\n      setStockTakeLevel(0);\n      setStockTakeNotes(\"\");\n      const changeText = data.quantityChange > 0 ? `+${data.quantityChange}` : data.quantityChange.toString();\n      toast({\n        title: \"Stock Updated\",\n        description: `Stock set to ${data.newStock} (${changeText} units)`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error Updating Stock\",\n        description: error.message || \"Failed to set stock level\",\n      });\n    },\n  });\n\n  // Set stock mutation for variations\n  const setVariationStockMutation = useMutation({\n    mutationFn: async (data: { materialId: number; variationId: number; newStockLevel: number; notes: string }) => {\n      const response = await fetch(`/api/local-materials/${data.materialId}/variations/${data.variationId}/set-stock`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ newStockLevel: data.newStockLevel, notes: data.notes || \"Stock take adjustment\" }),\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to set variation stock\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-ledger\"] });\n      setShowStockTakeDialog(false);\n      setSelectedMaterial(null);\n      setSelectedVariation(null);\n      setStockTakeLevel(0);\n      setStockTakeNotes(\"\");\n      const changeText = data.quantityChange > 0 ? `+${data.quantityChange}` : data.quantityChange.toString();\n      toast({\n        title: \"Stock Updated\",\n        description: `${data.variationName} stock set to ${data.newStock} (${changeText} units)`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error Updating Stock\",\n        description: error.message || \"Failed to set variation stock level\",\n      });\n    },\n  });\n\n  const handleAddStock = () => {\n    if (stockQuantity <= 0) return;\n    \n    if (selectedVariation && selectedMaterial) {\n      addVariationStockMutation.mutate({\n        materialId: selectedMaterial.id,\n        variationId: selectedVariation.id,\n        quantity: stockQuantity,\n        notes: stockNotes,\n      });\n    } else if (selectedMaterial) {\n      addStockMutation.mutate({\n        materialId: selectedMaterial.id,\n        quantity: stockQuantity,\n        notes: stockNotes,\n      });\n    }\n  };\n\n  const handleSetStock = () => {\n    if (stockTakeLevel < 0) return;\n    \n    if (selectedVariation && selectedMaterial) {\n      setVariationStockMutation.mutate({\n        materialId: selectedMaterial.id,\n        variationId: selectedVariation.id,\n        newStockLevel: stockTakeLevel,\n        notes: stockTakeNotes,\n      });\n    } else if (selectedMaterial) {\n      setStockMutation.mutate({\n        materialId: selectedMaterial.id,\n        newStockLevel: stockTakeLevel,\n        notes: stockTakeNotes,\n      });\n    }\n  };\n\n  const getStockBadge = (stock: number | null | undefined, manageStock: boolean) => {\n    if (!manageStock) {\n      return <Badge variant=\"outline\">Not Tracked</Badge>;\n    }\n    if (stock === null || stock === undefined) {\n      return <Badge variant=\"outline\">Unknown</Badge>;\n    }\n    if (stock <= 0) {\n      return <Badge variant=\"destructive\">Out of Stock</Badge>;\n    }\n    if (stock <= 10) {\n      return <Badge className=\"bg-amber-500 hover:bg-amber-600\">Low ({stock})</Badge>;\n    }\n    return <Badge className=\"bg-green-600 hover:bg-green-700\">{stock}</Badge>;\n  };\n\n  const getStockStatus = (stock: number | null | undefined, manageStock: boolean): \"ok\" | \"low\" | \"out\" | \"unknown\" => {\n    if (!manageStock) return \"unknown\";\n    if (stock === null || stock === undefined) return \"unknown\";\n    if (stock <= 0) return \"out\";\n    if (stock <= 10) return \"low\";\n    return \"ok\";\n  };\n\n  const toggleExpanded = (productId: number) => {\n    setExpandedProducts(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(productId)) {\n        newSet.delete(productId);\n      } else {\n        newSet.add(productId);\n      }\n      return newSet;\n    });\n  };\n\n  const filteredMaterials = localMaterials?.filter(material => {\n    const matchesSearch = material.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (material.sku && material.sku.toLowerCase().includes(searchTerm.toLowerCase()));\n    return matchesSearch;\n  });\n\n  const getMaterialMappings = (materialId: number): EnrichedMapping[] => {\n    const materialMappings = mappings?.filter(m => m.materialProductId === materialId) || [];\n    return materialMappings.map(mapping => {\n      const product = productsWithVariations?.find(p => p.id === mapping.productId);\n      const variation = product?.variations?.find(v => v.id === mapping.variationId);\n      return {\n        ...mapping,\n        materialName: localMaterials?.find(m => m.id === mapping.materialProductId)?.name,\n        productName: product?.name,\n        variationName: variation?.name || `Variation #${mapping.variationId}`,\n      };\n    });\n  };\n\n  const handleCreateMapping = () => {\n    if (!selectedMaterial || !selectedProductId || !selectedVariationId) return;\n    \n    createMappingMutation.mutate({\n      materialProductId: selectedMaterial.id,\n      materialVariationId: selectedMaterialVariation?.id || null,\n      productId: parseInt(selectedProductId),\n      variationId: parseInt(selectedVariationId),\n      quantityUsed,\n    });\n  };\n\n  const handleBulkCreateMappings = () => {\n    if (!selectedMaterial) return;\n    \n    const selectedItems = Array.from(bulkSelections.values()).filter(s => s.selected && !s.alreadyMapped);\n    if (selectedItems.length === 0) return;\n\n    const targets = selectedItems.map(item => ({\n      productId: item.productId,\n      variationId: item.variationId,\n      quantityUsed: item.quantityUsed,\n    }));\n\n    bulkCreateMappingsMutation.mutate({\n      materialProductId: selectedMaterial.id,\n      materialVariationId: selectedMaterialVariation?.id || null,\n      targets,\n    });\n  };\n\n  const initializeBulkSelections = (material: LocalRawMaterialWithVariations, materialVariation?: LocalRawMaterialVariation | null) => {\n    const existingMappings = mappings?.filter(m => \n      m.materialProductId === material.id && \n      (materialVariation ? m.materialVariationId === materialVariation.id : m.materialVariationId === null)\n    ) || [];\n\n    const newSelections = new Map<string, ProductVariationSelection>();\n    \n    if (productsWithVariations) {\n      for (const product of productsWithVariations) {\n        for (const variation of product.variations) {\n          const key = `${product.id}-${variation.id}`;\n          const existingMapping = existingMappings.find(\n            m => m.productId === product.id && m.variationId === variation.id\n          );\n          \n          newSelections.set(key, {\n            productId: product.id,\n            productName: product.name,\n            variationId: variation.id,\n            variationName: variation.name || `Variation #${variation.id}`,\n            quantityUsed: existingMapping?.quantityUsed || defaultQuantity,\n            selected: false,\n            alreadyMapped: !!existingMapping,\n            existingMappingId: existingMapping?.id,\n          });\n        }\n      }\n    }\n    \n    setBulkSelections(newSelections);\n  };\n\n  const openMappingDialog = (material: LocalRawMaterialWithVariations, materialVariation?: LocalRawMaterialVariation) => {\n    setSelectedMaterial(material);\n    setSelectedMaterialVariation(materialVariation || null);\n    setSelectedProductId(\"\");\n    setSelectedVariationId(\"\");\n    setQuantityUsed(1);\n    setDefaultQuantity(1);\n    setBulkMappingSearch(\"\");\n    setBulkSelections(new Map());\n    setShowMappingDialog(true);\n  };\n\n  useEffect(() => {\n    if (showMappingDialog && selectedMaterial && productsWithVariations && mappings) {\n      initializeBulkSelections(selectedMaterial, selectedMaterialVariation);\n    }\n  }, [showMappingDialog, selectedMaterial?.id, selectedMaterialVariation?.id, productsWithVariations, mappings]);\n\n  const openManageMappingsDialog = (material: LocalRawMaterialWithVariations, materialVariation?: LocalRawMaterialVariation) => {\n    setSelectedMaterial(material);\n    setSelectedMaterialVariation(materialVariation || null);\n    setEditingMappingId(null);\n    setShowManageMappingsDialog(true);\n  };\n\n  const toggleVariationSelection = (key: string) => {\n    setBulkSelections(prev => {\n      const newMap = new Map(prev);\n      const item = newMap.get(key);\n      if (item && !item.alreadyMapped) {\n        newMap.set(key, { ...item, selected: !item.selected });\n      }\n      return newMap;\n    });\n  };\n\n  const updateVariationQuantity = (key: string, quantity: number) => {\n    setBulkSelections(prev => {\n      const newMap = new Map(prev);\n      const item = newMap.get(key);\n      if (item) {\n        newMap.set(key, { ...item, quantityUsed: Math.max(1, quantity) });\n      }\n      return newMap;\n    });\n  };\n\n  const selectAllVisible = () => {\n    setBulkSelections(prev => {\n      const newMap = new Map(prev);\n      const filteredKeys = Array.from(prev.entries())\n        .filter(([_, item]) => {\n          if (item.alreadyMapped) return false;\n          if (!bulkMappingSearch) return true;\n          const searchLower = bulkMappingSearch.toLowerCase();\n          return item.productName.toLowerCase().includes(searchLower) || \n                 item.variationName.toLowerCase().includes(searchLower);\n        })\n        .map(([key]) => key);\n      \n      filteredKeys.forEach(key => {\n        const item = newMap.get(key);\n        if (item && !item.alreadyMapped) {\n          newMap.set(key, { ...item, selected: true });\n        }\n      });\n      return newMap;\n    });\n  };\n\n  const deselectAll = () => {\n    setBulkSelections(prev => {\n      const newMap = new Map(prev);\n      prev.forEach((item, key) => {\n        newMap.set(key, { ...item, selected: false });\n      });\n      return newMap;\n    });\n  };\n\n  const getMaterialMappingsForDialog = (): EnrichedMapping[] => {\n    if (!selectedMaterial) return [];\n    const materialMappings = mappings?.filter(m => \n      m.materialProductId === selectedMaterial.id &&\n      (selectedMaterialVariation ? m.materialVariationId === selectedMaterialVariation.id : m.materialVariationId === null)\n    ) || [];\n    \n    return materialMappings.map(mapping => {\n      const product = productsWithVariations?.find(p => p.id === mapping.productId);\n      const variation = product?.variations?.find((v: { id: number; name: string }) => v.id === mapping.variationId);\n      return {\n        ...mapping,\n        materialName: selectedMaterial.name,\n        productName: product?.name || `Product #${mapping.productId}`,\n        variationName: variation?.name || `Variation #${mapping.variationId}`,\n      };\n    });\n  };\n\n  const openAddStockDialog = (material: LocalRawMaterialWithVariations, variation?: LocalRawMaterialVariation) => {\n    setSelectedMaterial(material);\n    setSelectedVariation(variation || null);\n    setStockQuantity(1);\n    setStockNotes(\"\");\n    setShowStockDialog(true);\n  };\n\n  const openStockTakeDialog = (material: LocalRawMaterialWithVariations, variation?: LocalRawMaterialVariation) => {\n    setSelectedMaterial(material);\n    setSelectedVariation(variation || null);\n    setStockTakeLevel(variation?.stockQuantity ?? material.stockQuantity ?? 0);\n    setStockTakeNotes(\"\");\n    setShowStockTakeDialog(true);\n  };\n\n  if (!hasCredentials) {\n    return (\n      <main className=\"container mx-auto px-6 py-8\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Configure WooCommerce</CardTitle>\n            <CardDescription>\n              Please configure your WooCommerce credentials in Settings to view inventory.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Link href=\"/settings\">\n              <Button data-testid=\"button-go-to-settings\">Go to Settings</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </main>\n    );\n  }\n\n  const isAddingStock = addStockMutation.isPending || addVariationStockMutation.isPending;\n  const isSettingStock = setStockMutation.isPending || setVariationStockMutation.isPending;\n  const currentStock = selectedVariation?.stockQuantity ?? selectedMaterial?.stockQuantity ?? 0;\n\n  return (\n    <main className=\"container mx-auto px-6 py-8\">\n      <div className=\"flex flex-col gap-6\">\n        <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\" data-testid=\"text-inventory-title\">Raw Materials Inventory</h1>\n            <p className=\"text-muted-foreground\">\n              Manage your raw materials stock and product mappings\n            </p>\n          </div>\n          <Link href=\"/stock-ledger\">\n            <Button variant=\"outline\" data-testid=\"button-view-ledger\">\n              <History className=\"mr-2 h-4 w-4\" />\n              Stock Ledger\n            </Button>\n          </Link>\n        </div>\n\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search by name or SKU...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search-materials\"\n            />\n          </div>\n          <Button \n            variant=\"outline\" \n            onClick={() => importFromWooCommerceMutation.mutate()}\n            disabled={importFromWooCommerceMutation.isPending || !hasCredentials}\n            data-testid=\"button-import-from-woo\"\n          >\n            {importFromWooCommerceMutation.isPending ? (\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n            ) : (\n              <Download className=\"mr-2 h-4 w-4\" />\n            )}\n            Import from WooCommerce\n          </Button>\n        </div>\n\n        {materialsLoading ? (\n          <Card>\n            <CardContent className=\"p-0\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-10\"></TableHead>\n                    <TableHead>Product</TableHead>\n                    <TableHead>SKU</TableHead>\n                    <TableHead className=\"text-center\">Stock</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Mappings</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {[...Array(5)].map((_, i) => (\n                    <TableRow key={i}>\n                      <TableCell><Skeleton className=\"h-4 w-4\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-48\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-24\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-16 mx-auto\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-6 w-20\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-6 w-16\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-8 w-24 ml-auto\" /></TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        ) : filteredMaterials && filteredMaterials.length > 0 ? (\n          <Card>\n            <CardContent className=\"p-0\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-10\"></TableHead>\n                    <TableHead>Product</TableHead>\n                    <TableHead>SKU</TableHead>\n                    <TableHead className=\"text-center\">Stock</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Mappings</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredMaterials.map(material => {\n                    const isVariable = material.type === \"variable\" && material.variations && material.variations.length > 0;\n                    const materialMappings = getMaterialMappings(material.id);\n                    const isExpanded = expandedProducts.has(material.id);\n                    const hasLowStock = isVariable \n                      ? material.variations?.some(v => getStockStatus(v.stockQuantity, v.manageStock) === \"low\" || getStockStatus(v.stockQuantity, v.manageStock) === \"out\")\n                      : getStockStatus(material.stockQuantity, material.manageStock) !== \"ok\";\n                    \n                    return (\n                      <Collapsible key={material.id} open={isExpanded} asChild>\n                        <>\n                          <TableRow \n                            className={isVariable ? \"cursor-pointer hover:bg-muted/50\" : \"\"}\n                            data-testid={`row-material-${material.id}`}\n                          >\n                            <TableCell>\n                              {isVariable ? (\n                                <CollapsibleTrigger asChild>\n                                  <Button \n                                    variant=\"ghost\" \n                                    size=\"icon\" \n                                    className=\"h-6 w-6\"\n                                    onClick={() => toggleExpanded(material.id)}\n                                    data-testid={`button-expand-${material.id}`}\n                                  >\n                                    {isExpanded ? (\n                                      <ChevronDown className=\"h-4 w-4\" />\n                                    ) : (\n                                      <ChevronRight className=\"h-4 w-4\" />\n                                    )}\n                                  </Button>\n                                </CollapsibleTrigger>\n                              ) : (\n                                <Package className=\"h-4 w-4 text-muted-foreground\" />\n                              )}\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex items-center gap-2\">\n                                {isVariable && (\n                                  <Badge variant=\"outline\" className=\"text-xs\">\n                                    <Layers className=\"h-3 w-3 mr-1\" />\n                                    {material.variations?.length}\n                                  </Badge>\n                                )}\n                                <span className=\"font-medium\">{material.name}</span>\n                                {hasLowStock && isVariable && (\n                                  <AlertTriangle className=\"h-4 w-4 text-amber-500\" />\n                                )}\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"text-muted-foreground\">\n                              {material.sku || \"-\"}\n                            </TableCell>\n                            <TableCell className=\"text-center\">\n                              {isVariable ? (\n                                <span className=\"font-medium\">\n                                  {material.variations?.reduce((sum, v) => sum + (v.stockQuantity ?? 0), 0) ?? 0}\n                                </span>\n                              ) : (\n                                <span className=\"font-medium\">{material.stockQuantity ?? 0}</span>\n                              )}\n                            </TableCell>\n                            <TableCell>\n                              {isVariable ? (\n                                <Badge variant=\"outline\">Variable</Badge>\n                              ) : (\n                                getStockBadge(material.stockQuantity, material.manageStock)\n                              )}\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex items-center gap-2\">\n                                {materialMappings.length > 0 && (\n                                  <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={() => openManageMappingsDialog(material)}\n                                    data-testid={`button-manage-mappings-${material.id}`}\n                                  >\n                                    <Settings2 className=\"h-4 w-4 mr-1\" />\n                                    {materialMappings.length} Mapping{materialMappings.length !== 1 ? 's' : ''}\n                                  </Button>\n                                )}\n                                {!isVariable && (\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => openMappingDialog(material)}\n                                    data-testid={`button-add-mapping-${material.id}`}\n                                  >\n                                    <Plus className=\"h-4 w-4 mr-1\" />\n                                    Map\n                                  </Button>\n                                )}\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              {!isVariable && material.manageStock && (\n                                <div className=\"flex items-center justify-end gap-1\">\n                                  <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={() => openAddStockDialog(material)}\n                                    data-testid={`button-add-stock-${material.id}`}\n                                  >\n                                    <TruckIcon className=\"h-4 w-4 mr-1\" />\n                                    Add\n                                  </Button>\n                                  <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    onClick={() => openStockTakeDialog(material)}\n                                    data-testid={`button-edit-stock-${material.id}`}\n                                  >\n                                    <ClipboardEdit className=\"h-4 w-4 mr-1\" />\n                                    Edit\n                                  </Button>\n                                </div>\n                              )}\n                            </TableCell>\n                          </TableRow>\n                          \n                          {isVariable && (\n                            <CollapsibleContent asChild>\n                              <>\n                                {material.variations?.map(variation => (\n                                  <TableRow \n                                    key={variation.id} \n                                    className=\"bg-muted/30\"\n                                    data-testid={`row-variation-${variation.id}`}\n                                  >\n                                    <TableCell></TableCell>\n                                    <TableCell>\n                                      <div className=\"flex items-center gap-2 pl-6\">\n                                        <span className=\"text-muted-foreground\"></span>\n                                        <span>{variation.name}</span>\n                                      </div>\n                                    </TableCell>\n                                    <TableCell className=\"text-muted-foreground\">\n                                      {variation.sku || \"-\"}\n                                    </TableCell>\n                                    <TableCell className=\"text-center font-medium\">\n                                      {variation.stockQuantity ?? 0}\n                                    </TableCell>\n                                    <TableCell>\n                                      {getStockBadge(variation.stockQuantity, variation.manageStock)}\n                                    </TableCell>\n                                    <TableCell>\n                                      <div className=\"flex items-center gap-2\">\n                                        {(mappings?.filter(m => \n                                          m.materialProductId === material.id && \n                                          m.materialVariationId === variation.id\n                                        )?.length ?? 0) > 0 && (\n                                          <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            onClick={() => openManageMappingsDialog(material, variation)}\n                                            data-testid={`button-manage-mappings-variation-${variation.id}`}\n                                          >\n                                            <Settings2 className=\"h-4 w-4 mr-1\" />\n                                            {mappings?.filter(m => \n                                              m.materialProductId === material.id && \n                                              m.materialVariationId === variation.id\n                                            )?.length ?? 0}\n                                          </Button>\n                                        )}\n                                        <Button\n                                          variant=\"ghost\"\n                                          size=\"sm\"\n                                          onClick={() => openMappingDialog(material, variation)}\n                                          data-testid={`button-add-mapping-variation-${variation.id}`}\n                                        >\n                                          <Plus className=\"h-4 w-4 mr-1\" />\n                                          Map\n                                        </Button>\n                                      </div>\n                                    </TableCell>\n                                    <TableCell className=\"text-right\">\n                                      {variation.manageStock && (\n                                        <div className=\"flex items-center justify-end gap-1\">\n                                          <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            onClick={() => openAddStockDialog(material, variation)}\n                                            data-testid={`button-add-stock-variation-${variation.id}`}\n                                          >\n                                            <TruckIcon className=\"h-4 w-4 mr-1\" />\n                                            Add\n                                          </Button>\n                                          <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            onClick={() => openStockTakeDialog(material, variation)}\n                                            data-testid={`button-edit-stock-variation-${variation.id}`}\n                                          >\n                                            <ClipboardEdit className=\"h-4 w-4 mr-1\" />\n                                            Edit\n                                          </Button>\n                                        </div>\n                                      )}\n                                    </TableCell>\n                                  </TableRow>\n                                ))}\n                              </>\n                            </CollapsibleContent>\n                          )}\n                        </>\n                      </Collapsible>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n              <Package className=\"h-12 w-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-medium mb-2\">No Raw Materials Found</h3>\n              <p className=\"text-muted-foreground text-center max-w-md\">\n                {searchTerm \n                  ? \"No materials match your search criteria. Try adjusting your search.\"\n                  : \"Click 'Import from WooCommerce' to import materials from your Raw Materials category, or add them manually.\"}\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      {/* Add Stock Dialog */}\n      <Dialog open={showStockDialog} onOpenChange={setShowStockDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add Stock</DialogTitle>\n            <DialogDescription>\n              {selectedVariation \n                ? `Add stock to \"${selectedMaterial?.name} - ${selectedVariation.name}\"`\n                : `Add stock to \"${selectedMaterial?.name}\"`}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Current Stock</label>\n              <p className=\"text-2xl font-bold\">{currentStock} units</p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Quantity to Add</label>\n              <Input\n                type=\"number\"\n                min=\"1\"\n                value={stockQuantity}\n                onChange={(e) => setStockQuantity(parseInt(e.target.value) || 1)}\n                data-testid=\"input-add-stock-quantity\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Notes (Optional)</label>\n              <Textarea\n                value={stockNotes}\n                onChange={(e) => setStockNotes(e.target.value)}\n                placeholder=\"e.g., Supplier delivery, PO#12345\"\n                rows={2}\n                data-testid=\"input-add-stock-notes\"\n              />\n            </div>\n\n            <div className=\"bg-muted/50 rounded-lg p-4\">\n              <p className=\"text-sm font-medium\">\n                New Stock Level: <span className=\"text-green-600 dark:text-green-400\">{currentStock + stockQuantity}</span>\n              </p>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowStockDialog(false)}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleAddStock}\n              disabled={stockQuantity <= 0 || isAddingStock}\n              data-testid=\"button-confirm-add-stock\"\n            >\n              {isAddingStock ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Adding...\n                </>\n              ) : (\n                <>\n                  <TruckIcon className=\"mr-2 h-4 w-4\" />\n                  Add Stock\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Stock Take Dialog */}\n      <Dialog open={showStockTakeDialog} onOpenChange={setShowStockTakeDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Stock Take</DialogTitle>\n            <DialogDescription>\n              {selectedVariation \n                ? `Set the actual stock level for \"${selectedMaterial?.name} - ${selectedVariation.name}\"`\n                : `Set the actual stock level for \"${selectedMaterial?.name}\"`}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Current Stock (System)</label>\n              <p className=\"text-2xl font-bold\">{currentStock} units</p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Actual Stock Count</label>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                value={stockTakeLevel}\n                onChange={(e) => {\n                  const val = parseInt(e.target.value);\n                  setStockTakeLevel(isNaN(val) || val < 0 ? 0 : val);\n                }}\n                placeholder=\"Enter actual stock count...\"\n                data-testid=\"input-stock-take-level\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Enter the actual counted stock level from your stock take\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Notes (Optional)</label>\n              <Textarea\n                value={stockTakeNotes}\n                onChange={(e) => setStockTakeNotes(e.target.value)}\n                placeholder=\"e.g., Monthly stock take, found damage, etc.\"\n                rows={2}\n                data-testid=\"input-stock-take-notes\"\n              />\n            </div>\n\n            <div className={`rounded-lg p-4 border ${\n              stockTakeLevel === currentStock\n                ? \"bg-muted/50 border-border\"\n                : stockTakeLevel > currentStock\n                  ? \"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-900\"\n                  : \"bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-900\"\n            }`}>\n              {stockTakeLevel === currentStock ? (\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  No change to stock level\n                </p>\n              ) : (\n                <p className={`text-sm font-medium ${\n                  stockTakeLevel > currentStock\n                    ? \"text-green-800 dark:text-green-200\"\n                    : \"text-amber-800 dark:text-amber-200\"\n                }`}>\n                  Stock will change: {currentStock}  {stockTakeLevel} \n                  ({stockTakeLevel - currentStock > 0 ? \"+\" : \"\"}\n                  {stockTakeLevel - currentStock} units)\n                </p>\n              )}\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowStockTakeDialog(false)}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleSetStock}\n              disabled={stockTakeLevel < 0 || isSettingStock}\n              data-testid=\"button-confirm-stock-take\"\n            >\n              {isSettingStock ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Updating...\n                </>\n              ) : (\n                <>\n                  <ClipboardEdit className=\"mr-2 h-4 w-4\" />\n                  Update Stock\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Bulk Mapping Dialog */}\n      <Dialog open={showMappingDialog} onOpenChange={setShowMappingDialog}>\n        <DialogContent className=\"max-w-2xl max-h-[85vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>Map Products to Material</DialogTitle>\n            <DialogDescription>\n              {selectedMaterial \n                ? selectedMaterialVariation\n                  ? `Select product variations to link to \"${selectedMaterial.name} - ${selectedMaterialVariation.name}\"`\n                  : `Select product variations to link to \"${selectedMaterial.name}\"`\n                : \"Select a material to link\"}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedMaterialVariation && (\n            <div className=\"bg-muted/50 rounded-lg p-3 flex items-center gap-2\">\n              <Package className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-sm\">\n                <span className=\"font-medium\">Material Variation:</span>{\" \"}\n                {selectedMaterialVariation.name}\n              </span>\n            </div>\n          )}\n          \n          <div className=\"space-y-4 py-4 flex-1 overflow-hidden flex flex-col\">\n            <div className=\"flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between\">\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search products or variations...\"\n                  value={bulkMappingSearch}\n                  onChange={(e) => setBulkMappingSearch(e.target.value)}\n                  className=\"pl-10\"\n                  data-testid=\"input-bulk-mapping-search\"\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <label className=\"text-sm text-muted-foreground whitespace-nowrap\">Default qty:</label>\n                <Input\n                  type=\"number\"\n                  min=\"1\"\n                  value={defaultQuantity}\n                  onChange={(e) => setDefaultQuantity(Math.max(1, parseInt(e.target.value) || 1))}\n                  className=\"w-20\"\n                  data-testid=\"input-default-quantity\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" size=\"sm\" onClick={selectAllVisible} data-testid=\"button-select-all\">\n                <Check className=\"h-4 w-4 mr-1\" />\n                Select All\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={deselectAll} data-testid=\"button-deselect-all\">\n                Deselect All\n              </Button>\n            </div>\n\n            <div className=\"flex-1 min-h-0 border rounded-md overflow-y-auto\">\n              <div className=\"p-2 space-y-1\">\n                {productsWithVariationsLoading ? (\n                  <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    Loading products...\n                  </div>\n                ) : bulkSelections.size === 0 ? (\n                  <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n                    No product variations found\n                  </div>\n                ) : (\n                  Array.from(bulkSelections.entries())\n                    .filter(([_, item]) => {\n                      if (!bulkMappingSearch) return true;\n                      const searchLower = bulkMappingSearch.toLowerCase();\n                      return item.productName.toLowerCase().includes(searchLower) || \n                             item.variationName.toLowerCase().includes(searchLower);\n                    })\n                    .sort((a, b) => {\n                      // Sort by product name, then variation name\n                      const productCompare = a[1].productName.localeCompare(b[1].productName);\n                      if (productCompare !== 0) return productCompare;\n                      return a[1].variationName.localeCompare(b[1].variationName);\n                    })\n                    .map(([key, item]) => (\n                      <div \n                        key={key} \n                        className={`flex items-center gap-3 p-2 rounded-md hover:bg-muted/50 ${\n                          item.alreadyMapped ? 'opacity-60 bg-green-50 dark:bg-green-950/20' : ''\n                        }`}\n                        data-testid={`mapping-item-${key}`}\n                      >\n                        <Checkbox\n                          id={key}\n                          checked={item.selected || item.alreadyMapped}\n                          disabled={item.alreadyMapped}\n                          onCheckedChange={() => toggleVariationSelection(key)}\n                          data-testid={`checkbox-${key}`}\n                        />\n                        <div className=\"flex-1 min-w-0\">\n                          <label \n                            htmlFor={key}\n                            className={`text-sm font-medium cursor-pointer block truncate ${\n                              item.alreadyMapped ? 'cursor-not-allowed' : ''\n                            }`}\n                          >\n                            {item.productName}\n                          </label>\n                          <span className=\"text-xs text-muted-foreground truncate block\">\n                            {item.variationName}\n                          </span>\n                        </div>\n                        {item.alreadyMapped ? (\n                          <Badge variant=\"outline\" className=\"text-xs bg-green-100 dark:bg-green-900/30 shrink-0\">\n                            <Check className=\"h-3 w-3 mr-1\" />\n                            Mapped\n                          </Badge>\n                        ) : (\n                          <Input\n                            type=\"number\"\n                            min=\"1\"\n                            value={item.quantityUsed}\n                            onChange={(e) => updateVariationQuantity(key, parseInt(e.target.value) || 1)}\n                            className=\"w-16 h-8\"\n                            data-testid={`input-qty-${key}`}\n                          />\n                        )}\n                      </div>\n                    ))\n                )}\n              </div>\n            </div>\n\n            <div className=\"bg-muted/50 rounded-lg p-3\">\n              <p className=\"text-sm font-medium\">\n                Selected: {Array.from(bulkSelections.values()).filter(s => s.selected && !s.alreadyMapped).length} new mapping{Array.from(bulkSelections.values()).filter(s => s.selected && !s.alreadyMapped).length !== 1 ? 's' : ''}\n                {Array.from(bulkSelections.values()).filter(s => s.alreadyMapped).length > 0 && (\n                  <span className=\"text-muted-foreground ml-2\">\n                    ({Array.from(bulkSelections.values()).filter(s => s.alreadyMapped).length} already mapped)\n                  </span>\n                )}\n              </p>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowMappingDialog(false)}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleBulkCreateMappings}\n              disabled={\n                Array.from(bulkSelections.values()).filter(s => s.selected && !s.alreadyMapped).length === 0 || \n                bulkCreateMappingsMutation.isPending\n              }\n              data-testid=\"button-confirm-bulk-mapping\"\n            >\n              {bulkCreateMappingsMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Creating...\n                </>\n              ) : (\n                <>\n                  <LinkIcon className=\"mr-2 h-4 w-4\" />\n                  Create Mappings\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Manage Mappings Dialog */}\n      <Dialog open={showManageMappingsDialog} onOpenChange={setShowManageMappingsDialog}>\n        <DialogContent className=\"max-w-xl max-h-[80vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>Manage Mappings</DialogTitle>\n            <DialogDescription>\n              {selectedMaterial \n                ? selectedMaterialVariation\n                  ? `Product mappings for \"${selectedMaterial.name} - ${selectedMaterialVariation.name}\"`\n                  : `Product mappings for \"${selectedMaterial.name}\"`\n                : \"Select a material\"}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <ScrollArea className=\"flex-1\">\n            <div className=\"space-y-2 py-4\">\n              {getMaterialMappingsForDialog().length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  No mappings found for this material.\n                </div>\n              ) : (\n                getMaterialMappingsForDialog().map(mapping => (\n                  <div \n                    key={mapping.id} \n                    className=\"flex items-center gap-3 p-3 border rounded-lg\"\n                    data-testid={`manage-mapping-${mapping.id}`}\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium truncate\">{mapping.productName}</p>\n                      <p className=\"text-xs text-muted-foreground truncate\">{mapping.variationName}</p>\n                    </div>\n                    \n                    {editingMappingId === mapping.id ? (\n                      <div className=\"flex items-center gap-2\">\n                        <Input\n                          type=\"number\"\n                          min=\"1\"\n                          value={editingQuantity}\n                          onChange={(e) => setEditingQuantity(Math.max(1, parseInt(e.target.value) || 1))}\n                          className=\"w-20 h-8\"\n                          data-testid={`input-edit-qty-${mapping.id}`}\n                        />\n                        <Button\n                          size=\"sm\"\n                          onClick={() => updateMappingMutation.mutate({ id: mapping.id, quantityUsed: editingQuantity })}\n                          disabled={updateMappingMutation.isPending}\n                          data-testid={`button-save-qty-${mapping.id}`}\n                        >\n                          {updateMappingMutation.isPending ? (\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          ) : (\n                            <Check className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => setEditingMappingId(null)}\n                        >\n                          Cancel\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\">\n                          Qty: {mapping.quantityUsed}\n                        </Badge>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => {\n                            setEditingMappingId(mapping.id);\n                            setEditingQuantity(mapping.quantityUsed);\n                          }}\n                          data-testid={`button-edit-mapping-${mapping.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          className=\"text-destructive hover:text-destructive\"\n                          onClick={() => deleteMappingMutation.mutate(mapping.id)}\n                          disabled={deleteMappingMutation.isPending}\n                          data-testid={`button-delete-mapping-${mapping.id}`}\n                        >\n                          {deleteMappingMutation.isPending ? (\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\n                          ) : (\n                            <Trash2 className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                ))\n              )}\n            </div>\n          </ScrollArea>\n\n          <DialogFooter className=\"flex-row justify-between sm:justify-between gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => {\n                setShowManageMappingsDialog(false);\n                if (selectedMaterial) {\n                  openMappingDialog(selectedMaterial, selectedMaterialVariation || undefined);\n                }\n              }}\n              data-testid=\"button-add-more-mappings\"\n            >\n              <Plus className=\"h-4 w-4 mr-1\" />\n              Add More\n            </Button>\n            <Button variant=\"outline\" onClick={() => setShowManageMappingsDialog(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </main>\n  );\n}\n","path":null,"size_bytes":62291,"size_tokens":null},"replit.md":{"content":"# WooCommerce Order Reports Dashboard\n\n## Overview\n\nThis project provides a professional analytics and reporting dashboard for WooCommerce store owners. It offers comprehensive order analysis, real-time data visualization, detailed order management, and raw materials inventory tracking. The system aims to enhance business decision-making by providing insights into sales performance, inventory levels, and order fulfillment processes. Key capabilities include custom order status support, secure credential management, dark mode, CSV export functionality, and username/password authentication for secure access.\n\n## Authentication\n\n- **Username/Password Login**: Secure authentication system to protect the dashboard\n  - Register new account with username and password (minimum 6 characters)\n  - Password hashing using scrypt algorithm with random salt\n  - Session-based authentication with PostgreSQL session store\n  - All API routes protected - require authentication to access\n  - Secure session cookies with 7-day expiration\n  - Logout properly destroys session and clears cookies\n\n## User Preferences\n\n- **Credentials**: Securely stored in PostgreSQL database with AES-256-GCM encryption\n  - Store URL, Consumer Key, and Consumer Secret encrypted at rest\n  - Key derived from SESSION_SECRET using scrypt algorithm\n  - Frontend only checks credential status (configured: true/false)\n  - Credentials never exposed to browser after initial save\n  - Can be updated or deleted anytime via Settings page\n\n- **Theme Preference**: Persisted in localStorage as `wc-reports-theme`\n  - Supports light and dark modes\n  - Automatically applied on page load\n\n## System Architecture\n\nThe application is built with a React frontend and a Node.js/Express backend.\n\n### UI/UX Decisions\n- **Design System**: Professional aesthetic with blue primary color (`hsl(217 91% 35%)`) for trust and reliability.\n- **Typography**: IBM Plex Sans font with a hierarchical sizing structure.\n- **Currency**: All monetary values consistently displayed in Euros () with two decimal places.\n- **Spacing**: Consistent 4/6/8/12 unit system for padding and gaps.\n- **Theming**: Dark mode support with persistence via local storage, smooth transitions, and optimized color contrast.\n\n### Technical Implementations\n- **Frontend**: React, TypeScript, Tailwind CSS, Shadcn UI, Recharts for data visualization, and TanStack Query for state management.\n- **Backend**: Node.js with Express framework, interacting with the WooCommerce REST API and a PostgreSQL database.\n- **Database**: PostgreSQL with Drizzle ORM for persistent storage of inventory data, material mappings, encrypted credentials, and local raw materials.\n- **Credential Management**: WooCommerce API credentials are encrypted using AES-256-GCM with scrypt key derivation and stored securely in the database.\n- **Order Statuses**: Dynamic detection and display of all WooCommerce custom order statuses, with smart color-coding. Internal statuses like \"checkout-draft\" (incomplete checkout sessions) are automatically excluded from the orders list and all calculations.\n- **Inventory Tracking**: \n  - **Local PostgreSQL Storage**: All raw materials data fully migrated to local PostgreSQL database (tables: `local_raw_materials`, `local_raw_material_variations`)\n  - Support for both simple and variable products with expandable table UI\n  - Variation-specific stock tracking with attribute display\n  - Product-material mappings with bulk mapping capabilities\n  - Mapping management UI with inline editing\n  - Comprehensive stock ledger with material_variation_id support\n  - All stock operations (order processing, purchase order receiving, stock take, manual adjustments) update local PostgreSQL directly\n  - WooCommerce product IDs preserved as local material IDs for compatibility with existing mappings, ledger entries, and purchase orders\n  - One-time import endpoint (`POST /api/local-materials/import-from-woocommerce`) to migrate materials from WooCommerce\n- **Data Export**: Server-side CSV generation with filter support.\n\n### Feature Specifications\n- **Analytics Dashboard**: Displays key metrics (revenue, orders, AOV, total taxes, pending orders) and interactive charts for trends and status distribution.\n- **Orders Management**: Filterable, searchable, and responsive orders table with detailed order views including product variations (size, color, frame type, etc.) displayed in the order details modal.\n- **Inventory Processing**: Manual stock deduction from raw materials based on processed orders and product mappings.\n- **Stock Ledger**: Detailed transaction history for all inventory changes.\n- **Stock Take Feature**: Allows setting absolute stock levels during physical counts, with detailed logging and preview of changes.\n- **Purchase Order System**: Complete PO management with the following capabilities:\n  - Supplier management with contact details and active status tracking\n  - Create purchase orders with line items, VAT rates (0%, 13.5%, 23%), and shipping costs\n  - Shipping VAT tracking with separate rate configuration and calculated VAT amounts\n  - Draft PO editing: add/remove line items and update shipping details before ordering\n  - Status workflow: Draft  Ordered  Partially Received  Received (or Cancelled)\n  - Checkbox-based receiving workflow for marking items as received when they arrive\n  - PDF generation and download for purchase orders\n  - Automatic stock updates when items are received (creates stock ledger entries)\n- **Customers Management**: Complete customer management with the following capabilities:\n  - Searchable customer list with sortable columns (name, email, country, orders, total spent)\n  - Customer details modal showing contact info, billing/shipping addresses, order summary\n  - Order history display for each customer with status badges\n  - Average order value calculation\n  - Uses WooCommerce's native customer data with accurate order counts and total spent\n\n## External Dependencies\n\n- **WooCommerce REST API**: Primary integration for fetching order data, customer data, and managing order statuses. Raw materials stock is managed locally in PostgreSQL.\n- **PostgreSQL**: Relational database used for storing encrypted WooCommerce credentials, material product mappings, stock ledger entries, processed order information, local raw materials, and purchase orders.\n- **Recharts**: JavaScript charting library for interactive data visualizations on the dashboard.\n- **Shadcn UI**: UI component library for building accessible and customizable user interfaces.","path":null,"size_bytes":6574,"size_tokens":null},"server/woocommerce.ts":{"content":"import WooCommerceRestApi from \"@woocommerce/woocommerce-rest-api\";\nimport { apiCache, cacheKeys, CACHE_TTL } from \"./cache\";\n\nconst WooCommerce = WooCommerceRestApi.default || WooCommerceRestApi;\n\nconst EXCLUDED_ORDER_STATUSES = [\"checkout-draft\"];\n\nexport interface WooCommerceCredentials {\n  storeUrl: string;\n  consumerKey: string;\n  consumerSecret: string;\n}\n\nexport function createWooCommerceClient(credentials: WooCommerceCredentials) {\n  return new WooCommerce({\n    url: credentials.storeUrl,\n    consumerKey: credentials.consumerKey,\n    consumerSecret: credentials.consumerSecret,\n    version: \"wc/v3\",\n  });\n}\n\nexport async function fetchOrders(\n  credentials: WooCommerceCredentials,\n  params: {\n    after?: string;\n    before?: string;\n    status?: string;\n    per_page?: number;\n    page?: number;\n  } = {}\n) {\n  // Build cache key from params\n  const cacheKey = cacheKeys.orders(params.after || 'all', params.status);\n  \n  // Check cache first\n  const cached = apiCache.get<any[]>(cacheKey);\n  if (cached) {\n    console.log(`[Cache HIT] orders - ${cacheKey}`);\n    return cached;\n  }\n  \n  console.log(`[Cache MISS] orders - ${cacheKey}`);\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(\"orders\", {\n      per_page: params.per_page || 100,\n      page: params.page || 1,\n      after: params.after,\n      before: params.before,\n      status: params.status || \"any\",\n    });\n    \n    // Filter out excluded statuses (e.g., checkout-draft which are incomplete checkout sessions)\n    const filteredOrders = response.data.filter(\n      (order: any) => !EXCLUDED_ORDER_STATUSES.includes(order.status)\n    );\n    \n    // Cache the result\n    apiCache.set(cacheKey, filteredOrders, CACHE_TTL.ORDERS);\n    \n    return filteredOrders;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch orders from WooCommerce\");\n  }\n}\n\nexport async function fetchOrderStatuses(credentials: WooCommerceCredentials) {\n  const cacheKey = cacheKeys.orderStatuses();\n  \n  // Check cache first\n  const cached = apiCache.get<any[]>(cacheKey);\n  if (cached) {\n    console.log(`[Cache HIT] order-statuses`);\n    return cached;\n  }\n  \n  console.log(`[Cache MISS] order-statuses`);\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(\"reports/orders/totals\");\n    const result = response.data\n      .filter((status: any) => !EXCLUDED_ORDER_STATUSES.includes(status.slug))\n      .map((status: any) => ({\n        slug: status.slug,\n        name: status.name,\n        total: status.total,\n      }));\n    \n    // Cache the result\n    apiCache.set(cacheKey, result, CACHE_TTL.ORDER_STATUSES);\n    \n    return result;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching statuses:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch order statuses\");\n  }\n}\n\nexport async function fetchCategories(credentials: WooCommerceCredentials) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(\"products/categories\", {\n      per_page: 100,\n    });\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching categories:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch categories\");\n  }\n}\n\nexport async function fetchProductsByCategory(\n  credentials: WooCommerceCredentials, \n  categoryId: number\n) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(\"products\", {\n      category: categoryId,\n      per_page: 100,\n      status: \"publish\",\n    });\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching products:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch products\");\n  }\n}\n\nexport async function fetchRawMaterials(credentials: WooCommerceCredentials) {\n  const cacheKey = cacheKeys.rawMaterials();\n  \n  // Check cache first\n  const cached = apiCache.get<any[]>(cacheKey);\n  if (cached) {\n    console.log(`[Cache HIT] raw-materials`);\n    return cached;\n  }\n  \n  console.log(`[Cache MISS] raw-materials - fetching from WooCommerce (this may take a while)...`);\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const categoriesResponse = await client.get(\"products/categories\", {\n      per_page: 100,\n    });\n    \n    const rawMaterialsCategory = categoriesResponse.data.find(\n      (cat: any) => cat.slug === \"raw-materials\" || cat.name.toLowerCase() === \"raw materials\"\n    );\n    \n    if (!rawMaterialsCategory) {\n      return [];\n    }\n    \n    const childCategories = categoriesResponse.data.filter(\n      (cat: any) => cat.parent === rawMaterialsCategory.id\n    );\n    \n    const categoryIds = [rawMaterialsCategory.id, ...childCategories.map((c: any) => c.id)];\n    \n    let allProducts: any[] = [];\n    for (const catId of categoryIds) {\n      // Fetch published products\n      const publishedResponse = await client.get(\"products\", {\n        category: catId,\n        per_page: 100,\n        status: \"publish\",\n      });\n      allProducts = [...allProducts, ...publishedResponse.data];\n      \n      // Also fetch private products (raw materials hidden from storefront)\n      const privateResponse = await client.get(\"products\", {\n        category: catId,\n        per_page: 100,\n        status: \"private\",\n      });\n      allProducts = [...allProducts, ...privateResponse.data];\n    }\n    \n    const uniqueProducts = Array.from(\n      new Map(allProducts.map((p: any) => [p.id, p])).values()\n    );\n    \n    // For variable products, fetch their variations\n    const productsWithVariations = await Promise.all(\n      uniqueProducts.map(async (product: any) => {\n        const baseProduct = {\n          id: product.id,\n          name: product.name,\n          type: product.type === \"variable\" ? \"variable\" : \"simple\",\n          sku: product.sku || \"\",\n          stock_quantity: product.stock_quantity,\n          stock_status: product.stock_status,\n          manage_stock: product.manage_stock,\n          categories: product.categories,\n          images: product.images,\n        };\n        \n        // If variable product, fetch variations with stock data\n        if (product.type === \"variable\") {\n          try {\n            const variationsResponse = await client.get(`products/${product.id}/variations`, {\n              per_page: 100,\n            });\n            \n            const variations = variationsResponse.data.map((v: any) => ({\n              id: v.id,\n              parentId: product.id,\n              name: v.attributes?.map((a: any) => a.option).join(\" / \") || `Variation ${v.id}`,\n              sku: v.sku || \"\",\n              stock_quantity: v.stock_quantity,\n              stock_status: v.stock_status,\n              manage_stock: v.manage_stock,\n              attributes: v.attributes || [],\n            }));\n            \n            // Calculate total stock from variations\n            const totalStock = variations.reduce(\n              (sum: number, v: any) => sum + (v.stock_quantity || 0), \n              0\n            );\n            \n            return {\n              ...baseProduct,\n              stock_quantity: totalStock,\n              variations,\n            };\n          } catch (err) {\n            console.error(`Failed to fetch variations for product ${product.id}:`, err);\n            return baseProduct;\n          }\n        }\n        \n        return baseProduct;\n      })\n    );\n    \n    // Cache the result\n    apiCache.set(cacheKey, productsWithVariations, CACHE_TTL.RAW_MATERIALS);\n    console.log(`[Cache SET] raw-materials - cached ${productsWithVariations.length} materials`);\n    \n    return productsWithVariations;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching raw materials:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch raw materials\");\n  }\n}\n\nexport async function fetchVariableProducts(credentials: WooCommerceCredentials) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    // Fetch published variable products\n    const publishedResponse = await client.get(\"products\", {\n      type: \"variable\",\n      per_page: 100,\n      status: \"publish\",\n    });\n    \n    // Also fetch private variable products (raw materials hidden from storefront)\n    const privateResponse = await client.get(\"products\", {\n      type: \"variable\",\n      per_page: 100,\n      status: \"private\",\n    });\n    \n    const allProducts = [...publishedResponse.data, ...privateResponse.data];\n    \n    return allProducts.map((product: any) => ({\n      id: product.id,\n      name: product.name,\n      type: product.type,\n      sku: product.sku || \"\",\n      variations: product.variations || [],\n    }));\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching variable products:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch variable products\");\n  }\n}\n\nexport async function fetchProductVariations(credentials: WooCommerceCredentials, productId: number) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(`products/${productId}/variations`, {\n      per_page: 100,\n    });\n    \n    return response.data.map((variation: any) => ({\n      id: variation.id,\n      sku: variation.sku || \"\",\n      attributes: variation.attributes || [],\n      name: variation.attributes?.map((a: any) => a.option).join(\" - \") || `Variation ${variation.id}`,\n    }));\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching variations:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch product variations\");\n  }\n}\n\nexport async function fetchAllProductsWithVariations(credentials: WooCommerceCredentials) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const publishedResponse = await client.get(\"products\", {\n      type: \"variable\",\n      per_page: 100,\n      status: \"publish\",\n    });\n    \n    const privateResponse = await client.get(\"products\", {\n      type: \"variable\",\n      per_page: 100,\n      status: \"private\",\n    });\n    \n    const allProducts = [...publishedResponse.data, ...privateResponse.data];\n    \n    const productsWithVariations = await Promise.all(\n      allProducts.map(async (product: any) => {\n        try {\n          const variationsResponse = await client.get(`products/${product.id}/variations`, {\n            per_page: 100,\n          });\n          \n          const variations = variationsResponse.data.map((variation: any) => ({\n            id: variation.id,\n            sku: variation.sku || \"\",\n            attributes: variation.attributes || [],\n            name: variation.attributes?.map((a: any) => a.option).join(\" - \") || `Variation ${variation.id}`,\n          }));\n          \n          return {\n            id: product.id,\n            name: product.name,\n            type: product.type,\n            sku: product.sku || \"\",\n            variations,\n          };\n        } catch (err) {\n          console.error(`Failed to fetch variations for product ${product.id}:`, err);\n          return {\n            id: product.id,\n            name: product.name,\n            type: product.type,\n            sku: product.sku || \"\",\n            variations: [],\n          };\n        }\n      })\n    );\n    \n    return productsWithVariations;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching products with variations:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch products with variations\");\n  }\n}\n\nexport async function updateProductStock(\n  credentials: WooCommerceCredentials,\n  productId: number,\n  stockQuantity: number\n) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.put(`products/${productId}`, {\n      stock_quantity: stockQuantity,\n      manage_stock: true,\n    });\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error updating stock:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to update product stock\");\n  }\n}\n\nexport async function updateVariationStock(\n  credentials: WooCommerceCredentials,\n  productId: number,\n  variationId: number,\n  stockQuantity: number\n) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.put(`products/${productId}/variations/${variationId}`, {\n      stock_quantity: stockQuantity,\n      manage_stock: true,\n    });\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error updating variation stock:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to update variation stock\");\n  }\n}\n\nexport async function getVariationById(\n  credentials: WooCommerceCredentials,\n  productId: number,\n  variationId: number\n) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(`products/${productId}/variations/${variationId}`);\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching variation:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch variation\");\n  }\n}\n\nexport async function updateOrderStatus(\n  credentials: WooCommerceCredentials,\n  orderId: number,\n  status: string\n) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.put(`orders/${orderId}`, {\n      status: status,\n    });\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error updating order:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to update order status\");\n  }\n}\n\nexport async function getProductById(\n  credentials: WooCommerceCredentials,\n  productId: number\n) {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(`products/${productId}`);\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching product:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch product\");\n  }\n}\n\nexport async function getOrderStats(orders: any[]) {\n  const totalRevenue = orders.reduce((sum, order) => {\n    return sum + parseFloat(order.total || \"0\");\n  }, 0);\n\n  const totalOrders = orders.length;\n  const averageOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;\n\n  const ordersByStatus = orders.reduce((acc, order) => {\n    const status = order.status || \"unknown\";\n    acc[status] = (acc[status] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  return {\n    totalRevenue,\n    totalOrders,\n    averageOrderValue,\n    ordersByStatus,\n  };\n}\n\nexport function getDateRange(preset: string): { after: string; before?: string } {\n  const now = new Date();\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  \n  switch (preset) {\n    case \"today\":\n      return {\n        after: today.toISOString(),\n      };\n    \n    case \"last7days\":\n      const sevenDaysAgo = new Date(today);\n      sevenDaysAgo.setDate(today.getDate() - 7);\n      return {\n        after: sevenDaysAgo.toISOString(),\n      };\n    \n    case \"last30days\":\n      const thirtyDaysAgo = new Date(today);\n      thirtyDaysAgo.setDate(today.getDate() - 30);\n      return {\n        after: thirtyDaysAgo.toISOString(),\n      };\n    \n    case \"last90days\":\n      const ninetyDaysAgo = new Date(today);\n      ninetyDaysAgo.setDate(today.getDate() - 90);\n      return {\n        after: ninetyDaysAgo.toISOString(),\n      };\n    \n    default:\n      const defaultDaysAgo = new Date(today);\n      defaultDaysAgo.setDate(today.getDate() - 30);\n      return {\n        after: defaultDaysAgo.toISOString(),\n      };\n  }\n}\n\nexport function generateOrderTrends(orders: any[]): Array<{ date: string; orders: number; revenue: number }> {\n  const trendMap = new Map<string, { orders: number; revenue: number }>();\n\n  orders.forEach((order) => {\n    const date = new Date(order.date_created).toISOString().split(\"T\")[0];\n    const existing = trendMap.get(date) || { orders: 0, revenue: 0 };\n    \n    trendMap.set(date, {\n      orders: existing.orders + 1,\n      revenue: existing.revenue + parseFloat(order.total || \"0\"),\n    });\n  });\n\n  return Array.from(trendMap.entries())\n    .map(([date, data]) => ({\n      date,\n      orders: data.orders,\n      revenue: Math.round(data.revenue * 100) / 100,\n    }))\n    .sort((a, b) => a.date.localeCompare(b.date));\n}\n\nexport interface Customer {\n  id: number;\n  email: string;\n  first_name: string;\n  last_name: string;\n  username: string;\n  billing: {\n    first_name: string;\n    last_name: string;\n    company: string;\n    address_1: string;\n    address_2: string;\n    city: string;\n    state: string;\n    postcode: string;\n    country: string;\n    email: string;\n    phone: string;\n  };\n  shipping: {\n    first_name: string;\n    last_name: string;\n    company: string;\n    address_1: string;\n    address_2: string;\n    city: string;\n    state: string;\n    postcode: string;\n    country: string;\n  };\n  is_paying_customer: boolean;\n  avatar_url: string;\n  date_created: string;\n  date_modified: string;\n  orders_count?: number;\n  total_spent?: string;\n}\n\nexport async function fetchCustomers(\n  credentials: WooCommerceCredentials,\n  params: {\n    per_page?: number;\n    page?: number;\n    search?: string;\n    role?: string;\n  } = {}\n): Promise<Customer[]> {\n  const cacheKey = cacheKeys.customers();\n  \n  // Only use cache if no search param (cache full list only)\n  if (!params.search) {\n    const cached = apiCache.get<Customer[]>(cacheKey);\n    if (cached) {\n      console.log(`[Cache HIT] customers`);\n      return cached;\n    }\n  }\n  \n  console.log(`[Cache MISS] customers - fetching from WooCommerce...`);\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    // Fetch all customers with pagination\n    let allCustomers: Customer[] = [];\n    let page = 1;\n    const perPage = params.per_page || 100;\n    let hasMore = true;\n    \n    while (hasMore) {\n      const response = await client.get(\"customers\", {\n        per_page: perPage,\n        page: page,\n        role: params.role || \"all\",\n        search: params.search,\n      });\n      \n      allCustomers = [...allCustomers, ...response.data];\n      \n      // Check if there are more pages\n      const totalPages = parseInt(response.headers['x-wp-totalpages'] || '1');\n      hasMore = page < totalPages;\n      page++;\n      \n      // Safety limit to prevent infinite loops\n      if (page > 50) break;\n    }\n    \n    // Cache only the full list (no search)\n    if (!params.search) {\n      apiCache.set(cacheKey, allCustomers, CACHE_TTL.CUSTOMERS);\n      console.log(`[Cache SET] customers - cached ${allCustomers.length} customers`);\n    }\n    \n    return allCustomers;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching customers:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch customers from WooCommerce\");\n  }\n}\n\nexport async function fetchCustomerById(\n  credentials: WooCommerceCredentials,\n  customerId: number\n): Promise<Customer> {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(`customers/${customerId}`);\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching customer:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch customer\");\n  }\n}\n\nexport async function fetchCustomerOrders(\n  credentials: WooCommerceCredentials,\n  customerId: number\n): Promise<any[]> {\n  const client = createWooCommerceClient(credentials);\n  \n  try {\n    const response = await client.get(\"orders\", {\n      customer: customerId,\n      per_page: 100,\n    });\n    return response.data;\n  } catch (error: any) {\n    console.error(\"WooCommerce API Error fetching customer orders:\", error.response?.data || error.message);\n    throw new Error(error.response?.data?.message || \"Failed to fetch customer orders\");\n  }\n}\n","path":null,"size_bytes":20699,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/status-badge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\n\ninterface StatusBadgeProps {\n  status: string;\n}\n\nfunction getStatusVariant(status: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  const statusLower = status.toLowerCase();\n  \n  if (statusLower.includes(\"complet\") || statusLower.includes(\"deliver\")) {\n    return \"default\";\n  }\n  \n  if (statusLower.includes(\"process\") || statusLower.includes(\"ship\")) {\n    return \"secondary\";\n  }\n  \n  if (statusLower.includes(\"cancel\") || statusLower.includes(\"refund\") || statusLower.includes(\"fail\")) {\n    return \"destructive\";\n  }\n  \n  return \"outline\";\n}\n\nfunction formatStatusLabel(status: string): string {\n  return status\n    .split('-')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n}\n\nexport function StatusBadge({ status }: StatusBadgeProps) {\n  const variant = getStatusVariant(status);\n  const label = formatStatusLabel(status);\n  \n  return (\n    <Badge variant={variant} data-testid={`badge-status-${status}`}>\n      {label}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":1044,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"IBM Plex Sans\", \"Inter\", \"system-ui\", \"sans-serif\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"IBM Plex Mono\", \"monospace\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4093,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { wooCommerceConfigSchema, type WooCommerceConfig } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCredentials } from \"@/contexts/credentials-context\";\nimport { Save, ShoppingBag, CheckCircle, Loader2, Trash2 } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function Settings() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { hasCredentials, storeUrl, isLoading, saveCredentials, deleteCredentials } = useCredentials();\n\n  const form = useForm<WooCommerceConfig>({\n    resolver: zodResolver(wooCommerceConfigSchema),\n    defaultValues: {\n      storeUrl: \"\",\n      consumerKey: \"\",\n      consumerSecret: \"\",\n    },\n  });\n\n  const onSubmit = async (data: WooCommerceConfig) => {\n    setIsSubmitting(true);\n    try {\n      await saveCredentials(data.storeUrl, data.consumerKey, data.consumerSecret);\n\n      toast({\n        title: \"Settings saved\",\n        description: \"Your WooCommerce credentials have been securely stored on the server.\",\n      });\n\n      form.reset();\n\n      setTimeout(() => {\n        setLocation(\"/\");\n      }, 1000);\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error saving credentials\",\n        description: error.message || \"Failed to save credentials\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleDeleteCredentials = async () => {\n    try {\n      await deleteCredentials();\n      toast({\n        title: \"Credentials deleted\",\n        description: \"Your WooCommerce credentials have been removed.\",\n      });\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to delete credentials\",\n      });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-3xl mx-auto py-8 px-6\">\n        <div className=\"flex items-center justify-center py-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container max-w-3xl mx-auto py-8 px-6\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-3 mb-2\">\n          <div className=\"p-2 bg-primary/10 rounded-md\">\n            <ShoppingBag className=\"h-6 w-6 text-primary\" />\n          </div>\n          <h1 className=\"text-3xl font-bold\" data-testid=\"text-settings-title\">\n            WooCommerce Settings\n          </h1>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Configure your WooCommerce store connection to start viewing order reports and analytics.\n        </p>\n      </div>\n\n      {hasCredentials && (\n        <Card className=\"mb-6 border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/30\">\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                <CardTitle className=\"text-green-800 dark:text-green-200\">Connected</CardTitle>\n              </div>\n              <Badge variant=\"secondary\" className=\"font-mono text-xs\">\n                {storeUrl}\n              </Badge>\n            </div>\n          </CardHeader>\n          <CardContent className=\"pt-0\">\n            <p className=\"text-sm text-green-700 dark:text-green-300 mb-4\">\n              Your WooCommerce credentials are securely stored. You can update them below or delete them to disconnect.\n            </p>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleDeleteCredentials}\n              className=\"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-950/30\"\n              data-testid=\"button-delete-credentials\"\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Disconnect Store\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>{hasCredentials ? \"Update Credentials\" : \"API Credentials\"}</CardTitle>\n          <CardDescription>\n            Enter your WooCommerce REST API credentials. You can generate these in your WooCommerce dashboard under Settings  Advanced  REST API.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <FormField\n                control={form.control}\n                name=\"storeUrl\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Store URL</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"https://yourstore.com\"\n                        {...field}\n                        data-testid=\"input-store-url\"\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      Your WooCommerce store URL (including https://)\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"consumerKey\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Consumer Key</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"ck_...\"\n                        {...field}\n                        data-testid=\"input-consumer-key\"\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      Your WooCommerce REST API consumer key\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"consumerSecret\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Consumer Secret</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"cs_...\"\n                        {...field}\n                        data-testid=\"input-consumer-secret\"\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      Your WooCommerce REST API consumer secret\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex gap-3 pt-4\">\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1\"\n                  disabled={isSubmitting}\n                  data-testid=\"button-save-settings\"\n                >\n                  {isSubmitting ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    <>\n                      <Save className=\"h-4 w-4 mr-2\" />\n                      {hasCredentials ? \"Update Credentials\" : \"Save Credentials\"}\n                    </>\n                  )}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n\n      <div className=\"mt-6 p-4 bg-green-50 dark:bg-green-950/30 rounded-md border border-green-200 dark:border-green-800\">\n        <h3 className=\"font-semibold mb-2 text-sm text-green-800 dark:text-green-200\">Security</h3>\n        <p className=\"text-sm text-green-700 dark:text-green-300\">\n          Your credentials are encrypted and stored securely on the server. They are never exposed to the browser after being saved.\n        </p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8616,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"./theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","path":null,"size_bytes":548,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { MetricCard } from \"@/components/metric-card\";\nimport { OrderTrendsChart } from \"@/components/order-trends-chart\";\nimport { StatusDistributionChart } from \"@/components/status-distribution-chart\";\nimport { OrdersTable } from \"@/components/orders-table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCredentials } from \"@/contexts/credentials-context\";\nimport { DollarSign, ShoppingCart, TrendingUp, Clock, AlertCircle, Settings, Receipt } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport type { Order, DashboardMetrics, OrderTrend, DateRangePreset } from \"@shared/schema\";\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [dateRange, setDateRange] = useState<DateRangePreset>(\"last30days\");\n  const { hasCredentials } = useCredentials();\n\n  const { data: metrics, isLoading: metricsLoading } = useQuery<DashboardMetrics>({\n    queryKey: [\"/api/metrics\", { dateRange }],\n    enabled: hasCredentials,\n  });\n\n  const { data: trends, isLoading: trendsLoading } = useQuery<OrderTrend[]>({\n    queryKey: [\"/api/trends\", { dateRange }],\n    enabled: hasCredentials,\n  });\n\n  const { data: orders, isLoading: ordersLoading } = useQuery<Order[]>({\n    queryKey: [\"/api/orders\", { dateRange }],\n    enabled: hasCredentials,\n  });\n\n  const calculateTotalTaxes = () => {\n    if (!orders) return 0;\n    return orders.reduce((sum, order) => sum + parseFloat(order.total_tax || \"0\"), 0);\n  };\n\n  const handleExport = async (filters: { status?: string; search?: string }) => {\n    if (!orders || orders.length === 0) {\n      toast({\n        title: \"No data to export\",\n        description: \"There are no orders to export for the selected period.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const params = new URLSearchParams();\n      params.append(\"dateRange\", dateRange);\n      if (filters.status) params.append(\"status\", filters.status);\n      if (filters.search) params.append(\"search\", filters.search);\n\n      const response = await fetch(`/api/export/csv?${params.toString()}`);\n\n      if (!response.ok) {\n        throw new Error(\"Failed to export CSV\");\n      }\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `woocommerce-orders-${dateRange}-${new Date().toISOString().split(\"T\")[0]}.csv`;\n      a.click();\n      window.URL.revokeObjectURL(url);\n\n      toast({\n        title: \"Export successful\",\n        description: `Exported orders to CSV.`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Export failed\",\n        description: \"Failed to export orders. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (!hasCredentials) {\n    return (\n      <div className=\"container max-w-7xl mx-auto py-12 px-6\">\n        <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center\">\n          <div className=\"p-4 bg-muted/50 rounded-full mb-4\">\n            <AlertCircle className=\"h-12 w-12 text-muted-foreground\" />\n          </div>\n          <h2 className=\"text-2xl font-bold mb-2\">WooCommerce Not Connected</h2>\n          <p className=\"text-muted-foreground mb-6 max-w-md\">\n            To view your order reports and analytics, please configure your WooCommerce API credentials first.\n          </p>\n          <Button onClick={() => setLocation(\"/settings\")} data-testid=\"button-configure-settings\">\n            <Settings className=\"h-4 w-4 mr-2\" />\n            Configure Settings\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container max-w-7xl mx-auto py-8 px-6\">\n      <div className=\"flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between mb-8\">\n        <div>\n          <h1 className=\"text-3xl font-bold mb-1\" data-testid=\"text-dashboard-title\">\n            Order Analytics\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Track your store's performance and order metrics\n          </p>\n        </div>\n        <Select value={dateRange} onValueChange={(value) => setDateRange(value as DateRangePreset)}>\n          <SelectTrigger className=\"w-full sm:w-48\" data-testid=\"select-date-range\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"today\">Today</SelectItem>\n            <SelectItem value=\"last7days\">Last 7 Days</SelectItem>\n            <SelectItem value=\"last30days\">Last 30 Days</SelectItem>\n            <SelectItem value=\"last90days\">Last 90 Days</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-5 mb-8\">\n        <MetricCard\n          title=\"Total Revenue\"\n          value={metricsLoading ? \"...\" : `${metrics?.totalRevenue.toLocaleString() || 0}`}\n          icon={DollarSign}\n          testId=\"text-metric-revenue\"\n        />\n        <MetricCard\n          title=\"Total Orders\"\n          value={metricsLoading ? \"...\" : metrics?.totalOrders || 0}\n          icon={ShoppingCart}\n          testId=\"text-metric-orders\"\n        />\n        <MetricCard\n          title=\"Avg Order Value\"\n          value={metricsLoading ? \"...\" : `${metrics?.averageOrderValue.toFixed(2) || 0}`}\n          icon={TrendingUp}\n          testId=\"text-metric-aov\"\n        />\n        <MetricCard\n          title=\"Total Taxes\"\n          value={ordersLoading ? \"...\" : `${calculateTotalTaxes().toLocaleString()}`}\n          icon={Receipt}\n          testId=\"text-metric-taxes\"\n        />\n        <MetricCard\n          title=\"Pending Orders\"\n          value={metricsLoading ? \"...\" : (metrics?.ordersByStatus.pending || 0) + (metrics?.ordersByStatus[\"order-received\"] || 0)}\n          icon={Clock}\n          testId=\"text-metric-pending\"\n        />\n      </div>\n\n      <div className=\"grid gap-8 grid-cols-1 lg:grid-cols-2 mb-8\">\n        <OrderTrendsChart \n          data={trends || []} \n          isLoading={trendsLoading}\n        />\n        <StatusDistributionChart \n          data={metrics?.ordersByStatus || {}} \n          isLoading={metricsLoading}\n        />\n      </div>\n\n      <OrdersTable \n        orders={orders || []} \n        isLoading={ordersLoading}\n        onExport={handleExport}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":6615,"size_tokens":null},"client/src/contexts/credentials-context.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode, useCallback } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface CredentialsStatus {\n  configured: boolean;\n  storeUrl: string | null;\n}\n\ninterface CredentialsContextType {\n  hasCredentials: boolean;\n  storeUrl: string | null;\n  isLoading: boolean;\n  saveCredentials: (storeUrl: string, consumerKey: string, consumerSecret: string) => Promise<void>;\n  deleteCredentials: () => Promise<void>;\n  refreshCredentials: () => void;\n}\n\nconst CredentialsContext = createContext<CredentialsContextType | undefined>(undefined);\n\nexport function CredentialsProvider({ children }: { children: ReactNode }) {\n  const queryClient = useQueryClient();\n  \n  const { data, isLoading, refetch } = useQuery<CredentialsStatus>({\n    queryKey: [\"/api/credentials/status\"],\n    staleTime: 1000 * 60 * 5,\n  });\n  \n  const hasCredentials = data?.configured ?? false;\n  const storeUrl = data?.storeUrl ?? null;\n\n  const saveMutation = useMutation({\n    mutationFn: async (creds: { storeUrl: string; consumerKey: string; consumerSecret: string }) => {\n      return apiRequest(\"POST\", \"/api/credentials\", creds);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/credentials/status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/metrics\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/trends\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/order-statuses\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"DELETE\", \"/api/credentials\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/credentials/status\"] });\n    },\n  });\n\n  const saveCredentials = useCallback(async (storeUrl: string, consumerKey: string, consumerSecret: string) => {\n    await saveMutation.mutateAsync({ storeUrl, consumerKey, consumerSecret });\n  }, [saveMutation]);\n\n  const deleteCredentials = useCallback(async () => {\n    await deleteMutation.mutateAsync();\n  }, [deleteMutation]);\n\n  const refreshCredentials = useCallback(() => {\n    refetch();\n  }, [refetch]);\n\n  return (\n    <CredentialsContext.Provider value={{ \n      hasCredentials, \n      storeUrl, \n      isLoading, \n      saveCredentials, \n      deleteCredentials,\n      refreshCredentials \n    }}>\n      {children}\n    </CredentialsContext.Provider>\n  );\n}\n\nexport function useCredentials() {\n  const context = useContext(CredentialsContext);\n  if (context === undefined) {\n    throw new Error(\"useCredentials must be used within a CredentialsProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":2876,"size_tokens":null},"client/src/components/orders-table.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { StatusBadge } from \"./status-badge\";\nimport { OrderDetailsDialog } from \"./order-details-dialog\";\nimport { Download, Search, FileText, Truck, ExternalLink, CheckCircle, Circle } from \"lucide-react\";\nimport type { Order, OrderStatus } from \"@shared/schema\";\nimport { format } from \"date-fns\";\n\ninterface FulfillmentStatus {\n  canFulfill: boolean;\n  missingMaterials: Array<{\n    materialId: number;\n    variationId: number | null;\n    materialName: string;\n    needed: number;\n    available: number;\n  }>;\n  isProcessed: boolean;\n}\n\n// Helper function to get meta data value from order\nfunction getOrderMeta(order: Order, key: string): string | undefined {\n  if (!order.meta_data) return undefined;\n  const meta = order.meta_data.find(m => m.key === key);\n  return meta?.value?.toString();\n}\n\ninterface OrdersTableProps {\n  orders: Order[];\n  isLoading?: boolean;\n  onExport: (filters: { status?: string; search?: string }) => void;\n}\n\nexport function OrdersTable({ orders, isLoading, onExport }: OrdersTableProps) {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [selectedOrder, setSelectedOrder] = useState<Order | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  const { data: orderStatuses } = useQuery<OrderStatus[]>({\n    queryKey: [\"/api/order-statuses\"],\n    enabled: true,\n  });\n\n  const { data: fulfillmentStatus } = useQuery<Record<number, FulfillmentStatus>>({\n    queryKey: [\"/api/orders/fulfillment-status\"],\n    enabled: orders.length > 0,\n    staleTime: 30000,\n  });\n\n  const handleExport = () => {\n    onExport({\n      status: statusFilter !== \"all\" ? statusFilter : undefined,\n      search: searchTerm || undefined,\n    });\n  };\n\n  const handleOrderClick = (order: Order) => {\n    setSelectedOrder(order);\n    setDialogOpen(true);\n  };\n\n  const filteredOrders = orders.filter((order) => {\n    const matchesSearch = \n      order.number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      `${order.billing.first_name} ${order.billing.last_name}`.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      order.billing.email.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = statusFilter === \"all\" || order.status === statusFilter;\n    \n    return matchesSearch && matchesStatus;\n  });\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"h-5 w-5\" />\n            Recent Orders\n          </CardTitle>\n          <Button onClick={handleExport} variant=\"outline\" data-testid=\"button-export-csv\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Export CSV\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col gap-4 mb-6 sm:flex-row\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search orders, customers, or emails...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-9\"\n              data-testid=\"input-search-orders\"\n            />\n          </div>\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-full sm:w-48\" data-testid=\"select-status-filter\">\n              <SelectValue placeholder=\"Filter by status\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Statuses</SelectItem>\n              {orderStatuses?.map((status) => (\n                <SelectItem key={status.slug} value={status.slug}>\n                  {status.name} ({status.total})\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {isLoading ? (\n          <div className=\"py-12 text-center text-muted-foreground\">\n            Loading orders...\n          </div>\n        ) : filteredOrders.length === 0 ? (\n          <div className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground\">No orders found</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"font-semibold w-10\">Stock</TableHead>\n                    <TableHead className=\"font-semibold\">Order</TableHead>\n                    <TableHead className=\"font-semibold\">Customer</TableHead>\n                    <TableHead className=\"font-semibold\">Date</TableHead>\n                    <TableHead className=\"font-semibold\">Status</TableHead>\n                    <TableHead className=\"font-semibold\">Delivery Method</TableHead>\n                    <TableHead className=\"font-semibold text-right\">Tax</TableHead>\n                    <TableHead className=\"font-semibold text-right\">Total</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredOrders.map((order) => {\n                    const status = fulfillmentStatus?.[order.id];\n                    const canFulfill = status?.canFulfill ?? true;\n                    const isProcessed = status?.isProcessed ?? false;\n                    const missingMaterials = status?.missingMaterials ?? [];\n                    \n                    return (\n                    <TableRow \n                      key={order.id} \n                      data-testid={`row-order-${order.id}`}\n                      className=\"cursor-pointer hover-elevate\"\n                      onClick={() => handleOrderClick(order)}\n                    >\n                      <TableCell className=\"text-center\" data-testid={`stock-status-${order.id}`}>\n                        {isProcessed ? (\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <CheckCircle className=\"h-4 w-4 text-blue-500 mx-auto\" />\n                            </TooltipTrigger>\n                            <TooltipContent>\n                              <p>Already processed</p>\n                            </TooltipContent>\n                          </Tooltip>\n                        ) : canFulfill ? (\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Circle className=\"h-4 w-4 fill-green-500 text-green-500 mx-auto\" />\n                            </TooltipTrigger>\n                            <TooltipContent>\n                              <p>Stock available</p>\n                            </TooltipContent>\n                          </Tooltip>\n                        ) : (\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <Circle className=\"h-4 w-4 fill-red-500 text-red-500 mx-auto\" />\n                            </TooltipTrigger>\n                            <TooltipContent className=\"max-w-xs\">\n                              <p className=\"font-medium mb-1\">Insufficient stock:</p>\n                              <ul className=\"text-xs space-y-0.5\">\n                                {missingMaterials.slice(0, 5).map((m, i) => (\n                                  <li key={i}>\n                                    {m.materialName}: need {m.needed}, have {m.available}\n                                  </li>\n                                ))}\n                                {missingMaterials.length > 5 && (\n                                  <li className=\"text-muted-foreground\">\n                                    +{missingMaterials.length - 5} more...\n                                  </li>\n                                )}\n                              </ul>\n                            </TooltipContent>\n                          </Tooltip>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"font-medium\" data-testid={`text-order-number-${order.id}`}>\n                        #{order.number}\n                      </TableCell>\n                      <TableCell>\n                        <div>\n                          <div className=\"font-medium\">\n                            {order.billing.first_name} {order.billing.last_name}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {order.billing.email}\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-muted-foreground\">\n                        {format(new Date(order.date_created), \"MMM dd, yyyy\")}\n                      </TableCell>\n                      <TableCell>\n                        <StatusBadge status={order.status} />\n                      </TableCell>\n                      <TableCell className=\"text-sm\">\n                        <div className=\"space-y-1\">\n                          <div className=\"text-muted-foreground\">\n                            {order.shipping_lines && order.shipping_lines.length > 0\n                              ? order.shipping_lines[0].method_title\n                              : \"N/A\"}\n                          </div>\n                          {getOrderMeta(order, 'delivery_shipping_partner') && (\n                            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                              <Truck className=\"h-3 w-3\" />\n                              <span>{getOrderMeta(order, 'delivery_shipping_partner')}</span>\n                            </div>\n                          )}\n                          {getOrderMeta(order, 'delivery_tracking_number') && (() => {\n                            const trackingNumber = getOrderMeta(order, 'delivery_tracking_number');\n                            const shippingPartner = getOrderMeta(order, 'delivery_shipping_partner');\n                            const isAnPost = shippingPartner?.toLowerCase().includes('an post');\n                            \n                            return isAnPost ? (\n                              <a \n                                href={`https://www.anpost.com/Post-Parcels/Track/History?item=${trackingNumber}`}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"flex items-center gap-1 text-xs text-primary hover:underline\"\n                                onClick={(e) => e.stopPropagation()}\n                                data-testid={`link-tracking-${order.id}`}\n                              >\n                                <ExternalLink className=\"h-3 w-3\" />\n                                <span className=\"font-mono\">{trackingNumber}</span>\n                              </a>\n                            ) : (\n                              <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                                <span className=\"font-mono\">{trackingNumber}</span>\n                              </div>\n                            );\n                          })()}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right text-muted-foreground\">\n                         {parseFloat(order.total_tax || \"0\").toFixed(2)}\n                      </TableCell>\n                      <TableCell className=\"text-right font-semibold\">\n                         {parseFloat(order.total).toFixed(2)}\n                      </TableCell>\n                    </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n            <div className=\"mt-4 text-sm text-muted-foreground\">\n              Showing {filteredOrders.length} of {orders.length} orders\n            </div>\n          </>\n        )}\n      </CardContent>\n\n      <OrderDetailsDialog \n        order={selectedOrder}\n        open={dialogOpen}\n        onOpenChange={setDialogOpen}\n      />\n    </Card>\n  );\n}\n","path":null,"size_bytes":12838,"size_tokens":null},"client/src/components/loading-skeleton.tsx":{"content":"import { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\n\nexport function MetricCardSkeleton() {\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between mb-4\">\n          <Skeleton className=\"h-9 w-9 rounded-md\" />\n        </div>\n        <Skeleton className=\"h-4 w-24 mb-2\" />\n        <Skeleton className=\"h-10 w-32\" />\n      </CardContent>\n    </Card>\n  );\n}\n\nexport function ChartSkeleton() {\n  return (\n    <Card>\n      <CardHeader>\n        <Skeleton className=\"h-6 w-48\" />\n      </CardHeader>\n      <CardContent>\n        <Skeleton className=\"h-96 w-full\" />\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":727,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/header.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { ThemeToggle } from \"./theme-toggle\";\nimport { Button } from \"@/components/ui/button\";\nimport { BarChart3, Settings, Package, LayoutDashboard, ShoppingCart, Building2, LogOut, User, Users } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\nexport function Header() {\n  const [location] = useLocation();\n  const { user, logoutMutation } = useAuth();\n\n  return (\n    <header className=\"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n      <div className=\"container flex h-16 items-center justify-between px-6\">\n        <div className=\"flex items-center gap-6\">\n          <Link href=\"/\">\n            <div className=\"flex items-center gap-2 font-bold text-lg hover-elevate active-elevate-2 rounded-md px-2 py-1 -ml-2 cursor-pointer\" data-testid=\"link-home\">\n              <div className=\"p-1.5 bg-primary/10 rounded-md\">\n                <BarChart3 className=\"h-5 w-5 text-primary\" />\n              </div>\n              WooCommerce Reports\n            </div>\n          </Link>\n          \n          <nav className=\"hidden md:flex items-center gap-1\">\n            <Link href=\"/\">\n              <Button\n                variant={location === \"/\" ? \"secondary\" : \"ghost\"}\n                size=\"sm\"\n                data-testid=\"nav-dashboard\"\n              >\n                <LayoutDashboard className=\"h-4 w-4 mr-2\" />\n                Dashboard\n              </Button>\n            </Link>\n            <Link href=\"/inventory\">\n              <Button\n                variant={location === \"/inventory\" || location === \"/stock-ledger\" ? \"secondary\" : \"ghost\"}\n                size=\"sm\"\n                data-testid=\"nav-inventory\"\n              >\n                <Package className=\"h-4 w-4 mr-2\" />\n                Inventory\n              </Button>\n            </Link>\n            <Link href=\"/purchase-orders\">\n              <Button\n                variant={location === \"/purchase-orders\" ? \"secondary\" : \"ghost\"}\n                size=\"sm\"\n                data-testid=\"nav-purchase-orders\"\n              >\n                <ShoppingCart className=\"h-4 w-4 mr-2\" />\n                Purchase Orders\n              </Button>\n            </Link>\n            <Link href=\"/suppliers\">\n              <Button\n                variant={location === \"/suppliers\" ? \"secondary\" : \"ghost\"}\n                size=\"sm\"\n                data-testid=\"nav-suppliers\"\n              >\n                <Building2 className=\"h-4 w-4 mr-2\" />\n                Suppliers\n              </Button>\n            </Link>\n            <Link href=\"/customers\">\n              <Button\n                variant={location === \"/customers\" ? \"secondary\" : \"ghost\"}\n                size=\"sm\"\n                data-testid=\"nav-customers\"\n              >\n                <Users className=\"h-4 w-4 mr-2\" />\n                Customers\n              </Button>\n            </Link>\n          </nav>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Link href=\"/settings\">\n            <Button\n              variant={location === \"/settings\" ? \"secondary\" : \"ghost\"}\n              size=\"icon\"\n              data-testid=\"button-settings\"\n            >\n              <Settings className=\"h-5 w-5\" />\n              <span className=\"sr-only\">Settings</span>\n            </Button>\n          </Link>\n          <ThemeToggle />\n          \n          {user && (\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-user-menu\">\n                  <User className=\"h-5 w-5\" />\n                  <span className=\"sr-only\">User menu</span>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <div className=\"px-2 py-1.5 text-sm font-medium\">\n                  {user.username}\n                </div>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem\n                  onClick={() => logoutMutation.mutate()}\n                  className=\"cursor-pointer\"\n                  data-testid=\"button-logout\"\n                >\n                  <LogOut className=\"mr-2 h-4 w-4\" />\n                  Sign out\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          )}\n        </div>\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":4583,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport { drizzle } from \"drizzle-orm/neon-serverless\";\nimport * as schema from \"@shared/schema\";\nimport ws from \"ws\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL must be set. Did you forget to provision a database?\");\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":466,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/order-details-dialog.tsx":{"content":"import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { StatusBadge } from \"./status-badge\";\nimport { format } from \"date-fns\";\nimport { Package, User, MapPin, CreditCard, Truck, Box, CheckCircle, Loader2, RefreshCw, ExternalLink, AlertTriangle, Layers } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useCredentials } from \"@/contexts/credentials-context\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState, useEffect } from \"react\";\nimport type { Order, OrderStatus } from \"@shared/schema\";\n\ninterface RequiredMaterial {\n  materialId: number;\n  variationId: number | null;\n  materialName: string;\n  quantityNeeded: number;\n  currentStock: number;\n  hasSufficientStock: boolean;\n  productName: string;\n  variationName: string | null;\n}\n\ninterface RequiredMaterialsResponse {\n  orderId: number;\n  orderNumber: string;\n  isProcessed: boolean;\n  processedAt: string | null;\n  requiredMaterials: RequiredMaterial[];\n  canFulfill: boolean;\n}\n\n// Helper function to get meta data value from order\nfunction getOrderMeta(order: Order, key: string): string | undefined {\n  if (!order.meta_data) return undefined;\n  const meta = order.meta_data.find(m => m.key === key);\n  return meta?.value?.toString();\n}\n\ninterface OrderDetailsDialogProps {\n  order: Order | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function OrderDetailsDialog({ order, open, onOpenChange }: OrderDetailsDialogProps) {\n  const { hasCredentials } = useCredentials();\n  const { toast } = useToast();\n  const [currentStatus, setCurrentStatus] = useState<string>(\"\");\n  \n  useEffect(() => {\n    if (order) {\n      setCurrentStatus(order.status);\n    }\n  }, [order]);\n  \n  const { data: orderStatuses = [] } = useQuery<OrderStatus[]>({\n    queryKey: [\"/api/order-statuses\"],\n    enabled: hasCredentials && open,\n  });\n  \n  const { data: processedStatus, isLoading: checkingProcessed } = useQuery({\n    queryKey: [\"/api/processed-orders\", order?.id],\n    enabled: !!order && open,\n    queryFn: async () => {\n      const response = await fetch(`/api/processed-orders/${order?.id}`);\n      if (!response.ok) throw new Error(\"Failed to check processed status\");\n      return response.json();\n    },\n  });\n\n  const { data: requiredMaterials, isLoading: loadingMaterials } = useQuery<RequiredMaterialsResponse>({\n    queryKey: [\"/api/orders\", order?.id, \"required-materials\"],\n    enabled: !!order && open && hasCredentials,\n    queryFn: async () => {\n      const response = await fetch(`/api/orders/${order?.id}/required-materials`);\n      if (!response.ok) throw new Error(\"Failed to fetch required materials\");\n      return response.json();\n    },\n  });\n  \n  const updateStatusMutation = useMutation({\n    mutationFn: async (newStatus: string) => {\n      if (!order) throw new Error(\"No order selected\");\n      \n      const response = await fetch(`/api/orders/${order.id}/status`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ status: newStatus }),\n      });\n      \n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || \"Failed to update status\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: (data) => {\n      setCurrentStatus(data.status);\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/metrics\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/order-statuses\"] });\n      toast({\n        title: \"Status Updated\",\n        description: `Order #${order?.number} status changed to ${data.status}.`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update order status.\",\n      });\n    },\n  });\n\n  const processInventoryMutation = useMutation({\n    mutationFn: async () => {\n      if (!order) throw new Error(\"No order selected\");\n      \n      const response = await fetch(\"/api/process-order-stock\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          orderId: order.id,\n          orderNumber: order.number,\n          lineItems: order.line_items.map(item => ({\n            product_id: item.product_id,\n            variation_id: (item as any).variation_id,\n            quantity: item.quantity,\n            name: item.name,\n          })),\n        }),\n      });\n      \n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || \"Failed to process inventory\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/processed-orders\", order?.id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-ledger\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders/fulfillment-status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\", order?.id, \"required-materials\"] });\n      \n      const deductionsCount = data.results?.length || 0;\n      const unmappedCount = data.unmappedItems?.length || 0;\n      const skippedCount = data.skippedItems?.length || 0;\n      const failedCount = data.failedUpdates?.length || 0;\n      \n      // Show warning toast if some items weren't processed\n      if (unmappedCount > 0 || skippedCount > 0 || failedCount > 0) {\n        const unmappedNames = data.unmappedItems?.map((i: any) => i.name).join(\", \") || \"\";\n        const skippedNames = data.skippedItems?.map((i: any) => i.name).join(\", \") || \"\";\n        const failedNames = data.failedUpdates?.map((i: any) => `${i.name}  ${i.materialName}`).join(\", \") || \"\";\n        \n        let warningDesc = `Processed ${deductionsCount} material deduction(s).`;\n        if (unmappedCount > 0) {\n          warningDesc += ` ${unmappedCount} item(s) had no mappings: ${unmappedNames}.`;\n        }\n        if (skippedCount > 0) {\n          warningDesc += ` ${skippedCount} mapping(s) skipped: ${skippedNames}.`;\n        }\n        if (failedCount > 0) {\n          warningDesc += ` ${failedCount} update(s) failed: ${failedNames}.`;\n        }\n        \n        toast({\n          variant: \"destructive\",\n          title: \"Partial Processing\",\n          description: warningDesc,\n          duration: 10000,\n        });\n      } else {\n        toast({\n          title: \"Inventory Processed\",\n          description: deductionsCount > 0 \n            ? `Successfully deducted stock for ${deductionsCount} material(s).`\n            : \"Order processed. No materials were linked to these products.\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Processing Failed\",\n        description: error.message || \"Failed to process inventory for this order.\",\n      });\n    },\n  });\n\n  if (!order) return null;\n\n  const subtotal = order.line_items.reduce((sum, item) => sum + parseFloat(item.total || \"0\"), 0);\n  const shippingTotal = parseFloat(order.shipping_total || \"0\");\n  const taxTotal = parseFloat(order.total_tax || \"0\");\n  const discountTotal = parseFloat(order.discount_total || \"0\");\n  const total = parseFloat(order.total);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-order-details\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between gap-4\">\n            <DialogTitle className=\"text-2xl\">Order #{order.number}</DialogTitle>\n            <div className=\"flex items-center gap-2\">\n              {hasCredentials && orderStatuses.length > 0 ? (\n                <div className=\"flex items-center gap-2\">\n                  <Select\n                    value={currentStatus}\n                    onValueChange={(value) => updateStatusMutation.mutate(value)}\n                    disabled={updateStatusMutation.isPending}\n                  >\n                    <SelectTrigger className=\"w-[180px]\" data-testid=\"select-order-status\">\n                      <SelectValue>\n                        <StatusBadge status={currentStatus} />\n                      </SelectValue>\n                    </SelectTrigger>\n                    <SelectContent>\n                      {orderStatuses.map((status) => (\n                        <SelectItem key={status.slug} value={status.slug}>\n                          <div className=\"flex items-center gap-2\">\n                            <StatusBadge status={status.slug} />\n                            <span className=\"text-xs text-muted-foreground\">({status.total})</span>\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  {updateStatusMutation.isPending && (\n                    <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\n                  )}\n                </div>\n              ) : (\n                <StatusBadge status={currentStatus || order.status} />\n              )}\n            </div>\n          </div>\n          <p className=\"text-sm text-muted-foreground\">\n            Placed on {format(new Date(order.date_created), \"MMMM dd, yyyy 'at' h:mm a\")}\n          </p>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Customer Information */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-3\">\n              <User className=\"h-4 w-4 text-muted-foreground\" />\n              <h3 className=\"font-semibold\">Customer Information</h3>\n            </div>\n            <div className=\"bg-muted/50 rounded-lg p-4 space-y-2\">\n              <div>\n                <p className=\"font-medium\">\n                  {order.billing.first_name} {order.billing.last_name}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">{order.billing.email}</p>\n                {order.billing.phone && (\n                  <p className=\"text-sm text-muted-foreground\">{order.billing.phone}</p>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Billing Address */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-3\">\n              <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n              <h3 className=\"font-semibold\">Billing Address</h3>\n            </div>\n            <div className=\"bg-muted/50 rounded-lg p-4\">\n              <p className=\"text-sm\">\n                {order.billing.address_1}\n                {order.billing.address_2 && (\n                  <>\n                    <br />\n                    {order.billing.address_2}\n                  </>\n                )}\n                <br />\n                {order.billing.city}, {order.billing.state} {order.billing.postcode}\n                <br />\n                {order.billing.country}\n              </p>\n            </div>\n          </div>\n\n          {/* Shipping Address */}\n          {order.shipping && (order.shipping.address_1 || order.shipping.first_name) && (\n            <div>\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                <h3 className=\"font-semibold\">Shipping Address</h3>\n              </div>\n              <div className=\"bg-muted/50 rounded-lg p-4\">\n                {order.shipping.first_name && (\n                  <p className=\"font-medium mb-1\">\n                    {order.shipping.first_name} {order.shipping.last_name}\n                  </p>\n                )}\n                <p className=\"text-sm\">\n                  {order.shipping.address_1}\n                  {order.shipping.address_2 && (\n                    <>\n                      <br />\n                      {order.shipping.address_2}\n                    </>\n                  )}\n                  <br />\n                  {order.shipping.city}, {order.shipping.state} {order.shipping.postcode}\n                  <br />\n                  {order.shipping.country}\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Delivery Information */}\n          {(getOrderMeta(order, 'delivery_shipping_partner') || getOrderMeta(order, 'delivery_tracking_number')) && (\n            <div>\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Truck className=\"h-4 w-4 text-muted-foreground\" />\n                <h3 className=\"font-semibold\">Delivery Information</h3>\n              </div>\n              <div className=\"bg-muted/50 rounded-lg p-4 space-y-2\">\n                {getOrderMeta(order, 'delivery_shipping_partner') && (\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-muted-foreground\">Shipping Partner:</span>\n                    <span className=\"text-sm font-medium\">{getOrderMeta(order, 'delivery_shipping_partner')}</span>\n                  </div>\n                )}\n                {getOrderMeta(order, 'delivery_tracking_number') && (() => {\n                  const trackingNumber = getOrderMeta(order, 'delivery_tracking_number');\n                  const shippingPartner = getOrderMeta(order, 'delivery_shipping_partner');\n                  const isAnPost = shippingPartner?.toLowerCase().includes('an post');\n                  \n                  return (\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm text-muted-foreground\">Tracking Number:</span>\n                      {isAnPost ? (\n                        <a \n                          href={`https://www.anpost.com/Post-Parcels/Track/History?item=${trackingNumber}`}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"text-sm font-mono font-medium text-primary hover:underline flex items-center gap-1\"\n                          data-testid=\"link-tracking-detail\"\n                        >\n                          {trackingNumber}\n                          <ExternalLink className=\"h-3 w-3\" />\n                        </a>\n                      ) : (\n                        <span className=\"text-sm font-mono font-medium\">\n                          {trackingNumber}\n                        </span>\n                      )}\n                    </div>\n                  );\n                })()}\n              </div>\n            </div>\n          )}\n\n          {/* Order Items */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-3\">\n              <Package className=\"h-4 w-4 text-muted-foreground\" />\n              <h3 className=\"font-semibold\">Order Items</h3>\n            </div>\n            <div className=\"border rounded-lg overflow-hidden\">\n              <table className=\"w-full\">\n                <thead className=\"bg-muted/50\">\n                  <tr>\n                    <th className=\"text-left p-3 text-sm font-semibold\">Product</th>\n                    <th className=\"text-center p-3 text-sm font-semibold\">Quantity</th>\n                    <th className=\"text-right p-3 text-sm font-semibold\">Price</th>\n                    <th className=\"text-right p-3 text-sm font-semibold\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {order.line_items.map((item) => {\n                    const variationAttributes = item.meta_data?.filter(\n                      (meta) => {\n                        if (!meta.display_key || !meta.display_value) return false;\n                        if (meta.key.startsWith('_')) return false;\n                        if (typeof meta.display_value === 'object') return false;\n                        return true;\n                      }\n                    ) || [];\n                    \n                    return (\n                      <tr key={item.id} className=\"border-t\" data-testid={`row-line-item-${item.id}`}>\n                        <td className=\"p-3\">\n                          <p className=\"font-medium\">{item.name}</p>\n                          {item.sku && (\n                            <p className=\"text-xs text-muted-foreground mt-0.5\">\n                              SKU: {item.sku}\n                            </p>\n                          )}\n                          {variationAttributes.length > 0 && (\n                            <div className=\"mt-1.5 space-y-0.5\">\n                              {variationAttributes.map((attr) => (\n                                <p \n                                  key={attr.id} \n                                  className=\"text-sm text-muted-foreground\"\n                                  data-testid={`text-variation-${attr.key}`}\n                                >\n                                  <span className=\"font-medium\">{attr.display_key}:</span>{\" \"}\n                                  <span>{String(attr.display_value)}</span>\n                                </p>\n                              ))}\n                            </div>\n                          )}\n                        </td>\n                        <td className=\"p-3 text-center align-top\">{item.quantity}</td>\n                        <td className=\"p-3 text-right align-top\">\n                           {item.price ? item.price.toFixed(2) : (parseFloat(item.total) / item.quantity).toFixed(2)}\n                        </td>\n                        <td className=\"p-3 text-right font-medium align-top\">\n                           {parseFloat(item.total).toFixed(2)}\n                        </td>\n                      </tr>\n                    );\n                  })}\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          {/* Order Totals */}\n          <div>\n            <div className=\"flex items-center gap-2 mb-3\">\n              <CreditCard className=\"h-4 w-4 text-muted-foreground\" />\n              <h3 className=\"font-semibold\">Order Summary</h3>\n            </div>\n            <div className=\"bg-muted/50 rounded-lg p-4 space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Subtotal</span>\n                <span> {subtotal.toFixed(2)}</span>\n              </div>\n\n              {discountTotal > 0 && (\n                <div className=\"flex justify-between text-sm text-green-600 dark:text-green-400\">\n                  <span>Discount</span>\n                  <span>- {discountTotal.toFixed(2)}</span>\n                </div>\n              )}\n\n              {order.shipping_lines && order.shipping_lines.length > 0 ? (\n                order.shipping_lines.map((shipping) => (\n                  <div key={shipping.id} className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">{shipping.method_title}</span>\n                    <span> {parseFloat(shipping.total).toFixed(2)}</span>\n                  </div>\n                ))\n              ) : shippingTotal > 0 ? (\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Shipping</span>\n                  <span> {shippingTotal.toFixed(2)}</span>\n                </div>\n              ) : null}\n\n              {taxTotal > 0 && (\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Tax</span>\n                  <span> {taxTotal.toFixed(2)}</span>\n                </div>\n              )}\n\n              <Separator />\n\n              <div className=\"flex justify-between font-semibold text-lg\">\n                <span>Total</span>\n                <span> {total.toFixed(2)}</span>\n              </div>\n\n              {order.payment_method_title && (\n                <div className=\"pt-2 border-t\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Payment method: <span className=\"font-medium text-foreground\">{order.payment_method_title}</span>\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Required Raw Materials */}\n          {hasCredentials && (\n            <div className=\"border-t pt-4\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Layers className=\"h-4 w-4 text-muted-foreground\" />\n                <h3 className=\"font-semibold\">Required Raw Materials</h3>\n                {requiredMaterials && (\n                  requiredMaterials.canFulfill ? (\n                    <Badge variant=\"outline\" className=\"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300\">\n                      <CheckCircle className=\"h-3 w-3 mr-1\" />\n                      Stock Available\n                    </Badge>\n                  ) : (\n                    <Badge variant=\"outline\" className=\"text-xs bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300\">\n                      <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                      Insufficient Stock\n                    </Badge>\n                  )\n                )}\n              </div>\n              \n              {loadingMaterials ? (\n                <div className=\"flex items-center justify-center py-4 text-muted-foreground\">\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  Loading materials...\n                </div>\n              ) : requiredMaterials?.requiredMaterials && requiredMaterials.requiredMaterials.length > 0 ? (\n                <div className=\"bg-muted/50 rounded-lg overflow-hidden\">\n                  <table className=\"w-full text-sm\">\n                    <thead>\n                      <tr className=\"border-b bg-muted/50\">\n                        <th className=\"text-left p-2 font-medium\">Material</th>\n                        <th className=\"text-center p-2 font-medium\">Needed</th>\n                        <th className=\"text-center p-2 font-medium\">In Stock</th>\n                        <th className=\"text-center p-2 font-medium\">Status</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {requiredMaterials.requiredMaterials.map((material, index) => (\n                        <tr \n                          key={`${material.materialId}-${material.variationId || 'null'}-${index}`} \n                          className=\"border-b last:border-0\"\n                          data-testid={`row-material-${material.materialId}`}\n                        >\n                          <td className=\"p-2\">\n                            <div className=\"font-medium\">{material.materialName}</div>\n                            <div className=\"text-xs text-muted-foreground\">{material.productName}</div>\n                          </td>\n                          <td className=\"p-2 text-center font-medium\">{material.quantityNeeded}</td>\n                          <td className=\"p-2 text-center\">{material.currentStock}</td>\n                          <td className=\"p-2 text-center\">\n                            {material.hasSufficientStock ? (\n                              <CheckCircle className=\"h-4 w-4 text-green-600 dark:text-green-400 mx-auto\" />\n                            ) : (\n                              <AlertTriangle className=\"h-4 w-4 text-red-600 dark:text-red-400 mx-auto\" />\n                            )}\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              ) : (\n                <div className=\"text-sm text-muted-foreground py-4 text-center bg-muted/50 rounded-lg\">\n                  No materials mapped to products in this order\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Inventory Processing */}\n          <div className=\"border-t pt-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Box className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-sm font-medium\">Inventory Processing</span>\n              </div>\n              {!hasCredentials ? (\n                <span className=\"text-xs text-muted-foreground\">\n                  Configure WooCommerce in Settings to enable\n                </span>\n              ) : checkingProcessed ? (\n                <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\n              ) : processedStatus?.processed ? (\n                <div className=\"flex items-center gap-2 text-green-600 dark:text-green-400\">\n                  <CheckCircle className=\"h-4 w-4\" />\n                  <span className=\"text-sm\">\n                    Processed on {format(new Date(processedStatus.data.processedAt), \"MMM d, yyyy\")}\n                  </span>\n                </div>\n              ) : (\n                <Button\n                  size=\"sm\"\n                  onClick={() => processInventoryMutation.mutate()}\n                  disabled={processInventoryMutation.isPending}\n                  data-testid=\"button-process-inventory\"\n                >\n                  {processInventoryMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Processing...\n                    </>\n                  ) : (\n                    <>\n                      <Box className=\"mr-2 h-4 w-4\" />\n                      Process Inventory\n                    </>\n                  )}\n                </Button>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              {hasCredentials \n                ? \"Processing will deduct raw materials based on your product mappings.\"\n                : \"Set up your WooCommerce API credentials to process inventory.\"}\n            </p>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":26525,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { CredentialsProvider } from \"@/contexts/credentials-context\";\nimport { AuthProvider } from \"@/hooks/use-auth\";\nimport { ProtectedRoute } from \"@/lib/protected-route\";\nimport { Header } from \"@/components/header\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Settings from \"@/pages/settings\";\nimport Inventory from \"@/pages/inventory\";\nimport StockLedger from \"@/pages/stock-ledger\";\nimport PurchaseOrders from \"@/pages/purchase-orders\";\nimport Suppliers from \"@/pages/suppliers\";\nimport Customers from \"@/pages/customers\";\nimport AuthPage from \"@/pages/auth-page\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/auth\" component={AuthPage} />\n      <ProtectedRoute path=\"/\" component={DashboardWithHeader} />\n      <ProtectedRoute path=\"/settings\" component={SettingsWithHeader} />\n      <ProtectedRoute path=\"/inventory\" component={InventoryWithHeader} />\n      <ProtectedRoute path=\"/stock-ledger\" component={StockLedgerWithHeader} />\n      <ProtectedRoute path=\"/purchase-orders\" component={PurchaseOrdersWithHeader} />\n      <ProtectedRoute path=\"/suppliers\" component={SuppliersWithHeader} />\n      <ProtectedRoute path=\"/customers\" component={CustomersWithHeader} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction DashboardWithHeader() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <Dashboard />\n    </div>\n  );\n}\n\nfunction SettingsWithHeader() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <Settings />\n    </div>\n  );\n}\n\nfunction InventoryWithHeader() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <Inventory />\n    </div>\n  );\n}\n\nfunction StockLedgerWithHeader() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <StockLedger />\n    </div>\n  );\n}\n\nfunction PurchaseOrdersWithHeader() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <PurchaseOrders />\n    </div>\n  );\n}\n\nfunction SuppliersWithHeader() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <Suppliers />\n    </div>\n  );\n}\n\nfunction CustomersWithHeader() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <Customers />\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <CredentialsProvider>\n          <ThemeProvider defaultTheme=\"light\">\n            <TooltipProvider>\n              <Router />\n              <Toaster />\n            </TooltipProvider>\n          </ThemeProvider>\n        </CredentialsProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3100,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/order-trends-chart.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } from \"recharts\";\nimport type { OrderTrend } from \"@shared/schema\";\nimport { TrendingUp } from \"lucide-react\";\n\ninterface OrderTrendsChartProps {\n  data: OrderTrend[];\n  isLoading?: boolean;\n}\n\nexport function OrderTrendsChart({ data, isLoading }: OrderTrendsChartProps) {\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Order Trends\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-96 flex items-center justify-center\">\n            <div className=\"text-muted-foreground\">Loading chart data...</div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <TrendingUp className=\"h-5 w-5\" />\n          Order Trends Over Time\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"h-96\" data-testid=\"chart-order-trends\">\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <LineChart data={data}>\n              <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-border\" />\n              <XAxis\n                dataKey=\"date\"\n                className=\"text-xs\"\n                tick={{ fill: \"hsl(var(--muted-foreground))\" }}\n              />\n              <YAxis\n                className=\"text-xs\"\n                tick={{ fill: \"hsl(var(--muted-foreground))\" }}\n              />\n              <Tooltip\n                contentStyle={{\n                  backgroundColor: \"hsl(var(--popover))\",\n                  border: \"1px solid hsl(var(--border))\",\n                  borderRadius: \"6px\",\n                }}\n              />\n              <Legend />\n              <Line\n                type=\"monotone\"\n                dataKey=\"orders\"\n                stroke=\"hsl(var(--chart-1))\"\n                strokeWidth={2}\n                name=\"Orders\"\n              />\n              <Line\n                type=\"monotone\"\n                dataKey=\"revenue\"\n                stroke=\"hsl(var(--chart-2))\"\n                strokeWidth={2}\n                name=\"Revenue\"\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2507,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"server/app.ts":{"content":"import { type Server } from \"node:http\";\n\nimport express, {\n  type Express,\n  type Request,\n  Response,\n  NextFunction,\n} from \"express\";\n\nimport { registerRoutes } from \"./routes\";\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport const app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\nexport default async function runApp(\n  setup: (app: Express, server: Server) => Promise<void>,\n) {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly run the final setup after setting up all the other routes so\n  // the catch-all route doesn't interfere with the other routes\n  await setup(app, server);\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n}\n","path":null,"size_bytes":2482,"size_tokens":null},"client/src/components/status-distribution-chart.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from \"recharts\";\nimport { PieChart as PieChartIcon } from \"lucide-react\";\n\ninterface StatusDistributionChartProps {\n  data: Record<string, number>;\n  isLoading?: boolean;\n}\n\nconst COLORS = [\n  \"hsl(var(--chart-1))\",\n  \"hsl(var(--chart-2))\",\n  \"hsl(var(--chart-3))\",\n  \"hsl(var(--chart-4))\",\n  \"hsl(var(--chart-5))\",\n];\n\nexport function StatusDistributionChart({ data, isLoading }: StatusDistributionChartProps) {\n  const chartData = Object.entries(data).map(([name, value]) => ({\n    name: name.charAt(0).toUpperCase() + name.slice(1),\n    value,\n  }));\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <PieChartIcon className=\"h-5 w-5\" />\n            Status Distribution\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"h-96 flex items-center justify-center\">\n            <div className=\"text-muted-foreground\">Loading chart data...</div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <PieChartIcon className=\"h-5 w-5\" />\n          Orders by Status\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"h-96\" data-testid=\"chart-status-distribution\">\n          <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <PieChart>\n              <Pie\n                data={chartData}\n                cx=\"50%\"\n                cy=\"50%\"\n                labelLine={false}\n                label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\n                outerRadius={120}\n                fill=\"hsl(var(--chart-1))\"\n                dataKey=\"value\"\n              >\n                {chartData.map((_, index) => (\n                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                ))}\n              </Pie>\n              <Tooltip\n                contentStyle={{\n                  backgroundColor: \"hsl(var(--popover))\",\n                  border: \"1px solid hsl(var(--border))\",\n                  borderRadius: \"6px\",\n                }}\n              />\n              <Legend />\n            </PieChart>\n          </ResponsiveContainer>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2480,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"server/storage.ts":{"content":"import { \n  materialProductMappings, \n  stockLedger,\n  processedOrders,\n  wooCommerceCredentials,\n  suppliers,\n  purchaseOrders,\n  purchaseOrderItems,\n  users,\n  rawMaterials,\n  rawMaterialVariations,\n  type InsertMaterialProductMapping,\n  type MaterialProductMapping,\n  type InsertStockLedger,\n  type StockLedgerEntry,\n  type InsertProcessedOrder,\n  type ProcessedOrder,\n  type WooCommerceCredentials,\n  type InsertSupplier,\n  type Supplier,\n  type InsertPurchaseOrder,\n  type PurchaseOrder,\n  type InsertPurchaseOrderItem,\n  type PurchaseOrderItem,\n  type InsertUser,\n  type User,\n  type InsertRawMaterial,\n  type LocalRawMaterial,\n  type InsertRawMaterialVariation,\n  type LocalRawMaterialVariation,\n  type LocalRawMaterialWithVariations,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc, sql, asc, or, ilike } from \"drizzle-orm\";\nimport { encrypt, decrypt } from \"./encryption\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport { pool } from \"./db\";\n\nexport interface DecryptedCredentials {\n  storeUrl: string;\n  consumerKey: string;\n  consumerSecret: string;\n}\n\nexport interface PurchaseOrderFilters {\n  status?: string;\n  supplierId?: number;\n  search?: string;\n}\n\nexport interface PurchaseOrderWithDetails extends PurchaseOrder {\n  supplier?: Supplier;\n  items: PurchaseOrderItem[];\n}\n\nexport interface BulkMappingTarget {\n  productId: number;\n  variationId: number | null;\n  quantityUsed: number;\n}\n\nexport interface IStorage {\n  // User authentication\n  getUser(id: number): Promise<User | null>;\n  getUserByUsername(username: string): Promise<User | null>;\n  createUser(user: InsertUser): Promise<User>;\n  sessionStore: session.Store;\n\n  getMaterialMappings(): Promise<MaterialProductMapping[]>;\n  getMaterialMappingsForProduct(productId: number, variationId?: number): Promise<MaterialProductMapping[]>;\n  getMaterialMappingsForMaterial(materialProductId: number, materialVariationId?: number | null): Promise<MaterialProductMapping[]>;\n  createMaterialMapping(mapping: InsertMaterialProductMapping): Promise<MaterialProductMapping>;\n  bulkCreateMaterialMappings(materialProductId: number, materialVariationId: number | null, targets: BulkMappingTarget[]): Promise<MaterialProductMapping[]>;\n  updateMaterialMapping(id: number, quantityUsed: number): Promise<MaterialProductMapping | null>;\n  deleteMaterialMapping(id: number): Promise<void>;\n  \n  getStockLedgerEntries(materialProductId?: number, limit?: number): Promise<StockLedgerEntry[]>;\n  createStockLedgerEntry(entry: InsertStockLedger): Promise<StockLedgerEntry>;\n  \n  getProcessedOrder(orderId: number): Promise<ProcessedOrder | null>;\n  getAllProcessedOrders(): Promise<ProcessedOrder[]>;\n  markOrderProcessed(data: InsertProcessedOrder): Promise<ProcessedOrder>;\n  \n  getCredentials(): Promise<DecryptedCredentials | null>;\n  hasCredentials(): Promise<boolean>;\n  saveCredentials(storeUrl: string, consumerKey: string, consumerSecret: string): Promise<void>;\n  deleteCredentials(): Promise<void>;\n\n  // Suppliers\n  getSuppliers(activeOnly?: boolean): Promise<Supplier[]>;\n  getSupplier(id: number): Promise<Supplier | null>;\n  createSupplier(supplier: InsertSupplier): Promise<Supplier>;\n  updateSupplier(id: number, supplier: Partial<InsertSupplier>): Promise<Supplier | null>;\n  deleteSupplier(id: number): Promise<void>;\n\n  // Purchase Orders\n  getPurchaseOrders(filters?: PurchaseOrderFilters): Promise<PurchaseOrderWithDetails[]>;\n  getPurchaseOrder(id: number): Promise<PurchaseOrderWithDetails | null>;\n  getNextPONumber(): Promise<string>;\n  createPurchaseOrder(po: InsertPurchaseOrder, items: InsertPurchaseOrderItem[]): Promise<PurchaseOrderWithDetails>;\n  updatePurchaseOrder(id: number, po: Partial<InsertPurchaseOrder>, items?: InsertPurchaseOrderItem[]): Promise<PurchaseOrderWithDetails | null>;\n  deletePurchaseOrder(id: number): Promise<void>;\n  \n  // Purchase Order Items\n  getPurchaseOrderItems(purchaseOrderId: number): Promise<PurchaseOrderItem[]>;\n  addPurchaseOrderItem(purchaseOrderId: number, item: InsertPurchaseOrderItem): Promise<PurchaseOrderItem>;\n  updatePurchaseOrderItem(id: number, data: Partial<InsertPurchaseOrderItem>): Promise<PurchaseOrderItem | null>;\n  deletePurchaseOrderItem(id: number): Promise<void>;\n  receivePurchaseOrderItems(purchaseOrderId: number, itemReceipts: { itemId: number; quantityReceived: number }[]): Promise<PurchaseOrderWithDetails>;\n  recalculatePurchaseOrderTotals(purchaseOrderId: number): Promise<PurchaseOrderWithDetails | null>;\n\n  // Local Raw Materials\n  getLocalRawMaterials(activeOnly?: boolean): Promise<LocalRawMaterialWithVariations[]>;\n  getLocalRawMaterial(id: number): Promise<LocalRawMaterialWithVariations | null>;\n  getLocalRawMaterialByWooId(woocommerceId: number): Promise<LocalRawMaterial | null>;\n  createLocalRawMaterial(material: InsertRawMaterial): Promise<LocalRawMaterial>;\n  updateLocalRawMaterial(id: number, material: Partial<InsertRawMaterial>): Promise<LocalRawMaterial | null>;\n  deleteLocalRawMaterial(id: number): Promise<void>;\n  updateLocalRawMaterialStock(id: number, newStock: number): Promise<LocalRawMaterial | null>;\n\n  // Local Raw Material Variations\n  getLocalRawMaterialVariations(materialId: number): Promise<LocalRawMaterialVariation[]>;\n  getLocalRawMaterialVariation(id: number): Promise<LocalRawMaterialVariation | null>;\n  getLocalRawMaterialVariationByWooId(woocommerceId: number): Promise<LocalRawMaterialVariation | null>;\n  createLocalRawMaterialVariation(variation: InsertRawMaterialVariation): Promise<LocalRawMaterialVariation>;\n  updateLocalRawMaterialVariation(id: number, variation: Partial<InsertRawMaterialVariation>): Promise<LocalRawMaterialVariation | null>;\n  deleteLocalRawMaterialVariation(id: number): Promise<void>;\n  updateLocalRawMaterialVariationStock(id: number, newStock: number): Promise<LocalRawMaterialVariation | null>;\n}\n\nconst PostgresSessionStore = connectPg(session);\n\nexport class DatabaseStorage implements IStorage {\n  sessionStore: session.Store;\n\n  constructor() {\n    this.sessionStore = new PostgresSessionStore({ \n      pool: pool as any, \n      createTableIfMissing: true \n    });\n  }\n\n  async getUser(id: number): Promise<User | null> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || null;\n  }\n\n  async getUserByUsername(username: string): Promise<User | null> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || null;\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    const [newUser] = await db.insert(users).values(user).returning();\n    return newUser;\n  }\n\n  async getMaterialMappings(): Promise<MaterialProductMapping[]> {\n    return await db.select().from(materialProductMappings);\n  }\n\n  async getMaterialMappingsForProduct(productId: number, variationId?: number): Promise<MaterialProductMapping[]> {\n    if (variationId) {\n      return await db.select()\n        .from(materialProductMappings)\n        .where(\n          and(\n            eq(materialProductMappings.productId, productId),\n            eq(materialProductMappings.variationId, variationId)\n          )\n        );\n    }\n    return await db.select()\n      .from(materialProductMappings)\n      .where(eq(materialProductMappings.productId, productId));\n  }\n\n  async getMaterialMappingsForMaterial(materialProductId: number, materialVariationId?: number | null): Promise<MaterialProductMapping[]> {\n    if (materialVariationId !== undefined) {\n      // Filter by both material product and variation\n      if (materialVariationId === null) {\n        return await db.select()\n          .from(materialProductMappings)\n          .where(\n            and(\n              eq(materialProductMappings.materialProductId, materialProductId),\n              sql`${materialProductMappings.materialVariationId} IS NULL`\n            )\n          );\n      }\n      return await db.select()\n        .from(materialProductMappings)\n        .where(\n          and(\n            eq(materialProductMappings.materialProductId, materialProductId),\n            eq(materialProductMappings.materialVariationId, materialVariationId)\n          )\n        );\n    }\n    // Just filter by material product ID\n    return await db.select()\n      .from(materialProductMappings)\n      .where(eq(materialProductMappings.materialProductId, materialProductId));\n  }\n\n  async createMaterialMapping(mapping: InsertMaterialProductMapping): Promise<MaterialProductMapping> {\n    const [result] = await db.insert(materialProductMappings)\n      .values(mapping)\n      .returning();\n    return result;\n  }\n\n  async bulkCreateMaterialMappings(\n    materialProductId: number, \n    materialVariationId: number | null, \n    targets: BulkMappingTarget[]\n  ): Promise<MaterialProductMapping[]> {\n    const results: MaterialProductMapping[] = [];\n    \n    for (const target of targets) {\n      try {\n        const [result] = await db.insert(materialProductMappings)\n          .values({\n            materialProductId,\n            materialVariationId,\n            productId: target.productId,\n            variationId: target.variationId,\n            quantityUsed: target.quantityUsed,\n          })\n          .returning();\n        results.push(result);\n      } catch (error: any) {\n        // Skip duplicates (unique constraint violation)\n        if (!error.message?.includes('unique') && !error.code?.includes('23505')) {\n          throw error;\n        }\n      }\n    }\n    \n    return results;\n  }\n\n  async updateMaterialMapping(id: number, quantityUsed: number): Promise<MaterialProductMapping | null> {\n    const [result] = await db.update(materialProductMappings)\n      .set({ quantityUsed })\n      .where(eq(materialProductMappings.id, id))\n      .returning();\n    return result || null;\n  }\n\n  async deleteMaterialMapping(id: number): Promise<void> {\n    await db.delete(materialProductMappings)\n      .where(eq(materialProductMappings.id, id));\n  }\n\n  async getStockLedgerEntries(materialProductId?: number, limit: number = 100): Promise<StockLedgerEntry[]> {\n    if (materialProductId) {\n      return await db.select()\n        .from(stockLedger)\n        .where(eq(stockLedger.materialProductId, materialProductId))\n        .orderBy(stockLedger.createdAt)\n        .limit(limit);\n    }\n    return await db.select()\n      .from(stockLedger)\n      .orderBy(stockLedger.createdAt)\n      .limit(limit);\n  }\n\n  async createStockLedgerEntry(entry: InsertStockLedger): Promise<StockLedgerEntry> {\n    const [result] = await db.insert(stockLedger)\n      .values(entry)\n      .returning();\n    return result;\n  }\n\n  async getProcessedOrder(orderId: number): Promise<ProcessedOrder | null> {\n    const [result] = await db.select()\n      .from(processedOrders)\n      .where(eq(processedOrders.orderId, orderId))\n      .limit(1);\n    return result || null;\n  }\n\n  async getAllProcessedOrders(): Promise<ProcessedOrder[]> {\n    return await db.select().from(processedOrders);\n  }\n\n  async markOrderProcessed(data: InsertProcessedOrder): Promise<ProcessedOrder> {\n    const [result] = await db.insert(processedOrders)\n      .values(data)\n      .returning();\n    return result;\n  }\n\n  async getCredentials(): Promise<DecryptedCredentials | null> {\n    const [result] = await db.select()\n      .from(wooCommerceCredentials)\n      .where(eq(wooCommerceCredentials.isActive, true))\n      .limit(1);\n    \n    if (!result) return null;\n    \n    try {\n      return {\n        storeUrl: result.storeUrl,\n        consumerKey: decrypt(result.consumerKey),\n        consumerSecret: decrypt(result.consumerSecret),\n      };\n    } catch (error) {\n      console.error(\"Failed to decrypt credentials:\", error);\n      return null;\n    }\n  }\n\n  async hasCredentials(): Promise<boolean> {\n    const [result] = await db.select({ id: wooCommerceCredentials.id })\n      .from(wooCommerceCredentials)\n      .where(eq(wooCommerceCredentials.isActive, true))\n      .limit(1);\n    return !!result;\n  }\n\n  async saveCredentials(storeUrl: string, consumerKey: string, consumerSecret: string): Promise<void> {\n    const encryptedKey = encrypt(consumerKey);\n    const encryptedSecret = encrypt(consumerSecret);\n    \n    await db.delete(wooCommerceCredentials);\n    \n    await db.insert(wooCommerceCredentials)\n      .values({\n        storeUrl,\n        consumerKey: encryptedKey,\n        consumerSecret: encryptedSecret,\n        isActive: true,\n      });\n  }\n\n  async deleteCredentials(): Promise<void> {\n    await db.delete(wooCommerceCredentials);\n  }\n\n  // ============================================\n  // SUPPLIERS\n  // ============================================\n\n  async getSuppliers(activeOnly: boolean = true): Promise<Supplier[]> {\n    if (activeOnly) {\n      return await db.select()\n        .from(suppliers)\n        .where(eq(suppliers.isActive, true))\n        .orderBy(asc(suppliers.name));\n    }\n    return await db.select()\n      .from(suppliers)\n      .orderBy(asc(suppliers.name));\n  }\n\n  async getSupplier(id: number): Promise<Supplier | null> {\n    const [result] = await db.select()\n      .from(suppliers)\n      .where(eq(suppliers.id, id))\n      .limit(1);\n    return result || null;\n  }\n\n  async createSupplier(supplier: InsertSupplier): Promise<Supplier> {\n    const [result] = await db.insert(suppliers)\n      .values(supplier)\n      .returning();\n    return result;\n  }\n\n  async updateSupplier(id: number, supplier: Partial<InsertSupplier>): Promise<Supplier | null> {\n    const [result] = await db.update(suppliers)\n      .set({ ...supplier, updatedAt: new Date() })\n      .where(eq(suppliers.id, id))\n      .returning();\n    return result || null;\n  }\n\n  async deleteSupplier(id: number): Promise<void> {\n    await db.update(suppliers)\n      .set({ isActive: false, updatedAt: new Date() })\n      .where(eq(suppliers.id, id));\n  }\n\n  async getSupplierStatistics(): Promise<{ supplierId: number; poCount: number; totalSpent: string }[]> {\n    // Fetch all active suppliers\n    const allSuppliers = await db.select({ id: suppliers.id })\n      .from(suppliers)\n      .where(eq(suppliers.isActive, true));\n    \n    // Fetch all non-cancelled purchase orders\n    const allPurchaseOrders = await db.select({\n      supplierId: purchaseOrders.supplierId,\n      grandTotal: purchaseOrders.grandTotal,\n    })\n      .from(purchaseOrders)\n      .where(sql`${purchaseOrders.status} != 'cancelled'`);\n    \n    // Aggregate in JavaScript\n    const statsMap = new Map<number, { poCount: number; totalSpent: number }>();\n    \n    // Initialize all suppliers with zero values\n    for (const supplier of allSuppliers) {\n      statsMap.set(supplier.id, { poCount: 0, totalSpent: 0 });\n    }\n    \n    // Aggregate purchase orders\n    for (const po of allPurchaseOrders) {\n      const existing = statsMap.get(po.supplierId);\n      if (existing) {\n        existing.poCount += 1;\n        existing.totalSpent += parseFloat(po.grandTotal || \"0\");\n      }\n    }\n    \n    // Convert to result array\n    return Array.from(statsMap.entries()).map(([supplierId, stats]) => ({\n      supplierId,\n      poCount: stats.poCount,\n      totalSpent: stats.totalSpent.toFixed(2),\n    }));\n  }\n\n  async getSupplierPurchaseOrders(supplierId: number): Promise<PurchaseOrderWithDetails[]> {\n    const results = await db.select()\n      .from(purchaseOrders)\n      .leftJoin(suppliers, eq(purchaseOrders.supplierId, suppliers.id))\n      .where(eq(purchaseOrders.supplierId, supplierId))\n      .orderBy(desc(purchaseOrders.createdAt));\n\n    const ordersWithItems: PurchaseOrderWithDetails[] = [];\n    for (const row of results) {\n      const po = row.purchase_orders;\n      const supplier = row.suppliers;\n\n      const items = await db.select()\n        .from(purchaseOrderItems)\n        .where(eq(purchaseOrderItems.purchaseOrderId, po.id));\n\n      ordersWithItems.push({\n        ...po,\n        supplier: supplier || undefined,\n        items,\n      });\n    }\n\n    return ordersWithItems;\n  }\n\n  // ============================================\n  // PURCHASE ORDERS\n  // ============================================\n\n  async getPurchaseOrders(filters?: PurchaseOrderFilters): Promise<PurchaseOrderWithDetails[]> {\n    let query = db.select()\n      .from(purchaseOrders)\n      .leftJoin(suppliers, eq(purchaseOrders.supplierId, suppliers.id))\n      .orderBy(desc(purchaseOrders.createdAt));\n\n    const results = await query;\n\n    const ordersWithItems: PurchaseOrderWithDetails[] = [];\n    for (const row of results) {\n      const po = row.purchase_orders;\n      const supplier = row.suppliers;\n\n      if (filters?.status && po.status !== filters.status) continue;\n      if (filters?.supplierId && po.supplierId !== filters.supplierId) continue;\n      if (filters?.search) {\n        const searchLower = filters.search.toLowerCase();\n        if (!po.poNumber.toLowerCase().includes(searchLower) &&\n            !(supplier?.name?.toLowerCase().includes(searchLower))) {\n          continue;\n        }\n      }\n\n      const items = await db.select()\n        .from(purchaseOrderItems)\n        .where(eq(purchaseOrderItems.purchaseOrderId, po.id));\n\n      ordersWithItems.push({\n        ...po,\n        supplier: supplier || undefined,\n        items,\n      });\n    }\n\n    return ordersWithItems;\n  }\n\n  async getPurchaseOrder(id: number): Promise<PurchaseOrderWithDetails | null> {\n    const [row] = await db.select()\n      .from(purchaseOrders)\n      .leftJoin(suppliers, eq(purchaseOrders.supplierId, suppliers.id))\n      .where(eq(purchaseOrders.id, id))\n      .limit(1);\n\n    if (!row) return null;\n\n    const items = await db.select()\n      .from(purchaseOrderItems)\n      .where(eq(purchaseOrderItems.purchaseOrderId, id));\n\n    return {\n      ...row.purchase_orders,\n      supplier: row.suppliers || undefined,\n      items,\n    };\n  }\n\n  async getNextPONumber(): Promise<string> {\n    const [result] = await db.select({ maxId: sql<number>`COALESCE(MAX(id), 0)` })\n      .from(purchaseOrders);\n    const nextNum = (result?.maxId || 0) + 1;\n    const year = new Date().getFullYear();\n    return `PO-${year}-${String(nextNum).padStart(4, '0')}`;\n  }\n\n  async createPurchaseOrder(po: InsertPurchaseOrder, items: InsertPurchaseOrderItem[]): Promise<PurchaseOrderWithDetails> {\n    const [newPO] = await db.insert(purchaseOrders)\n      .values(po)\n      .returning();\n\n    const insertedItems: PurchaseOrderItem[] = [];\n    for (const item of items) {\n      const [newItem] = await db.insert(purchaseOrderItems)\n        .values({ ...item, purchaseOrderId: newPO.id })\n        .returning();\n      insertedItems.push(newItem);\n    }\n\n    const supplier = await this.getSupplier(newPO.supplierId);\n\n    return {\n      ...newPO,\n      supplier: supplier || undefined,\n      items: insertedItems,\n    };\n  }\n\n  async updatePurchaseOrder(id: number, po: Partial<InsertPurchaseOrder>, items?: InsertPurchaseOrderItem[]): Promise<PurchaseOrderWithDetails | null> {\n    const [updatedPO] = await db.update(purchaseOrders)\n      .set({ ...po, updatedAt: new Date() })\n      .where(eq(purchaseOrders.id, id))\n      .returning();\n\n    if (!updatedPO) return null;\n\n    if (items !== undefined) {\n      await db.delete(purchaseOrderItems)\n        .where(eq(purchaseOrderItems.purchaseOrderId, id));\n\n      for (const item of items) {\n        await db.insert(purchaseOrderItems)\n          .values({ ...item, purchaseOrderId: id });\n      }\n    }\n\n    return await this.getPurchaseOrder(id);\n  }\n\n  async deletePurchaseOrder(id: number): Promise<void> {\n    await db.delete(purchaseOrderItems)\n      .where(eq(purchaseOrderItems.purchaseOrderId, id));\n    await db.delete(purchaseOrders)\n      .where(eq(purchaseOrders.id, id));\n  }\n\n  // ============================================\n  // PURCHASE ORDER ITEMS\n  // ============================================\n\n  async getPurchaseOrderItems(purchaseOrderId: number): Promise<PurchaseOrderItem[]> {\n    return await db.select()\n      .from(purchaseOrderItems)\n      .where(eq(purchaseOrderItems.purchaseOrderId, purchaseOrderId));\n  }\n\n  async addPurchaseOrderItem(purchaseOrderId: number, item: InsertPurchaseOrderItem): Promise<PurchaseOrderItem> {\n    const [result] = await db.insert(purchaseOrderItems)\n      .values({ ...item, purchaseOrderId })\n      .returning();\n    return result;\n  }\n\n  async updatePurchaseOrderItem(id: number, data: Partial<InsertPurchaseOrderItem>): Promise<PurchaseOrderItem | null> {\n    const [result] = await db.update(purchaseOrderItems)\n      .set(data)\n      .where(eq(purchaseOrderItems.id, id))\n      .returning();\n    return result || null;\n  }\n\n  async deletePurchaseOrderItem(id: number): Promise<void> {\n    await db.delete(purchaseOrderItems)\n      .where(eq(purchaseOrderItems.id, id));\n  }\n\n  async recalculatePurchaseOrderTotals(purchaseOrderId: number): Promise<PurchaseOrderWithDetails | null> {\n    const po = await this.getPurchaseOrder(purchaseOrderId);\n    if (!po) return null;\n\n    let subtotal = 0;\n    let itemsVat = 0;\n\n    for (const item of po.items) {\n      subtotal += parseFloat(item.lineSubtotal);\n      itemsVat += parseFloat(item.lineVat);\n    }\n\n    const shippingCost = parseFloat(po.shippingCost);\n    const shippingVatRate = parseFloat(po.shippingVatRate);\n    const shippingVat = shippingCost * (shippingVatRate / 100);\n    const vatTotal = itemsVat + shippingVat;\n    const grandTotal = subtotal + vatTotal + shippingCost;\n\n    await db.update(purchaseOrders)\n      .set({\n        subtotal: subtotal.toFixed(2),\n        shippingVat: shippingVat.toFixed(2),\n        vatTotal: vatTotal.toFixed(2),\n        grandTotal: grandTotal.toFixed(2),\n        updatedAt: new Date(),\n      })\n      .where(eq(purchaseOrders.id, purchaseOrderId));\n\n    return await this.getPurchaseOrder(purchaseOrderId);\n  }\n\n  async receivePurchaseOrderItems(\n    purchaseOrderId: number, \n    itemReceipts: { itemId: number; quantityReceived: number }[]\n  ): Promise<PurchaseOrderWithDetails> {\n    for (const receipt of itemReceipts) {\n      const [item] = await db.select()\n        .from(purchaseOrderItems)\n        .where(eq(purchaseOrderItems.id, receipt.itemId))\n        .limit(1);\n\n      if (item && receipt.quantityReceived > 0) {\n        const newQuantityReceived = item.quantityReceived + receipt.quantityReceived;\n        await db.update(purchaseOrderItems)\n          .set({ quantityReceived: newQuantityReceived })\n          .where(eq(purchaseOrderItems.id, receipt.itemId));\n      }\n    }\n\n    const po = await this.getPurchaseOrder(purchaseOrderId);\n    if (!po) throw new Error(\"Purchase order not found\");\n\n    const allReceived = po.items.every(item => item.quantityReceived >= item.quantityOrdered);\n    const someReceived = po.items.some(item => item.quantityReceived > 0);\n\n    let newStatus: \"draft\" | \"ordered\" | \"partially_received\" | \"received\" | \"cancelled\" = po.status;\n    if (allReceived) {\n      newStatus = \"received\";\n    } else if (someReceived) {\n      newStatus = \"partially_received\";\n    }\n\n    if (newStatus !== po.status) {\n      await db.update(purchaseOrders)\n        .set({ \n          status: newStatus, \n          receivedDate: allReceived ? new Date() : null,\n          updatedAt: new Date() \n        })\n        .where(eq(purchaseOrders.id, purchaseOrderId));\n    }\n\n    return (await this.getPurchaseOrder(purchaseOrderId))!;\n  }\n\n  // ============================================\n  // LOCAL RAW MATERIALS\n  // ============================================\n\n  async getLocalRawMaterials(activeOnly: boolean = true): Promise<LocalRawMaterialWithVariations[]> {\n    let materials: LocalRawMaterial[];\n    if (activeOnly) {\n      materials = await db.select()\n        .from(rawMaterials)\n        .where(eq(rawMaterials.isActive, true))\n        .orderBy(asc(rawMaterials.name));\n    } else {\n      materials = await db.select()\n        .from(rawMaterials)\n        .orderBy(asc(rawMaterials.name));\n    }\n\n    // Fetch variations for each material\n    const result: LocalRawMaterialWithVariations[] = [];\n    for (const material of materials) {\n      const variations = await db.select()\n        .from(rawMaterialVariations)\n        .where(and(\n          eq(rawMaterialVariations.materialId, material.id),\n          eq(rawMaterialVariations.isActive, true)\n        ))\n        .orderBy(asc(rawMaterialVariations.name));\n      \n      result.push({\n        ...material,\n        variations: variations.length > 0 ? variations : undefined,\n      });\n    }\n\n    return result;\n  }\n\n  async getLocalRawMaterial(id: number): Promise<LocalRawMaterialWithVariations | null> {\n    const [material] = await db.select()\n      .from(rawMaterials)\n      .where(eq(rawMaterials.id, id))\n      .limit(1);\n\n    if (!material) return null;\n\n    const variations = await db.select()\n      .from(rawMaterialVariations)\n      .where(eq(rawMaterialVariations.materialId, id))\n      .orderBy(asc(rawMaterialVariations.name));\n\n    return {\n      ...material,\n      variations: variations.length > 0 ? variations : undefined,\n    };\n  }\n\n  async getLocalRawMaterialByWooId(woocommerceId: number): Promise<LocalRawMaterial | null> {\n    const [result] = await db.select()\n      .from(rawMaterials)\n      .where(eq(rawMaterials.woocommerceId, woocommerceId))\n      .limit(1);\n    return result || null;\n  }\n\n  async createLocalRawMaterial(material: InsertRawMaterial): Promise<LocalRawMaterial> {\n    const [result] = await db.insert(rawMaterials)\n      .values(material)\n      .returning();\n    return result;\n  }\n\n  async updateLocalRawMaterial(id: number, material: Partial<InsertRawMaterial>): Promise<LocalRawMaterial | null> {\n    const [result] = await db.update(rawMaterials)\n      .set({ ...material, updatedAt: new Date() })\n      .where(eq(rawMaterials.id, id))\n      .returning();\n    return result || null;\n  }\n\n  async deleteLocalRawMaterial(id: number): Promise<void> {\n    // Soft delete - set isActive to false\n    await db.update(rawMaterials)\n      .set({ isActive: false, updatedAt: new Date() })\n      .where(eq(rawMaterials.id, id));\n  }\n\n  async updateLocalRawMaterialStock(id: number, newStock: number): Promise<LocalRawMaterial | null> {\n    const [result] = await db.update(rawMaterials)\n      .set({ stockQuantity: newStock, updatedAt: new Date() })\n      .where(eq(rawMaterials.id, id))\n      .returning();\n    return result || null;\n  }\n\n  // ============================================\n  // LOCAL RAW MATERIAL VARIATIONS\n  // ============================================\n\n  async getLocalRawMaterialVariations(materialId: number): Promise<LocalRawMaterialVariation[]> {\n    return await db.select()\n      .from(rawMaterialVariations)\n      .where(eq(rawMaterialVariations.materialId, materialId))\n      .orderBy(asc(rawMaterialVariations.name));\n  }\n\n  async getLocalRawMaterialVariation(id: number): Promise<LocalRawMaterialVariation | null> {\n    const [result] = await db.select()\n      .from(rawMaterialVariations)\n      .where(eq(rawMaterialVariations.id, id))\n      .limit(1);\n    return result || null;\n  }\n\n  async getLocalRawMaterialVariationByWooId(woocommerceId: number): Promise<LocalRawMaterialVariation | null> {\n    const [result] = await db.select()\n      .from(rawMaterialVariations)\n      .where(eq(rawMaterialVariations.woocommerceId, woocommerceId))\n      .limit(1);\n    return result || null;\n  }\n\n  async createLocalRawMaterialVariation(variation: InsertRawMaterialVariation): Promise<LocalRawMaterialVariation> {\n    const [result] = await db.insert(rawMaterialVariations)\n      .values(variation)\n      .returning();\n    return result;\n  }\n\n  async updateLocalRawMaterialVariation(id: number, variation: Partial<InsertRawMaterialVariation>): Promise<LocalRawMaterialVariation | null> {\n    const [result] = await db.update(rawMaterialVariations)\n      .set({ ...variation, updatedAt: new Date() })\n      .where(eq(rawMaterialVariations.id, id))\n      .returning();\n    return result || null;\n  }\n\n  async deleteLocalRawMaterialVariation(id: number): Promise<void> {\n    // Soft delete\n    await db.update(rawMaterialVariations)\n      .set({ isActive: false, updatedAt: new Date() })\n      .where(eq(rawMaterialVariations.id, id));\n  }\n\n  async updateLocalRawMaterialVariationStock(id: number, newStock: number): Promise<LocalRawMaterialVariation | null> {\n    const [result] = await db.update(rawMaterialVariations)\n      .set({ stockQuantity: newStock, updatedAt: new Date() })\n      .where(eq(rawMaterialVariations.id, id))\n      .returning();\n    return result || null;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":28514,"size_tokens":null},"client/src/components/metric-card.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface MetricCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  subtitle?: string;\n  trend?: {\n    value: number;\n    isPositive: boolean;\n  };\n  testId?: string;\n}\n\nexport function MetricCard({ title, value, icon: Icon, subtitle, trend, testId }: MetricCardProps) {\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between mb-4\">\n          <div className=\"p-2 bg-primary/10 rounded-md\">\n            <Icon className=\"h-5 w-5 text-primary\" />\n          </div>\n          {trend && (\n            <div className={`text-sm font-medium ${trend.isPositive ? 'text-green-600 dark:text-green-500' : 'text-red-600 dark:text-red-500'}`}>\n              {trend.isPositive ? '+' : ''}{trend.value}%\n            </div>\n          )}\n        </div>\n        <div>\n          <p className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide mb-1\">\n            {title}\n          </p>\n          <p className=\"text-4xl font-bold\" data-testid={testId}>\n            {value}\n          </p>\n          {subtitle && (\n            <p className=\"text-sm text-muted-foreground mt-1\">{subtitle}</p>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1338,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"server/index-dev.ts":{"content":"import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { type Server } from \"node:http\";\n\nimport { nanoid } from \"nanoid\";\nimport { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\n\nimport viteConfig from \"../vite.config\";\nimport runApp from \"./app\";\n\nexport async function setupVite(app: Express, server: Server) {\n  const viteLogger = createLogger();\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\n(async () => {\n  await runApp(setupVite);\n})();\n","path":null,"size_bytes":1609,"size_tokens":null},"server/index-prod.ts":{"content":"import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { type Server } from \"node:http\";\n\nimport express, { type Express } from \"express\";\nimport runApp from \"./app\";\n\nexport async function serveStatic(app: Express, _server: Server) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n\n(async () => {\n  await runApp(serveStatic);\n})();\n","path":null,"size_bytes":712,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 0 0% 10%;\n  --border: 0 0% 90%;\n  --card: 0 0% 98%;\n  --card-foreground: 0 0% 10%;\n  --card-border: 0 0% 94%;\n  --sidebar: 0 0% 96%;\n  --sidebar-foreground: 0 0% 10%;\n  --sidebar-border: 0 0% 92%;\n  --sidebar-primary: 217 91% 35%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 0 0% 92%;\n  --sidebar-accent-foreground: 0 0% 10%;\n  --sidebar-ring: 217 91% 35%;\n  --popover: 0 0% 94%;\n  --popover-foreground: 0 0% 10%;\n  --popover-border: 0 0% 90%;\n  --primary: 217 91% 35%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 0 0% 88%;\n  --secondary-foreground: 0 0% 10%;\n  --muted: 0 0% 91%;\n  --muted-foreground: 0 0% 40%;\n  --accent: 217 15% 88%;\n  --accent-foreground: 0 0% 10%;\n  --destructive: 0 84% 40%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 0 0% 75%;\n  --ring: 217 91% 35%;\n  --chart-1: 217 91% 35%;\n  --chart-2: 168 76% 32%;\n  --chart-3: 262 83% 38%;\n  --chart-4: 32 95% 44%;\n  --chart-5: 340 82% 42%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 0 0% 7%;\n  --foreground: 0 0% 95%;\n  --border: 0 0% 16%;\n  --card: 0 0% 9%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 0 0% 13%;\n  --sidebar: 0 0% 11%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 0 0% 15%;\n  --sidebar-primary: 217 91% 45%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 0 0% 15%;\n  --sidebar-accent-foreground: 0 0% 95%;\n  --sidebar-ring: 217 91% 45%;\n  --popover: 0 0% 13%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 0 0% 17%;\n  --primary: 217 91% 35%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 0 0% 17%;\n  --secondary-foreground: 0 0% 95%;\n  --muted: 0 0% 16%;\n  --muted-foreground: 0 0% 65%;\n  --accent: 217 12% 18%;\n  --accent-foreground: 0 0% 95%;\n  --destructive: 0 84% 35%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 0 0% 30%;\n  --ring: 217 91% 45%;\n  --chart-1: 217 91% 55%;\n  --chart-2: 168 76% 52%;\n  --chart-3: 262 83% 58%;\n  --chart-4: 32 95% 64%;\n  --chart-5: 340 82% 62%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10538,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n  toggleTheme: () => void;\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState | undefined>(\n  undefined\n);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"light\",\n}: ThemeProviderProps) {\n  const [theme, setThemeState] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"wc-reports-theme\") as Theme;\n      return stored || defaultTheme;\n    }\n    return defaultTheme;\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"wc-reports-theme\", theme);\n  }, [theme]);\n\n  const setTheme = (newTheme: Theme) => {\n    setThemeState(newTheme);\n  };\n\n  const toggleTheme = () => {\n    setThemeState((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeProviderContext.Provider value={{ theme, setTheme, toggleTheme }}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeProviderContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1476,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"design_guidelines.md":{"content":"# WooCommerce Order Reporting Dashboard - Design Guidelines\n\n## Design Approach\n\n**Selected Approach:** Design System (Data-Focused Dashboard)\n\n**Primary Reference:** Stripe Dashboard + Material Design data visualization principles\n\n**Justification:** This is a utility-focused, information-dense analytics application where data comprehension, efficiency, and professional presentation are paramount. The design should prioritize clarity, scanability, and quick insights over visual flourish.\n\n**Key Design Principles:**\n- Data hierarchy: Most critical metrics immediately visible\n- Scannable layouts: Grid-based organization for quick information parsing\n- Professional restraint: Clean, uncluttered interface that inspires confidence\n- Efficient interactions: Minimal clicks to access detailed insights\n\n## Typography System\n\n**Font Family:** Inter or IBM Plex Sans via Google Fonts CDN\n\n**Hierarchy:**\n- Dashboard Title: text-3xl font-bold\n- Section Headers: text-xl font-semibold\n- Metric Values: text-4xl font-bold (for key numbers)\n- Metric Labels: text-sm font-medium uppercase tracking-wide\n- Body Text: text-base font-normal\n- Table Headers: text-xs font-semibold uppercase tracking-wider\n- Table Data: text-sm font-normal\n- Buttons/Actions: text-sm font-medium\n\n## Layout System\n\n**Spacing Primitives:** Tailwind units of 2, 4, 6, 8, and 12\n- Tight spacing: p-2, gap-2 (within components)\n- Standard spacing: p-4, gap-4 (component padding)\n- Section spacing: p-6, gap-6 (between related groups)\n- Major spacing: p-8, gap-8 (page sections)\n- Large spacing: p-12 (outer containers)\n\n**Grid Structure:**\n- Dashboard container: max-w-7xl mx-auto px-6\n- Metrics grid: grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\n- Content sections: grid-cols-1 lg:grid-cols-3 gap-8 (2:1 split for chart:filters)\n\n## Component Library\n\n### Navigation Header\nTop navigation bar with store logo/name, dark mode toggle, and user account menu. Sticky positioning (sticky top-0). Height h-16 with px-6 horizontal padding.\n\n### Metrics Dashboard Cards\nFour primary metric cards displayed in responsive grid:\n- Total Revenue (current period)\n- Total Orders (with comparison to previous period)\n- Average Order Value\n- Pending Orders Count\n\nEach card structure: rounded-lg border with p-6 padding, metric label at top, large number display, trend indicator (/ with percentage change).\n\n### Order Status Overview\nHorizontal stat bars showing counts by status (Processing, Completed, Pending, Cancelled, Refunded, Failed). Each status gets dedicated card in grid-cols-2 md:grid-cols-3 lg:grid-cols-6 layout.\n\n### Charts Section\nLarge chart area with tabbed navigation for different views:\n- Orders Over Time (line/area chart)\n- Revenue Trends (bar chart)\n- Status Distribution (donut chart)\n\nChart container: rounded-lg border p-6, minimum height h-96. Use Chart.js or Recharts via CDN for visualization.\n\n### Filters Panel\nSidebar or top panel with filter controls:\n- Date range picker (preset ranges: Today, Last 7 days, Last 30 days, Custom)\n- Status multi-select dropdown\n- Search by order number or customer\n- Apply/Reset buttons\n\nLayout as vertical stack with gap-4 spacing between filter groups.\n\n### Orders Table\nFull-width responsive table with:\n- Columns: Order #, Customer, Date, Status, Total, Actions\n- Sortable headers (clickable with sort icons)\n- Row hover state for better scanning\n- Status badges with rounded-full px-3 py-1 styling\n- Actions dropdown menu per row\n- Pagination controls at bottom\n\nMobile: Stack into card layout below md breakpoint.\n\n### Export & Actions Bar\nPositioned above table with space-between layout:\n- Left: \"Showing X-Y of Z orders\" count\n- Right: Export to CSV button, Refresh button\n\n### Dark Mode Implementation\nToggle switch in header. Affects:\n- Background layers: Base background, elevated surfaces (cards/tables), overlays\n- Text hierarchy: Primary, secondary, disabled states\n- Borders and dividers\n- Chart color schemes\n\nStore preference in localStorage for persistence.\n\n## Data Visualization\n\n**Chart Requirements:**\n- Use consistent color palette across all charts (defined in color phase)\n- Include legend, axis labels, tooltips on hover\n- Responsive sizing with maintainAspectRatio\n- Grid lines for easier reading\n- Smooth animations on load (duration: 750ms)\n\n**Icons:** Use Heroicons via CDN for all interface icons (chevrons, calendar, download, refresh, etc.)\n\n## Accessibility\n\n- All interactive elements have min-height/min-width of 44px\n- Form inputs include visible labels and placeholder text\n- Keyboard navigation fully supported (tab order logical)\n- Focus states visible on all interactive elements (ring-2)\n- Status badges use both color and text/icons for information\n- High contrast maintained in both light and dark modes\n\n## Page Structure\n\n1. **Header** (sticky): Logo, navigation, dark mode toggle, account menu\n2. **Dashboard Title & Period Selector**: Page heading with date range display\n3. **Metrics Grid**: 4-column KPI cards\n4. **Status Overview**: 6-column status count cards\n5. **Main Content Area**: \n   - Charts section (2/3 width on desktop)\n   - Filters panel (1/3 width, sticky on desktop, collapsible on mobile)\n6. **Orders Table Section**: Full-width with search/export controls\n7. **Footer**: Minimal with sync status and last updated timestamp\n\nNo hero section needed - this is a functional dashboard where users dive straight into data upon login.","path":null,"size_bytes":5431,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/pages/purchase-orders.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useCredentials } from \"@/contexts/credentials-context\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Select, \n  SelectContent, \n  SelectItem, \n  SelectTrigger, \n  SelectValue \n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { \n  Plus,\n  Search,\n  Loader2,\n  Package,\n  Trash2,\n  Eye,\n  PackageCheck,\n  Building2,\n  Calendar,\n  FileText,\n  Edit,\n  X,\n  Check,\n  FileDown,\n  Printer\n} from \"lucide-react\";\nimport { useState, useMemo } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport type { Supplier, LocalRawMaterialWithVariations, LocalRawMaterialVariation } from \"@shared/schema\";\n\ninterface PurchaseOrderItem {\n  id: number;\n  purchaseOrderId: number;\n  materialProductId: number;\n  materialVariationId: number | null;\n  materialName: string;\n  quantityOrdered: number;\n  quantityReceived: number;\n  unitPrice: string;\n  vatRate: string;\n  lineSubtotal: string;\n  lineVat: string;\n  lineTotal: string;\n}\n\ninterface PurchaseOrderWithDetails {\n  id: number;\n  poNumber: string;\n  supplierId: number;\n  supplier?: Supplier;\n  status: \"draft\" | \"ordered\" | \"partially_received\" | \"received\" | \"cancelled\";\n  orderDate: string | null;\n  expectedDeliveryDate: string | null;\n  receivedDate: string | null;\n  subtotal: string;\n  shippingCost: string;\n  shippingVatRate: string;\n  shippingVat: string;\n  vatTotal: string;\n  grandTotal: string;\n  notes: string | null;\n  createdAt: string;\n  updatedAt: string;\n  items: PurchaseOrderItem[];\n}\n\ninterface NewPOItem {\n  materialProductId: number;\n  materialVariationId: number | null;\n  materialName: string;\n  quantityOrdered: number;\n  unitPrice: string;\n  vatRate: string;\n}\n\nexport default function PurchaseOrders() {\n  const { hasCredentials } = useCredentials();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [supplierFilter, setSupplierFilter] = useState<string>(\"all\");\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const [showDetailsDialog, setShowDetailsDialog] = useState(false);\n  const [showReceiveDialog, setShowReceiveDialog] = useState(false);\n  const [showSupplierDialog, setShowSupplierDialog] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [selectedPO, setSelectedPO] = useState<PurchaseOrderWithDetails | null>(null);\n  const [receiveQuantities, setReceiveQuantities] = useState<Record<number, number>>({});\n  const [checkedItems, setCheckedItems] = useState<Set<number>>(new Set());\n\n  // Form state for creating/editing PO\n  const [formSupplierId, setFormSupplierId] = useState<string>(\"\");\n  const [formOrderDate, setFormOrderDate] = useState<string>(\"\");\n  const [formExpectedDate, setFormExpectedDate] = useState<string>(\"\");\n  const [formShippingCost, setFormShippingCost] = useState<string>(\"0\");\n  const [formShippingVatRate, setFormShippingVatRate] = useState<string>(\"0\");\n  const [formNotes, setFormNotes] = useState<string>(\"\");\n  const [formItems, setFormItems] = useState<NewPOItem[]>([]);\n\n  // Add item form state\n  const [selectedMaterialId, setSelectedMaterialId] = useState<string>(\"\");\n  const [selectedVariationId, setSelectedVariationId] = useState<string>(\"\");\n  const [itemQuantity, setItemQuantity] = useState<number>(1);\n  const [itemUnitPrice, setItemUnitPrice] = useState<string>(\"0.00\");\n  const [itemVatRate, setItemVatRate] = useState<string>(\"23\");\n\n  // New supplier form state\n  const [newSupplierName, setNewSupplierName] = useState(\"\");\n  const [newSupplierEmail, setNewSupplierEmail] = useState(\"\");\n  const [newSupplierPhone, setNewSupplierPhone] = useState(\"\");\n  const [newSupplierAddress, setNewSupplierAddress] = useState(\"\");\n  const [newSupplierContact, setNewSupplierContact] = useState(\"\");\n\n  // Queries\n  const { data: purchaseOrders, isLoading: ordersLoading } = useQuery<PurchaseOrderWithDetails[]>({\n    queryKey: [\"/api/purchase-orders\"],\n  });\n\n  const { data: suppliers, isLoading: suppliersLoading } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const { data: rawMaterials, isLoading: materialsLoading } = useQuery<LocalRawMaterialWithVariations[]>({\n    queryKey: [\"/api/local-materials\"],\n  });\n\n  const { data: nextPONumber } = useQuery<{ poNumber: string }>({\n    queryKey: [\"/api/purchase-orders/next-number\"],\n    enabled: showCreateDialog,\n  });\n\n  // Get variations for selected material\n  const selectedMaterial = rawMaterials?.find(m => m.id === parseInt(selectedMaterialId));\n  const materialVariations = selectedMaterial?.type === \"variable\" ? selectedMaterial.variations : [];\n\n  // Mutations\n  const createSupplierMutation = useMutation({\n    mutationFn: async (data: Partial<Supplier>) => {\n      return apiRequest(\"POST\", \"/api/suppliers\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setShowSupplierDialog(false);\n      resetSupplierForm();\n      toast({\n        title: \"Supplier Created\",\n        description: \"New supplier has been added successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create supplier\",\n      });\n    },\n  });\n\n  const createPOMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return apiRequest(\"POST\", \"/api/purchase-orders\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders/next-number\"] });\n      setShowCreateDialog(false);\n      resetPOForm();\n      toast({\n        title: \"Purchase Order Created\",\n        description: \"New purchase order has been created successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create purchase order\",\n      });\n    },\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return apiRequest(\"PATCH\", `/api/purchase-orders/${id}/status`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      toast({\n        title: \"Status Updated\",\n        description: \"Purchase order status has been updated.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to update status\",\n      });\n    },\n  });\n\n  const deletePOMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/purchase-orders/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      setShowDeleteDialog(false);\n      setSelectedPO(null);\n      toast({\n        title: \"Purchase Order Deleted\",\n        description: \"The purchase order has been deleted.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to delete purchase order\",\n      });\n    },\n  });\n\n  const receiveItemsMutation = useMutation({\n    mutationFn: async ({ id, items }: { id: number; items: { itemId: number; quantityReceived: number }[] }) => {\n      return apiRequest(\"POST\", `/api/purchase-orders/${id}/receive`, { items });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/local-materials\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stock-ledger\"] });\n      setShowReceiveDialog(false);\n      setSelectedPO(null);\n      setReceiveQuantities({});\n      setCheckedItems(new Set());\n      toast({\n        title: \"Items Received\",\n        description: \"Stock has been updated with received items.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to receive items\",\n      });\n    },\n  });\n\n  const addItemMutation = useMutation({\n    mutationFn: async ({ poId, item }: { poId: number; item: NewPOItem }) => {\n      return apiRequest(\"POST\", `/api/purchase-orders/${poId}/items`, item);\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      if (data) {\n        setSelectedPO(data);\n      }\n      toast({\n        title: \"Item Added\",\n        description: \"Item has been added to the purchase order.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to add item\",\n      });\n    },\n  });\n\n  const removeItemMutation = useMutation({\n    mutationFn: async ({ poId, itemId }: { poId: number; itemId: number }) => {\n      return apiRequest(\"DELETE\", `/api/purchase-orders/${poId}/items/${itemId}`);\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      setSelectedPO(data);\n      toast({\n        title: \"Item Removed\",\n        description: \"Item has been removed from the purchase order.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to remove item\",\n      });\n    },\n  });\n\n  const updateShippingMutation = useMutation({\n    mutationFn: async ({ poId, shippingCost, shippingVatRate }: { poId: number; shippingCost: string; shippingVatRate: string }) => {\n      return apiRequest(\"PATCH\", `/api/purchase-orders/${poId}/shipping`, { shippingCost, shippingVatRate });\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/purchase-orders\"] });\n      setSelectedPO(data);\n      toast({\n        title: \"Shipping Updated\",\n        description: \"Shipping details have been updated.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to update shipping\",\n      });\n    },\n  });\n\n  const resetSupplierForm = () => {\n    setNewSupplierName(\"\");\n    setNewSupplierEmail(\"\");\n    setNewSupplierPhone(\"\");\n    setNewSupplierAddress(\"\");\n    setNewSupplierContact(\"\");\n  };\n\n  const resetPOForm = () => {\n    setFormSupplierId(\"\");\n    setFormOrderDate(\"\");\n    setFormExpectedDate(\"\");\n    setFormShippingCost(\"0\");\n    setFormShippingVatRate(\"0\");\n    setFormNotes(\"\");\n    setFormItems([]);\n    setSelectedMaterialId(\"\");\n    setSelectedVariationId(\"\");\n    setItemQuantity(1);\n    setItemUnitPrice(\"0.00\");\n    setItemVatRate(\"23\");\n  };\n\n  const addItemToForm = () => {\n    if (!selectedMaterialId || itemQuantity <= 0) return;\n\n    const material = rawMaterials?.find(m => m.id === parseInt(selectedMaterialId));\n    if (!material) return;\n\n    let materialName = material.name;\n    let variationId: number | null = null;\n\n    if (selectedVariationId && material.type === \"variable\") {\n      const variation = material.variations?.find(v => v.id === parseInt(selectedVariationId));\n      if (variation) {\n        materialName = `${material.name} - ${variation.name}`;\n        variationId = variation.id;\n      }\n    }\n\n    setFormItems([...formItems, {\n      materialProductId: parseInt(selectedMaterialId),\n      materialVariationId: variationId,\n      materialName,\n      quantityOrdered: itemQuantity,\n      unitPrice: itemUnitPrice,\n      vatRate: itemVatRate,\n    }]);\n\n    setSelectedMaterialId(\"\");\n    setSelectedVariationId(\"\");\n    setItemQuantity(1);\n    setItemUnitPrice(\"0.00\");\n  };\n\n  const removeItemFromForm = (index: number) => {\n    setFormItems(formItems.filter((_, i) => i !== index));\n  };\n\n  const handleCreatePO = () => {\n    if (!formSupplierId || formItems.length === 0) {\n      toast({\n        variant: \"destructive\",\n        title: \"Validation Error\",\n        description: \"Please select a supplier and add at least one item.\",\n      });\n      return;\n    }\n\n    createPOMutation.mutate({\n      poNumber: nextPONumber?.poNumber || `PO-${Date.now()}`,\n      supplierId: parseInt(formSupplierId),\n      status: \"draft\",\n      orderDate: formOrderDate || null,\n      expectedDeliveryDate: formExpectedDate || null,\n      shippingCost: formShippingCost,\n      notes: formNotes || null,\n      items: formItems,\n    });\n  };\n\n  const handleReceiveItems = () => {\n    if (!selectedPO) return;\n\n    // Build items from checked checkboxes - receive remaining quantity for each checked item\n    const items = selectedPO.items\n      .filter(item => checkedItems.has(item.id))\n      .filter(item => item.quantityReceived < item.quantityOrdered)\n      .map(item => ({\n        itemId: item.id,\n        quantityReceived: item.quantityOrdered - item.quantityReceived,\n      }));\n\n    if (items.length === 0) {\n      toast({\n        variant: \"destructive\",\n        title: \"No Items Selected\",\n        description: \"Please tick the items you have received.\",\n      });\n      return;\n    }\n\n    receiveItemsMutation.mutate({ id: selectedPO.id, items });\n  };\n\n  const handleAddItemToDraftPO = () => {\n    if (!selectedPO || !selectedMaterialId) return;\n\n    const material = rawMaterials?.find(m => m.id === parseInt(selectedMaterialId));\n    if (!material) return;\n\n    let materialName = material.name;\n    let variationId: number | null = null;\n\n    if (selectedVariationId && material.type === \"variable\") {\n      const variation = material.variations?.find(v => v.id === parseInt(selectedVariationId));\n      if (variation) {\n        variationId = variation.id;\n        materialName = `${material.name} - ${variation.name}`;\n      }\n    }\n\n    addItemMutation.mutate({\n      poId: selectedPO.id,\n      item: {\n        materialProductId: material.id,\n        materialVariationId: variationId,\n        materialName,\n        quantityOrdered: itemQuantity,\n        unitPrice: itemUnitPrice,\n        vatRate: itemVatRate,\n      },\n    });\n\n    // Reset item form fields\n    setSelectedMaterialId(\"\");\n    setSelectedVariationId(\"\");\n    setItemQuantity(1);\n    setItemUnitPrice(\"0.00\");\n  };\n\n  const handleDownloadPDF = (poId: number, poNumber: string) => {\n    window.open(`/api/purchase-orders/${poId}/pdf`, '_blank');\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"draft\":\n        return <Badge variant=\"outline\">Draft</Badge>;\n      case \"ordered\":\n        return <Badge className=\"bg-blue-600 hover:bg-blue-700\">Ordered</Badge>;\n      case \"partially_received\":\n        return <Badge className=\"bg-amber-500 hover:bg-amber-600\">Partially Received</Badge>;\n      case \"received\":\n        return <Badge className=\"bg-green-600 hover:bg-green-700\">Received</Badge>;\n      case \"cancelled\":\n        return <Badge variant=\"destructive\">Cancelled</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  const formatCurrency = (amount: string | number) => {\n    const num = typeof amount === \"string\" ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat(\"en-IE\", { style: \"currency\", currency: \"EUR\" }).format(num);\n  };\n\n  const formatDate = (dateStr: string | null) => {\n    if (!dateStr) return \"-\";\n    return new Date(dateStr).toLocaleDateString(\"en-IE\", { \n      day: \"2-digit\", \n      month: \"short\", \n      year: \"numeric\" \n    });\n  };\n\n  // Calculate form totals\n  const formTotals = useMemo(() => {\n    let subtotal = 0;\n    let itemsVat = 0;\n    formItems.forEach(item => {\n      const lineSubtotal = item.quantityOrdered * parseFloat(item.unitPrice);\n      const lineVat = lineSubtotal * (parseFloat(item.vatRate) / 100);\n      subtotal += lineSubtotal;\n      itemsVat += lineVat;\n    });\n    const shipping = parseFloat(formShippingCost) || 0;\n    const shippingVat = shipping * (parseFloat(formShippingVatRate) / 100);\n    const vatTotal = itemsVat + shippingVat;\n    const grandTotal = subtotal + vatTotal + shipping;\n    return { subtotal, itemsVat, shipping, shippingVat, vatTotal, grandTotal };\n  }, [formItems, formShippingCost, formShippingVatRate]);\n\n  // Filter purchase orders\n  const filteredOrders = useMemo(() => {\n    return purchaseOrders?.filter(po => {\n      const matchesSearch = searchTerm === \"\" || \n        po.poNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        po.supplier?.name?.toLowerCase().includes(searchTerm.toLowerCase());\n      const matchesStatus = statusFilter === \"all\" || po.status === statusFilter;\n      const matchesSupplier = supplierFilter === \"all\" || po.supplierId === parseInt(supplierFilter);\n      return matchesSearch && matchesStatus && matchesSupplier;\n    }) || [];\n  }, [purchaseOrders, searchTerm, statusFilter, supplierFilter]);\n\n  if (!hasCredentials) {\n    return (\n      <main className=\"container mx-auto px-6 py-8\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Configure WooCommerce</CardTitle>\n            <CardDescription>\n              Please configure your WooCommerce credentials in Settings to manage purchase orders.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Link href=\"/settings\">\n              <Button data-testid=\"button-go-to-settings\">Go to Settings</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"container mx-auto px-6 py-8\">\n      <div className=\"flex flex-col gap-6\">\n        <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\" data-testid=\"text-purchase-orders-title\">Purchase Orders</h1>\n            <p className=\"text-muted-foreground\">\n              Manage supplier orders and receive stock\n            </p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowSupplierDialog(true)}\n              data-testid=\"button-add-supplier\"\n            >\n              <Building2 className=\"mr-2 h-4 w-4\" />\n              Add Supplier\n            </Button>\n            <Button \n              onClick={() => setShowCreateDialog(true)}\n              data-testid=\"button-create-po\"\n            >\n              <Plus className=\"mr-2 h-4 w-4\" />\n              New Purchase Order\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col gap-4 sm:flex-row\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search by PO number or supplier...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search-po\"\n            />\n          </div>\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-full sm:w-[180px]\" data-testid=\"select-status-filter\">\n              <SelectValue placeholder=\"All Statuses\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Statuses</SelectItem>\n              <SelectItem value=\"draft\">Draft</SelectItem>\n              <SelectItem value=\"ordered\">Ordered</SelectItem>\n              <SelectItem value=\"partially_received\">Partially Received</SelectItem>\n              <SelectItem value=\"received\">Received</SelectItem>\n              <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={supplierFilter} onValueChange={setSupplierFilter}>\n            <SelectTrigger className=\"w-full sm:w-[180px]\" data-testid=\"select-supplier-filter\">\n              <SelectValue placeholder=\"All Suppliers\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Suppliers</SelectItem>\n              {suppliers?.map(supplier => (\n                <SelectItem key={supplier.id} value={supplier.id.toString()}>\n                  {supplier.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <Card>\n          <CardContent className=\"p-0\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>PO Number</TableHead>\n                  <TableHead>Supplier</TableHead>\n                  <TableHead>Status</TableHead>\n                  <TableHead>Order Date</TableHead>\n                  <TableHead>Items</TableHead>\n                  <TableHead className=\"text-right\">Total</TableHead>\n                  <TableHead className=\"text-right\">Actions</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {ordersLoading ? (\n                  [...Array(5)].map((_, i) => (\n                    <TableRow key={i}>\n                      <TableCell><Skeleton className=\"h-4 w-24\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-32\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-6 w-20\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-24\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-12\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-4 w-20 ml-auto\" /></TableCell>\n                      <TableCell><Skeleton className=\"h-8 w-24 ml-auto\" /></TableCell>\n                    </TableRow>\n                  ))\n                ) : filteredOrders.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={7} className=\"h-32 text-center\">\n                      <div className=\"flex flex-col items-center gap-2 text-muted-foreground\">\n                        <FileText className=\"h-8 w-8\" />\n                        <p>No purchase orders found</p>\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => setShowCreateDialog(true)}>\n                          Create your first purchase order\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  filteredOrders.map(po => (\n                    <TableRow key={po.id} data-testid={`row-po-${po.id}`}>\n                      <TableCell className=\"font-medium\">{po.poNumber}</TableCell>\n                      <TableCell>{po.supplier?.name || \"-\"}</TableCell>\n                      <TableCell>{getStatusBadge(po.status)}</TableCell>\n                      <TableCell>{formatDate(po.orderDate)}</TableCell>\n                      <TableCell>{po.items.length}</TableCell>\n                      <TableCell className=\"text-right font-medium\">\n                        {formatCurrency(po.grandTotal)}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => {\n                              setSelectedPO(po);\n                              setShowDetailsDialog(true);\n                            }}\n                            data-testid={`button-view-po-${po.id}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          {(po.status === \"ordered\" || po.status === \"partially_received\") && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => {\n                                setSelectedPO(po);\n                                setReceiveQuantities({});\n                                setShowReceiveDialog(true);\n                              }}\n                              data-testid={`button-receive-po-${po.id}`}\n                            >\n                              <PackageCheck className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                          {(po.status === \"draft\" || po.status === \"cancelled\") && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => {\n                                setSelectedPO(po);\n                                setShowDeleteDialog(true);\n                              }}\n                              data-testid={`button-delete-po-${po.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Create Supplier Dialog */}\n      <Dialog open={showSupplierDialog} onOpenChange={setShowSupplierDialog}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Add Supplier</DialogTitle>\n            <DialogDescription>\n              Add a new supplier to your list\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"supplier-name\">Supplier Name *</Label>\n              <Input\n                id=\"supplier-name\"\n                value={newSupplierName}\n                onChange={(e) => setNewSupplierName(e.target.value)}\n                placeholder=\"Enter supplier name\"\n                data-testid=\"input-supplier-name\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"supplier-contact\">Contact Person</Label>\n              <Input\n                id=\"supplier-contact\"\n                value={newSupplierContact}\n                onChange={(e) => setNewSupplierContact(e.target.value)}\n                placeholder=\"Contact name\"\n                data-testid=\"input-supplier-contact\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"supplier-email\">Email</Label>\n              <Input\n                id=\"supplier-email\"\n                type=\"email\"\n                value={newSupplierEmail}\n                onChange={(e) => setNewSupplierEmail(e.target.value)}\n                placeholder=\"email@example.com\"\n                data-testid=\"input-supplier-email\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"supplier-phone\">Phone</Label>\n              <Input\n                id=\"supplier-phone\"\n                value={newSupplierPhone}\n                onChange={(e) => setNewSupplierPhone(e.target.value)}\n                placeholder=\"+353 1 234 5678\"\n                data-testid=\"input-supplier-phone\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"supplier-address\">Address</Label>\n              <Textarea\n                id=\"supplier-address\"\n                value={newSupplierAddress}\n                onChange={(e) => setNewSupplierAddress(e.target.value)}\n                placeholder=\"Full address\"\n                data-testid=\"input-supplier-address\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowSupplierDialog(false)}>\n              Cancel\n            </Button>\n            <Button\n              onClick={() => createSupplierMutation.mutate({\n                name: newSupplierName,\n                contactName: newSupplierContact || null,\n                email: newSupplierEmail || null,\n                phone: newSupplierPhone || null,\n                address: newSupplierAddress || null,\n              })}\n              disabled={!newSupplierName || createSupplierMutation.isPending}\n              data-testid=\"button-save-supplier\"\n            >\n              {createSupplierMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Save Supplier\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Create Purchase Order Dialog */}\n      <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Create Purchase Order</DialogTitle>\n            <DialogDescription>\n              {nextPONumber ? `PO Number: ${nextPONumber.poNumber}` : \"Create a new purchase order for stock replenishment\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-6 py-4\">\n            {/* Supplier and Dates */}\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"grid gap-2\">\n                <Label>Supplier *</Label>\n                <Select value={formSupplierId} onValueChange={setFormSupplierId}>\n                  <SelectTrigger data-testid=\"select-po-supplier\">\n                    <SelectValue placeholder=\"Select supplier\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {suppliers?.map(supplier => (\n                      <SelectItem key={supplier.id} value={supplier.id.toString()}>\n                        {supplier.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Order Date</Label>\n                <Input\n                  type=\"date\"\n                  value={formOrderDate}\n                  onChange={(e) => setFormOrderDate(e.target.value)}\n                  data-testid=\"input-po-order-date\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label>Expected Delivery</Label>\n                <Input\n                  type=\"date\"\n                  value={formExpectedDate}\n                  onChange={(e) => setFormExpectedDate(e.target.value)}\n                  data-testid=\"input-po-expected-date\"\n                />\n              </div>\n            </div>\n\n            <Separator />\n\n            {/* Add Items Section */}\n            <div className=\"space-y-4\">\n              <h4 className=\"font-medium\">Add Items</h4>\n              <div className=\"grid grid-cols-1 md:grid-cols-6 gap-3 items-end\">\n                <div className=\"md:col-span-2\">\n                  <Label className=\"text-xs\">Material</Label>\n                  <Select value={selectedMaterialId} onValueChange={(val) => {\n                    setSelectedMaterialId(val);\n                    setSelectedVariationId(\"\");\n                  }}>\n                    <SelectTrigger data-testid=\"select-item-material\">\n                      <SelectValue placeholder=\"Select material\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {rawMaterials?.map(material => (\n                        <SelectItem key={material.id} value={material.id.toString()}>\n                          {material.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                {materialVariations && materialVariations.length > 0 && (\n                  <div>\n                    <Label className=\"text-xs\">Variation</Label>\n                    <Select value={selectedVariationId} onValueChange={setSelectedVariationId}>\n                      <SelectTrigger data-testid=\"select-item-variation\">\n                        <SelectValue placeholder=\"Select\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {materialVariations.map(variation => (\n                          <SelectItem key={variation.id} value={variation.id.toString()}>\n                            {variation.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                )}\n                <div>\n                  <Label className=\"text-xs\">Qty</Label>\n                  <Input\n                    type=\"number\"\n                    min=\"1\"\n                    value={itemQuantity}\n                    onChange={(e) => setItemQuantity(parseInt(e.target.value) || 1)}\n                    data-testid=\"input-item-qty\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-xs\">Unit Price</Label>\n                  <Input\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0\"\n                    value={itemUnitPrice}\n                    onChange={(e) => setItemUnitPrice(e.target.value)}\n                    data-testid=\"input-item-price\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-xs\">VAT %</Label>\n                  <Input\n                    type=\"number\"\n                    step=\"0.1\"\n                    min=\"0\"\n                    value={itemVatRate}\n                    onChange={(e) => setItemVatRate(e.target.value)}\n                    data-testid=\"input-item-vat\"\n                  />\n                </div>\n                <Button \n                  onClick={addItemToForm}\n                  disabled={!selectedMaterialId}\n                  size=\"sm\"\n                  data-testid=\"button-add-item\"\n                >\n                  <Plus className=\"h-4 w-4\" />\n                </Button>\n              </div>\n\n              {/* Items List */}\n              {formItems.length > 0 && (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Material</TableHead>\n                      <TableHead className=\"text-right\">Qty</TableHead>\n                      <TableHead className=\"text-right\">Unit Price</TableHead>\n                      <TableHead className=\"text-right\">VAT %</TableHead>\n                      <TableHead className=\"text-right\">Line Total</TableHead>\n                      <TableHead className=\"w-10\"></TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {formItems.map((item, index) => {\n                      const lineSubtotal = item.quantityOrdered * parseFloat(item.unitPrice);\n                      const lineVat = lineSubtotal * (parseFloat(item.vatRate) / 100);\n                      const lineTotal = lineSubtotal + lineVat;\n                      return (\n                        <TableRow key={index}>\n                          <TableCell>{item.materialName}</TableCell>\n                          <TableCell className=\"text-right\">{item.quantityOrdered}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(item.unitPrice)}</TableCell>\n                          <TableCell className=\"text-right\">{item.vatRate}%</TableCell>\n                          <TableCell className=\"text-right font-medium\">{formatCurrency(lineTotal)}</TableCell>\n                          <TableCell>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6\"\n                              onClick={() => removeItemFromForm(index)}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              )}\n            </div>\n\n            <Separator />\n\n            {/* Shipping and Totals */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"grid gap-2\">\n                    <Label>Shipping Cost</Label>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={formShippingCost}\n                      onChange={(e) => setFormShippingCost(e.target.value)}\n                      data-testid=\"input-po-shipping\"\n                    />\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label>Shipping VAT %</Label>\n                    <Select value={formShippingVatRate} onValueChange={setFormShippingVatRate}>\n                      <SelectTrigger data-testid=\"select-shipping-vat\">\n                        <SelectValue placeholder=\"VAT %\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"0\">0% (No VAT)</SelectItem>\n                        <SelectItem value=\"13.5\">13.5%</SelectItem>\n                        <SelectItem value=\"23\">23%</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>Notes</Label>\n                  <Textarea\n                    value={formNotes}\n                    onChange={(e) => setFormNotes(e.target.value)}\n                    placeholder=\"Optional notes...\"\n                    data-testid=\"input-po-notes\"\n                  />\n                </div>\n              </div>\n              <div className=\"space-y-2 text-right\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Subtotal:</span>\n                  <span>{formatCurrency(formTotals.subtotal)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Items VAT:</span>\n                  <span>{formatCurrency(formTotals.itemsVat)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">Shipping:</span>\n                  <span>{formatCurrency(formTotals.shipping)}</span>\n                </div>\n                {formTotals.shippingVat > 0 && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Shipping VAT:</span>\n                    <span>{formatCurrency(formTotals.shippingVat)}</span>\n                  </div>\n                )}\n                <Separator />\n                <div className=\"flex justify-between text-lg font-bold\">\n                  <span>Grand Total:</span>\n                  <span>{formatCurrency(formTotals.grandTotal)}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => {\n              setShowCreateDialog(false);\n              resetPOForm();\n            }}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleCreatePO}\n              disabled={!formSupplierId || formItems.length === 0 || createPOMutation.isPending}\n              data-testid=\"button-submit-po\"\n            >\n              {createPOMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Create Purchase Order\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* View Details Dialog */}\n      <Dialog open={showDetailsDialog} onOpenChange={setShowDetailsDialog}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-3\">\n              <span>{selectedPO?.poNumber}</span>\n              {selectedPO && getStatusBadge(selectedPO.status)}\n            </DialogTitle>\n            <DialogDescription>\n              {selectedPO?.supplier?.name || \"Unknown supplier\"}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedPO && (\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                <div>\n                  <span className=\"text-muted-foreground\">Order Date</span>\n                  <p className=\"font-medium\">{formatDate(selectedPO.orderDate)}</p>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Expected Delivery</span>\n                  <p className=\"font-medium\">{formatDate(selectedPO.expectedDeliveryDate)}</p>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Received Date</span>\n                  <p className=\"font-medium\">{formatDate(selectedPO.receivedDate)}</p>\n                </div>\n                <div>\n                  <span className=\"text-muted-foreground\">Created</span>\n                  <p className=\"font-medium\">{formatDate(selectedPO.createdAt)}</p>\n                </div>\n              </div>\n\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Material</TableHead>\n                    <TableHead className=\"text-right\">Ordered</TableHead>\n                    <TableHead className=\"text-right\">Received</TableHead>\n                    <TableHead className=\"text-right\">Unit Price</TableHead>\n                    <TableHead className=\"text-right\">Line Total</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {selectedPO.items.map(item => (\n                    <TableRow key={item.id}>\n                      <TableCell>{item.materialName}</TableCell>\n                      <TableCell className=\"text-right\">{item.quantityOrdered}</TableCell>\n                      <TableCell className=\"text-right\">\n                        {item.quantityReceived >= item.quantityOrdered ? (\n                          <span className=\"text-green-600\">{item.quantityReceived}</span>\n                        ) : item.quantityReceived > 0 ? (\n                          <span className=\"text-amber-600\">{item.quantityReceived}</span>\n                        ) : (\n                          item.quantityReceived\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-right\">{formatCurrency(item.unitPrice)}</TableCell>\n                      <TableCell className=\"text-right font-medium\">{formatCurrency(item.lineTotal)}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n\n              <div className=\"flex justify-end\">\n                <div className=\"space-y-1 text-right w-56\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Subtotal:</span>\n                    <span>{formatCurrency(selectedPO.subtotal)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Items VAT:</span>\n                    <span>{formatCurrency(parseFloat(selectedPO.vatTotal) - parseFloat(selectedPO.shippingVat || \"0\"))}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Shipping:</span>\n                    <span>{formatCurrency(selectedPO.shippingCost)}</span>\n                  </div>\n                  {parseFloat(selectedPO.shippingVat || \"0\") > 0 && (\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Shipping VAT ({selectedPO.shippingVatRate}%):</span>\n                      <span>{formatCurrency(selectedPO.shippingVat)}</span>\n                    </div>\n                  )}\n                  <Separator />\n                  <div className=\"flex justify-between font-bold\">\n                    <span>Total:</span>\n                    <span>{formatCurrency(selectedPO.grandTotal)}</span>\n                  </div>\n                </div>\n              </div>\n\n              {selectedPO.notes && (\n                <div className=\"rounded-lg bg-muted p-3\">\n                  <p className=\"text-sm text-muted-foreground\">Notes</p>\n                  <p className=\"text-sm\">{selectedPO.notes}</p>\n                </div>\n              )}\n\n              {/* Actions */}\n              <div className=\"flex gap-2 justify-between\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => handleDownloadPDF(selectedPO.id, selectedPO.poNumber)}\n                  data-testid=\"button-download-pdf\"\n                >\n                  <FileDown className=\"mr-2 h-4 w-4\" />\n                  Download PDF\n                </Button>\n                <div className=\"flex gap-2\">\n                  {selectedPO.status === \"draft\" && (\n                    <>\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => {\n                          setShowDetailsDialog(false);\n                          setShowEditDialog(true);\n                        }}\n                        data-testid=\"button-edit-po\"\n                      >\n                        <Edit className=\"mr-2 h-4 w-4\" />\n                        Edit Items\n                      </Button>\n                      <Button\n                        onClick={() => {\n                          updateStatusMutation.mutate({ id: selectedPO.id, status: \"ordered\" });\n                          setShowDetailsDialog(false);\n                        }}\n                        data-testid=\"button-mark-ordered\"\n                      >\n                        Mark as Ordered\n                      </Button>\n                    </>\n                  )}\n                  {(selectedPO.status === \"ordered\" || selectedPO.status === \"partially_received\") && (\n                    <Button\n                      onClick={() => {\n                        setShowDetailsDialog(false);\n                        setCheckedItems(new Set());\n                        setShowReceiveDialog(true);\n                      }}\n                      data-testid=\"button-receive-items\"\n                    >\n                      <PackageCheck className=\"mr-2 h-4 w-4\" />\n                      Receive Items\n                    </Button>\n                  )}\n                  {(selectedPO.status === \"draft\" || selectedPO.status === \"ordered\" || selectedPO.status === \"partially_received\") && (\n                    <Button\n                      variant=\"destructive\"\n                      onClick={() => {\n                        updateStatusMutation.mutate({ id: selectedPO.id, status: \"cancelled\" });\n                        setShowDetailsDialog(false);\n                      }}\n                      data-testid=\"button-cancel-po\"\n                    >\n                      Cancel Order\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Receive Items Dialog */}\n      <Dialog open={showReceiveDialog} onOpenChange={(open) => {\n        setShowReceiveDialog(open);\n        if (!open) {\n          setCheckedItems(new Set());\n        }\n      }}>\n        <DialogContent className=\"max-w-xl\">\n          <DialogHeader>\n            <DialogTitle>Receive Items - {selectedPO?.poNumber}</DialogTitle>\n            <DialogDescription>\n              Tick the items that have arrived in this delivery\n            </DialogDescription>\n          </DialogHeader>\n          {selectedPO && (\n            <div className=\"space-y-4\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-12\"></TableHead>\n                    <TableHead>Material</TableHead>\n                    <TableHead className=\"text-right\">Ordered</TableHead>\n                    <TableHead className=\"text-right\">Remaining</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {selectedPO.items.map(item => {\n                    const remaining = item.quantityOrdered - item.quantityReceived;\n                    const isComplete = remaining === 0;\n                    return (\n                      <TableRow key={item.id} className={isComplete ? \"opacity-50\" : \"\"}>\n                        <TableCell>\n                          <Checkbox\n                            checked={isComplete || checkedItems.has(item.id)}\n                            disabled={isComplete}\n                            onCheckedChange={(checked) => {\n                              const newSet = new Set(checkedItems);\n                              if (checked) {\n                                newSet.add(item.id);\n                              } else {\n                                newSet.delete(item.id);\n                              }\n                              setCheckedItems(newSet);\n                            }}\n                            data-testid={`checkbox-receive-${item.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          {item.materialName}\n                          {isComplete && <Badge variant=\"outline\" className=\"ml-2 text-xs\">Complete</Badge>}\n                        </TableCell>\n                        <TableCell className=\"text-right\">{item.quantityOrdered}</TableCell>\n                        <TableCell className=\"text-right\">\n                          {isComplete ? (\n                            <Check className=\"h-4 w-4 text-green-600 ml-auto\" />\n                          ) : (\n                            <span className=\"text-amber-600 font-medium\">{remaining}</span>\n                          )}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n              {checkedItems.size > 0 && (\n                <p className=\"text-sm text-muted-foreground\">\n                  {checkedItems.size} item{checkedItems.size > 1 ? \"s\" : \"\"} selected for receiving\n                </p>\n              )}\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => {\n              setShowReceiveDialog(false);\n              setCheckedItems(new Set());\n            }}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleReceiveItems}\n              disabled={receiveItemsMutation.isPending || checkedItems.size === 0}\n              data-testid=\"button-confirm-receive\"\n            >\n              {receiveItemsMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Receive Selected Items\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Purchase Order</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete {selectedPO?.poNumber}? This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => selectedPO && deletePOMutation.mutate(selectedPO.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {deletePOMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Edit Draft PO Dialog */}\n      <Dialog open={showEditDialog} onOpenChange={(open) => {\n        setShowEditDialog(open);\n        if (!open) {\n          setSelectedMaterialId(\"\");\n          setSelectedVariationId(\"\");\n          setItemQuantity(1);\n          setItemUnitPrice(\"0.00\");\n          setItemVatRate(\"23\");\n        }\n      }}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Purchase Order - {selectedPO?.poNumber}</DialogTitle>\n            <DialogDescription>\n              Add or remove items and update shipping details\n            </DialogDescription>\n          </DialogHeader>\n          {selectedPO && selectedPO.status === \"draft\" && (\n            <div className=\"space-y-6\">\n              {/* Current Items */}\n              <div className=\"space-y-2\">\n                <Label className=\"text-base font-semibold\">Current Items</Label>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Material</TableHead>\n                      <TableHead className=\"text-right\">Qty</TableHead>\n                      <TableHead className=\"text-right\">Unit Price</TableHead>\n                      <TableHead className=\"text-right\">Total</TableHead>\n                      <TableHead className=\"w-12\"></TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {selectedPO.items.length === 0 ? (\n                      <TableRow>\n                        <TableCell colSpan={5} className=\"text-center text-muted-foreground py-4\">\n                          No items yet. Add items below.\n                        </TableCell>\n                      </TableRow>\n                    ) : (\n                      selectedPO.items.map(item => (\n                        <TableRow key={item.id}>\n                          <TableCell>{item.materialName}</TableCell>\n                          <TableCell className=\"text-right\">{item.quantityOrdered}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(item.unitPrice)}</TableCell>\n                          <TableCell className=\"text-right\">{formatCurrency(item.lineTotal)}</TableCell>\n                          <TableCell>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => removeItemMutation.mutate({ poId: selectedPO.id, itemId: item.id })}\n                              disabled={removeItemMutation.isPending}\n                              data-testid={`button-remove-item-${item.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n\n              <Separator />\n\n              {/* Add New Item */}\n              <div className=\"space-y-4\">\n                <Label className=\"text-base font-semibold\">Add New Item</Label>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div className=\"col-span-2\">\n                    <Label>Material</Label>\n                    <Select value={selectedMaterialId} onValueChange={(value) => {\n                      setSelectedMaterialId(value);\n                      setSelectedVariationId(\"\");\n                    }}>\n                      <SelectTrigger data-testid=\"select-edit-material\">\n                        <SelectValue placeholder=\"Select material...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {rawMaterials?.map(material => (\n                          <SelectItem key={material.id} value={material.id.toString()}>\n                            {material.name} ({material.type})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  {selectedMaterial?.type === \"variable\" && (materialVariations?.length || 0) > 0 && (\n                    <div className=\"col-span-2\">\n                      <Label>Variation</Label>\n                      <Select value={selectedVariationId} onValueChange={setSelectedVariationId}>\n                        <SelectTrigger data-testid=\"select-edit-variation\">\n                          <SelectValue placeholder=\"Select variation...\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {materialVariations?.map(variation => (\n                            <SelectItem key={variation.id} value={variation.id.toString()}>\n                              {variation.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n                  <div>\n                    <Label>Quantity</Label>\n                    <Input\n                      type=\"number\"\n                      min=\"1\"\n                      value={itemQuantity}\n                      onChange={(e) => setItemQuantity(parseInt(e.target.value) || 1)}\n                      data-testid=\"input-edit-quantity\"\n                    />\n                  </div>\n                  <div>\n                    <Label>Unit Price</Label>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={itemUnitPrice}\n                      onChange={(e) => setItemUnitPrice(e.target.value)}\n                      data-testid=\"input-edit-price\"\n                    />\n                  </div>\n                  <div>\n                    <Label>VAT %</Label>\n                    <Select value={itemVatRate} onValueChange={setItemVatRate}>\n                      <SelectTrigger data-testid=\"select-edit-item-vat\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"0\">0%</SelectItem>\n                        <SelectItem value=\"13.5\">13.5%</SelectItem>\n                        <SelectItem value=\"23\">23%</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"flex items-end\">\n                    <Button\n                      onClick={handleAddItemToDraftPO}\n                      disabled={!selectedMaterialId || addItemMutation.isPending}\n                      data-testid=\"button-add-edit-item\"\n                    >\n                      {addItemMutation.isPending ? (\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                      )}\n                      Add\n                    </Button>\n                  </div>\n                </div>\n              </div>\n\n              <Separator />\n\n              {/* Shipping Details */}\n              <div className=\"space-y-4\">\n                <Label className=\"text-base font-semibold\">Shipping</Label>\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <div>\n                    <Label>Shipping Cost</Label>\n                    <Input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      defaultValue={selectedPO.shippingCost}\n                      onBlur={(e) => {\n                        const newCost = e.target.value;\n                        if (newCost !== selectedPO.shippingCost) {\n                          updateShippingMutation.mutate({\n                            poId: selectedPO.id,\n                            shippingCost: newCost,\n                            shippingVatRate: selectedPO.shippingVatRate,\n                          });\n                        }\n                      }}\n                      data-testid=\"input-edit-shipping\"\n                    />\n                  </div>\n                  <div>\n                    <Label>Shipping VAT %</Label>\n                    <Select \n                      defaultValue={selectedPO.shippingVatRate}\n                      onValueChange={(value) => {\n                        updateShippingMutation.mutate({\n                          poId: selectedPO.id,\n                          shippingCost: selectedPO.shippingCost,\n                          shippingVatRate: value,\n                        });\n                      }}\n                    >\n                      <SelectTrigger data-testid=\"select-edit-shipping-vat\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"0\">0% (No VAT)</SelectItem>\n                        <SelectItem value=\"13.5\">13.5%</SelectItem>\n                        <SelectItem value=\"23\">23%</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n\n              {/* Totals */}\n              <div className=\"flex justify-end\">\n                <div className=\"space-y-1 text-right w-56 bg-muted p-4 rounded-lg\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Subtotal:</span>\n                    <span>{formatCurrency(selectedPO.subtotal)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Items VAT:</span>\n                    <span>{formatCurrency(parseFloat(selectedPO.vatTotal) - parseFloat(selectedPO.shippingVat || \"0\"))}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Shipping:</span>\n                    <span>{formatCurrency(selectedPO.shippingCost)}</span>\n                  </div>\n                  {parseFloat(selectedPO.shippingVat || \"0\") > 0 && (\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Shipping VAT:</span>\n                      <span>{formatCurrency(selectedPO.shippingVat)}</span>\n                    </div>\n                  )}\n                  <Separator className=\"my-2\" />\n                  <div className=\"flex justify-between font-bold\">\n                    <span>Total:</span>\n                    <span>{formatCurrency(selectedPO.grandTotal)}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button onClick={() => setShowEditDialog(false)} data-testid=\"button-close-edit\">\n              Done\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </main>\n  );\n}\n","path":null,"size_bytes":65081,"size_tokens":null},"server/cache.ts":{"content":"/**\n * Simple in-memory cache with TTL (time-to-live) support\n * Used to cache WooCommerce API responses to reduce external API calls\n */\n\ninterface CacheEntry<T> {\n  data: T;\n  expiresAt: number;\n}\n\nclass MemoryCache {\n  private cache = new Map<string, CacheEntry<any>>();\n  \n  /**\n   * Get a value from cache\n   * Returns undefined if not found or expired\n   */\n  get<T>(key: string): T | undefined {\n    const entry = this.cache.get(key);\n    \n    if (!entry) {\n      return undefined;\n    }\n    \n    // Check if expired\n    if (Date.now() > entry.expiresAt) {\n      this.cache.delete(key);\n      return undefined;\n    }\n    \n    return entry.data as T;\n  }\n  \n  /**\n   * Set a value in cache with TTL in seconds\n   */\n  set<T>(key: string, data: T, ttlSeconds: number): void {\n    this.cache.set(key, {\n      data,\n      expiresAt: Date.now() + (ttlSeconds * 1000),\n    });\n  }\n  \n  /**\n   * Delete a specific cache entry\n   */\n  delete(key: string): boolean {\n    return this.cache.delete(key);\n  }\n  \n  /**\n   * Clear all entries matching a prefix\n   */\n  clearByPrefix(prefix: string): void {\n    for (const key of this.cache.keys()) {\n      if (key.startsWith(prefix)) {\n        this.cache.delete(key);\n      }\n    }\n  }\n  \n  /**\n   * Clear all cache entries\n   */\n  clear(): void {\n    this.cache.clear();\n  }\n  \n  /**\n   * Get cache stats for debugging\n   */\n  getStats(): { size: number; keys: string[] } {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys()),\n    };\n  }\n}\n\n// Cache TTL constants (in seconds)\nexport const CACHE_TTL = {\n  ORDERS: 60,           // 1 minute - orders change frequently\n  RAW_MATERIALS: 120,   // 2 minutes - stock levels change occasionally\n  CATEGORIES: 300,      // 5 minutes - categories rarely change\n  ORDER_STATUSES: 300,  // 5 minutes - statuses rarely change\n  PRODUCTS: 120,        // 2 minutes - product data changes occasionally\n  CUSTOMERS: 120,       // 2 minutes - customer data changes occasionally\n};\n\n// Single cache instance\nexport const apiCache = new MemoryCache();\n\n// Cache key generators\nexport const cacheKeys = {\n  orders: (dateRange: string, status?: string) => \n    `orders:${dateRange}:${status || 'any'}`,\n  rawMaterials: () => 'raw-materials',\n  categories: () => 'categories',\n  orderStatuses: () => 'order-statuses',\n  productVariations: (productId: number) => `product-variations:${productId}`,\n  fulfillmentStatus: (dateRange: string) => `fulfillment-status:${dateRange}`,\n  customers: () => 'customers',\n};\n\n/**\n * Invalidate cache entries related to inventory/stock changes\n * Call this after stock updates, order processing, etc.\n */\nexport function invalidateStockCache(): void {\n  console.log('[Cache] Invalidating stock-related cache entries...');\n  apiCache.delete(cacheKeys.rawMaterials());\n  apiCache.clearByPrefix('fulfillment-status:');\n  console.log('[Cache] Stock cache invalidated');\n}\n\n/**\n * Invalidate all order-related cache entries\n * Call this after order status changes, new orders, etc.\n */\nexport function invalidateOrdersCache(): void {\n  console.log('[Cache] Invalidating order-related cache entries...');\n  apiCache.clearByPrefix('orders:');\n  apiCache.clearByPrefix('fulfillment-status:');\n  console.log('[Cache] Orders cache invalidated');\n}\n\n/**\n * Invalidate all WooCommerce cache entries\n * Use for full refresh\n */\nexport function invalidateAllCache(): void {\n  console.log('[Cache] Clearing all cache entries...');\n  apiCache.clear();\n  console.log('[Cache] All cache cleared');\n}\n","path":null,"size_bytes":3522,"size_tokens":null},"client/src/hooks/use-auth.tsx":{"content":"import { createContext, ReactNode, useContext } from \"react\";\nimport {\n  useQuery,\n  useMutation,\n  UseMutationResult,\n} from \"@tanstack/react-query\";\nimport { insertUserSchema, User as SelectUser, InsertUser } from \"@shared/schema\";\nimport { getQueryFn, apiRequest, queryClient } from \"../lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype AuthContextType = {\n  user: SelectUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  loginMutation: UseMutationResult<SelectUser, Error, LoginData>;\n  logoutMutation: UseMutationResult<void, Error, void>;\n  registerMutation: UseMutationResult<SelectUser, Error, InsertUser>;\n};\n\ntype LoginData = Pick<InsertUser, \"username\" | \"password\">;\n\nexport const AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const { toast } = useToast();\n  const {\n    data: user,\n    error,\n    isLoading,\n  } = useQuery<SelectUser | undefined, Error>({\n    queryKey: [\"/api/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginData) => {\n      const res = await apiRequest(\"POST\", \"/api/login\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (credentials: InsertUser) => {\n      const res = await apiRequest(\"POST\", \"/api/register\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/logout\");\n    },\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/user\"], null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Logout failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user: user ?? null,\n        isLoading,\n        error,\n        loginMutation,\n        logoutMutation,\n        registerMutation,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":2833,"size_tokens":null},"server/auth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport { Express, Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport { scrypt, randomBytes, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\nimport { storage } from \"./storage\";\nimport { User as SelectUser } from \"@shared/schema\";\n\ndeclare global {\n  namespace Express {\n    interface User extends SelectUser {}\n  }\n}\n\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password: string) {\n  const salt = randomBytes(16).toString(\"hex\");\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString(\"hex\")}.${salt}`;\n}\n\nasync function comparePasswords(supplied: string, stored: string) {\n  const [hashed, salt] = stored.split(\".\");\n  const hashedBuf = Buffer.from(hashed, \"hex\");\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}\n\n// In development mode, bypass auth because Replit preview iframe blocks session cookies\nconst isDevelopment = process.env.NODE_ENV === \"development\";\n\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  // Bypass auth in development mode (Replit preview blocks cookies)\n  if (isDevelopment) {\n    return next();\n  }\n  \n  if (req.isAuthenticated()) {\n    return next();\n  }\n  res.status(401).json({ message: \"Authentication required\" });\n}\n\nexport function setupAuth(app: Express) {\n  if (!process.env.SESSION_SECRET) {\n    throw new Error(\"SESSION_SECRET environment variable is required for secure session management\");\n  }\n\n  // In Replit, both development and production are served over HTTPS\n  // Use sameSite: \"none\" for cross-origin cookie support in Replit preview\n  const sessionSettings: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET,\n    resave: false,\n    saveUninitialized: false,\n    store: storage.sessionStore,\n    cookie: {\n      secure: true, // Required for sameSite: \"none\"\n      httpOnly: true,\n      maxAge: 1000 * 60 * 60 * 24 * 7, // 1 week\n      sameSite: \"none\", // Allows cookies in cross-origin contexts (Replit preview)\n    },\n  };\n\n  app.set(\"trust proxy\", 1);\n  app.use(session(sessionSettings));\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(\n    new LocalStrategy(async (username, password, done) => {\n      try {\n        const user = await storage.getUserByUsername(username);\n        if (!user || !(await comparePasswords(password, user.password))) {\n          return done(null, false, { message: \"Invalid username or password\" });\n        }\n        return done(null, user);\n      } catch (error) {\n        return done(error);\n      }\n    }),\n  );\n\n  passport.serializeUser((user, done) => done(null, user.id));\n  passport.deserializeUser(async (id: number, done) => {\n    try {\n      const user = await storage.getUser(id);\n      done(null, user);\n    } catch (error) {\n      done(error);\n    }\n  });\n\n  app.post(\"/api/register\", async (req, res, next) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username and password are required\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ message: \"Password must be at least 6 characters\" });\n      }\n\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n\n      const user = await storage.createUser({\n        username,\n        password: await hashPassword(password),\n      });\n\n      req.login(user, (err) => {\n        if (err) return next(err);\n        res.status(201).json({ id: user.id, username: user.username });\n      });\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      res.status(500).json({ message: error.message || \"Registration failed\" });\n    }\n  });\n\n  app.post(\"/api/login\", (req, res, next) => {\n    passport.authenticate(\"local\", (err: any, user: SelectUser | false, info: { message: string }) => {\n      if (err) return next(err);\n      if (!user) {\n        return res.status(401).json({ message: info?.message || \"Invalid credentials\" });\n      }\n      req.login(user, (err) => {\n        if (err) return next(err);\n        console.log(\"[Login Debug] Session ID after login:\", req.sessionID);\n        console.log(\"[Login Debug] Session after login:\", req.session);\n        console.log(\"[Login Debug] Cookie settings:\", sessionSettings.cookie);\n        res.status(200).json({ id: user.id, username: user.username });\n      });\n    })(req, res, next);\n  });\n\n  app.post(\"/api/logout\", (req, res, next) => {\n    req.logout((err) => {\n      if (err) return next(err);\n      req.session.destroy((err) => {\n        if (err) return next(err);\n        res.clearCookie(\"connect.sid\");\n        res.sendStatus(200);\n      });\n    });\n  });\n\n  app.get(\"/api/user\", (req, res) => {\n    // In development mode, return a mock user (Replit preview blocks cookies)\n    if (isDevelopment) {\n      return res.json({ id: 1, username: \"dev-user\" });\n    }\n    \n    if (!req.isAuthenticated()) return res.sendStatus(401);\n    const user = req.user as SelectUser;\n    res.json({ id: user.id, username: user.username });\n  });\n}\n","path":null,"size_bytes":5402,"size_tokens":null},"client/src/lib/protected-route.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { Loader2 } from \"lucide-react\";\nimport { Redirect, Route } from \"wouter\";\n\nexport function ProtectedRoute({\n  path,\n  component: Component,\n}: {\n  path: string;\n  component: () => React.JSX.Element;\n}) {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <Route path={path}>\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-border\" />\n        </div>\n      </Route>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Route path={path}>\n        <Redirect to=\"/auth\" />\n      </Route>\n    );\n  }\n\n  return <Route path={path} component={Component} />;\n}\n","path":null,"size_bytes":706,"size_tokens":null},"client/src/pages/suppliers.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Plus,\n  Search,\n  Loader2,\n  Building2,\n  Edit,\n  Trash2,\n  Eye,\n  Mail,\n  Phone,\n  MapPin,\n  User,\n  FileText,\n  ShoppingCart,\n  Euro,\n  ArrowUpDown\n} from \"lucide-react\";\nimport { useState, useMemo, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport type { Supplier } from \"@shared/schema\";\n\ninterface SupplierStatistics {\n  supplierId: number;\n  poCount: number;\n  totalSpent: string;\n}\n\ninterface PurchaseOrderItem {\n  id: number;\n  purchaseOrderId: number;\n  materialProductId: number;\n  materialVariationId: number | null;\n  materialName: string;\n  quantityOrdered: number;\n  quantityReceived: number;\n  unitPrice: string;\n  vatRate: string;\n  lineSubtotal: string;\n  lineVat: string;\n  lineTotal: string;\n}\n\ninterface PurchaseOrderWithDetails {\n  id: number;\n  poNumber: string;\n  supplierId: number;\n  supplier?: Supplier;\n  status: \"draft\" | \"ordered\" | \"partially_received\" | \"received\" | \"cancelled\";\n  orderDate: string | null;\n  expectedDeliveryDate: string | null;\n  receivedDate: string | null;\n  subtotal: string;\n  shippingCost: string;\n  shippingVatRate: string;\n  shippingVat: string;\n  vatTotal: string;\n  grandTotal: string;\n  notes: string | null;\n  createdAt: string;\n  updatedAt: string;\n  items: PurchaseOrderItem[];\n}\n\ninterface SupplierWithStats extends Supplier {\n  poCount: number;\n  totalSpent: string;\n}\n\ntype SortField = \"name\" | \"poCount\" | \"totalSpent\";\ntype SortDirection = \"asc\" | \"desc\";\n\nexport default function Suppliers() {\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [showDetailsDialog, setShowDetailsDialog] = useState(false);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [selectedSupplier, setSelectedSupplier] = useState<SupplierWithStats | null>(null);\n  const [sortField, setSortField] = useState<SortField>(\"name\");\n  const [sortDirection, setSortDirection] = useState<SortDirection>(\"asc\");\n\n  const [formName, setFormName] = useState(\"\");\n  const [formContactName, setFormContactName] = useState(\"\");\n  const [formEmail, setFormEmail] = useState(\"\");\n  const [formPhone, setFormPhone] = useState(\"\");\n  const [formAddress, setFormAddress] = useState(\"\");\n  const [formNotes, setFormNotes] = useState(\"\");\n\n  const { data: suppliers, isLoading: suppliersLoading } = useQuery<Supplier[]>({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const { data: statistics, isLoading: statsLoading } = useQuery<SupplierStatistics[]>({\n    queryKey: [\"/api/suppliers/statistics\"],\n  });\n\n  const { data: supplierPOs, isLoading: posLoading } = useQuery<PurchaseOrderWithDetails[]>({\n    queryKey: [\"/api/suppliers\", selectedSupplier?.id, \"purchase-orders\"],\n    queryFn: async () => {\n      if (!selectedSupplier?.id) return [];\n      const response = await fetch(`/api/suppliers/${selectedSupplier.id}/purchase-orders`);\n      if (!response.ok) throw new Error(\"Failed to fetch supplier purchase orders\");\n      return response.json();\n    },\n    enabled: !!selectedSupplier?.id && showDetailsDialog,\n  });\n\n  const suppliersWithStats = useMemo(() => {\n    if (!suppliers) return [];\n    \n    return suppliers.map(supplier => {\n      const stats = statistics?.find(s => s.supplierId === supplier.id);\n      return {\n        ...supplier,\n        poCount: stats?.poCount || 0,\n        totalSpent: stats?.totalSpent || \"0\",\n      };\n    });\n  }, [suppliers, statistics]);\n\n  const filteredAndSortedSuppliers = useMemo(() => {\n    let result = suppliersWithStats;\n\n    if (searchTerm) {\n      const term = searchTerm.toLowerCase();\n      result = result.filter(s => \n        s.name.toLowerCase().includes(term) ||\n        s.email?.toLowerCase().includes(term) ||\n        s.contactName?.toLowerCase().includes(term)\n      );\n    }\n\n    result.sort((a, b) => {\n      let comparison = 0;\n      if (sortField === \"name\") {\n        comparison = a.name.localeCompare(b.name);\n      } else if (sortField === \"poCount\") {\n        comparison = a.poCount - b.poCount;\n      } else if (sortField === \"totalSpent\") {\n        comparison = parseFloat(a.totalSpent) - parseFloat(b.totalSpent);\n      }\n      return sortDirection === \"asc\" ? comparison : -comparison;\n    });\n\n    return result;\n  }, [suppliersWithStats, searchTerm, sortField, sortDirection]);\n\n  const createSupplierMutation = useMutation({\n    mutationFn: async (data: Partial<Supplier>) => {\n      return apiRequest(\"POST\", \"/api/suppliers\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setShowAddDialog(false);\n      resetForm();\n      toast({\n        title: \"Supplier Created\",\n        description: \"New supplier has been added successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create supplier\",\n      });\n    },\n  });\n\n  const updateSupplierMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<Supplier> }) => {\n      return apiRequest(\"PUT\", `/api/suppliers/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      setShowEditDialog(false);\n      setSelectedSupplier(null);\n      resetForm();\n      toast({\n        title: \"Supplier Updated\",\n        description: \"Supplier has been updated successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to update supplier\",\n      });\n    },\n  });\n\n  const deleteSupplierMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/suppliers/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/suppliers/statistics\"] });\n      setShowDeleteDialog(false);\n      setSelectedSupplier(null);\n      toast({\n        title: \"Supplier Deactivated\",\n        description: \"Supplier has been deactivated successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to delete supplier\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormName(\"\");\n    setFormContactName(\"\");\n    setFormEmail(\"\");\n    setFormPhone(\"\");\n    setFormAddress(\"\");\n    setFormNotes(\"\");\n  };\n\n  const populateForm = (supplier: SupplierWithStats) => {\n    setFormName(supplier.name);\n    setFormContactName(supplier.contactName || \"\");\n    setFormEmail(supplier.email || \"\");\n    setFormPhone(supplier.phone || \"\");\n    setFormAddress(supplier.address || \"\");\n    setFormNotes(supplier.notes || \"\");\n  };\n\n  const handleAddSupplier = () => {\n    if (!formName.trim()) {\n      toast({\n        variant: \"destructive\",\n        title: \"Validation Error\",\n        description: \"Supplier name is required\",\n      });\n      return;\n    }\n\n    createSupplierMutation.mutate({\n      name: formName,\n      contactName: formContactName || null,\n      email: formEmail || null,\n      phone: formPhone || null,\n      address: formAddress || null,\n      notes: formNotes || null,\n      isActive: true,\n    });\n  };\n\n  const handleUpdateSupplier = () => {\n    if (!selectedSupplier) return;\n    if (!formName.trim()) {\n      toast({\n        variant: \"destructive\",\n        title: \"Validation Error\",\n        description: \"Supplier name is required\",\n      });\n      return;\n    }\n\n    updateSupplierMutation.mutate({\n      id: selectedSupplier.id,\n      data: {\n        name: formName,\n        contactName: formContactName || null,\n        email: formEmail || null,\n        phone: formPhone || null,\n        address: formAddress || null,\n        notes: formNotes || null,\n      },\n    });\n  };\n\n  const openEditDialog = (supplier: SupplierWithStats) => {\n    setSelectedSupplier(supplier);\n    populateForm(supplier);\n    setShowEditDialog(true);\n  };\n\n  const openDetailsDialog = (supplier: SupplierWithStats) => {\n    setSelectedSupplier(supplier);\n    setShowDetailsDialog(true);\n  };\n\n  const openDeleteDialog = (supplier: SupplierWithStats) => {\n    setSelectedSupplier(supplier);\n    setShowDeleteDialog(true);\n  };\n\n  const toggleSort = (field: SortField) => {\n    if (sortField === field) {\n      setSortDirection(prev => prev === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortDirection(\"asc\");\n    }\n  };\n\n  const formatCurrency = (value: string | number) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return `${num.toFixed(2)}`;\n  };\n\n  const formatDate = (dateStr: string | null) => {\n    if (!dateStr) return \"-\";\n    return new Date(dateStr).toLocaleDateString(\"en-IE\", {\n      day: \"2-digit\",\n      month: \"short\",\n      year: \"numeric\",\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\" | \"outline\"> = {\n      draft: \"secondary\",\n      ordered: \"default\",\n      partially_received: \"outline\",\n      received: \"default\",\n      cancelled: \"destructive\",\n    };\n    const labels: Record<string, string> = {\n      draft: \"Draft\",\n      ordered: \"Ordered\",\n      partially_received: \"Partial\",\n      received: \"Received\",\n      cancelled: \"Cancelled\",\n    };\n    return (\n      <Badge variant={variants[status] || \"secondary\"}>\n        {labels[status] || status}\n      </Badge>\n    );\n  };\n\n  const totalSpentAllSuppliers = useMemo(() => {\n    return suppliersWithStats.reduce((sum, s) => sum + parseFloat(s.totalSpent), 0);\n  }, [suppliersWithStats]);\n\n  const totalPOCount = useMemo(() => {\n    return suppliersWithStats.reduce((sum, s) => sum + s.poCount, 0);\n  }, [suppliersWithStats]);\n\n  const isLoading = suppliersLoading || statsLoading;\n\n  return (\n    <main className=\"container py-6 px-6 max-w-7xl\">\n      <div className=\"flex flex-col gap-6\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\" data-testid=\"text-page-title\">Suppliers</h1>\n            <p className=\"text-muted-foreground\">Manage your suppliers and view purchase history</p>\n          </div>\n          <Button onClick={() => setShowAddDialog(true)} data-testid=\"button-add-supplier\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Supplier\n          </Button>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Suppliers</CardTitle>\n              <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-suppliers\">\n                {isLoading ? <Skeleton className=\"h-8 w-16\" /> : suppliersWithStats.length}\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Purchase Orders</CardTitle>\n              <ShoppingCart className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-pos\">\n                {isLoading ? <Skeleton className=\"h-8 w-16\" /> : totalPOCount}\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Spent</CardTitle>\n              <Euro className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-spent\">\n                {isLoading ? <Skeleton className=\"h-8 w-24\" /> : formatCurrency(totalSpentAllSuppliers)}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n              <div>\n                <CardTitle>Supplier List</CardTitle>\n                <CardDescription>View and manage all your suppliers</CardDescription>\n              </div>\n              <div className=\"relative w-full sm:w-64\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n                <Input\n                  placeholder=\"Search suppliers...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                  data-testid=\"input-search-suppliers\"\n                />\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {[1, 2, 3].map((i) => (\n                  <Skeleton key={i} className=\"h-16 w-full\" />\n                ))}\n              </div>\n            ) : filteredAndSortedSuppliers.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-semibold\">No Suppliers Found</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  {searchTerm ? \"No suppliers match your search\" : \"Get started by adding your first supplier\"}\n                </p>\n                {!searchTerm && (\n                  <Button onClick={() => setShowAddDialog(true)}>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Supplier\n                  </Button>\n                )}\n              </div>\n            ) : (\n              <div className=\"rounded-md border overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          className=\"h-8 -ml-3 font-semibold\"\n                          onClick={() => toggleSort(\"name\")}\n                          data-testid=\"button-sort-name\"\n                        >\n                          Supplier\n                          <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n                        </Button>\n                      </TableHead>\n                      <TableHead>Contact</TableHead>\n                      <TableHead>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          className=\"h-8 -ml-3 font-semibold\"\n                          onClick={() => toggleSort(\"poCount\")}\n                          data-testid=\"button-sort-po-count\"\n                        >\n                          Orders\n                          <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n                        </Button>\n                      </TableHead>\n                      <TableHead>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          className=\"h-8 -ml-3 font-semibold\"\n                          onClick={() => toggleSort(\"totalSpent\")}\n                          data-testid=\"button-sort-total-spent\"\n                        >\n                          Total Spent\n                          <ArrowUpDown className=\"ml-2 h-4 w-4\" />\n                        </Button>\n                      </TableHead>\n                      <TableHead className=\"text-right\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredAndSortedSuppliers.map((supplier) => (\n                      <TableRow key={supplier.id} data-testid={`row-supplier-${supplier.id}`}>\n                        <TableCell>\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 bg-primary/10 rounded-md\">\n                              <Building2 className=\"h-4 w-4 text-primary\" />\n                            </div>\n                            <div>\n                              <div className=\"font-medium\" data-testid={`text-supplier-name-${supplier.id}`}>\n                                {supplier.name}\n                              </div>\n                              {supplier.contactName && (\n                                <div className=\"text-sm text-muted-foreground\">\n                                  {supplier.contactName}\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex flex-col gap-1 text-sm\">\n                            {supplier.email && (\n                              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                                <Mail className=\"h-3 w-3\" />\n                                {supplier.email}\n                              </div>\n                            )}\n                            {supplier.phone && (\n                              <div className=\"flex items-center gap-2 text-muted-foreground\">\n                                <Phone className=\"h-3 w-3\" />\n                                {supplier.phone}\n                              </div>\n                            )}\n                            {!supplier.email && !supplier.phone && (\n                              <span className=\"text-muted-foreground\">-</span>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"secondary\" data-testid={`text-po-count-${supplier.id}`}>\n                            {supplier.poCount} PO{supplier.poCount !== 1 ? \"s\" : \"\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <span className=\"font-medium\" data-testid={`text-total-spent-${supplier.id}`}>\n                            {formatCurrency(supplier.totalSpent)}\n                          </span>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex items-center justify-end gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => openDetailsDialog(supplier)}\n                              data-testid={`button-view-supplier-${supplier.id}`}\n                            >\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => openEditDialog(supplier)}\n                              data-testid={`button-edit-supplier-${supplier.id}`}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => openDeleteDialog(supplier)}\n                              data-testid={`button-delete-supplier-${supplier.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Add New Supplier</DialogTitle>\n            <DialogDescription>\n              Enter the details of the new supplier\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"name\">Supplier Name *</Label>\n              <Input\n                id=\"name\"\n                value={formName}\n                onChange={(e) => setFormName(e.target.value)}\n                placeholder=\"Enter supplier name\"\n                data-testid=\"input-supplier-name\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"contactName\">Contact Person</Label>\n              <Input\n                id=\"contactName\"\n                value={formContactName}\n                onChange={(e) => setFormContactName(e.target.value)}\n                placeholder=\"Enter contact name\"\n                data-testid=\"input-contact-name\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={formEmail}\n                  onChange={(e) => setFormEmail(e.target.value)}\n                  placeholder=\"email@example.com\"\n                  data-testid=\"input-supplier-email\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"phone\">Phone</Label>\n                <Input\n                  id=\"phone\"\n                  value={formPhone}\n                  onChange={(e) => setFormPhone(e.target.value)}\n                  placeholder=\"+353...\"\n                  data-testid=\"input-supplier-phone\"\n                />\n              </div>\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"address\">Address</Label>\n              <Textarea\n                id=\"address\"\n                value={formAddress}\n                onChange={(e) => setFormAddress(e.target.value)}\n                placeholder=\"Enter supplier address\"\n                rows={2}\n                data-testid=\"input-supplier-address\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"notes\">Notes</Label>\n              <Textarea\n                id=\"notes\"\n                value={formNotes}\n                onChange={(e) => setFormNotes(e.target.value)}\n                placeholder=\"Any additional notes...\"\n                rows={2}\n                data-testid=\"input-supplier-notes\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => { setShowAddDialog(false); resetForm(); }}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleAddSupplier}\n              disabled={createSupplierMutation.isPending}\n              data-testid=\"button-save-supplier\"\n            >\n              {createSupplierMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n              Add Supplier\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Edit Supplier</DialogTitle>\n            <DialogDescription>\n              Update the supplier details\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"edit-name\">Supplier Name *</Label>\n              <Input\n                id=\"edit-name\"\n                value={formName}\n                onChange={(e) => setFormName(e.target.value)}\n                placeholder=\"Enter supplier name\"\n                data-testid=\"input-edit-supplier-name\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"edit-contactName\">Contact Person</Label>\n              <Input\n                id=\"edit-contactName\"\n                value={formContactName}\n                onChange={(e) => setFormContactName(e.target.value)}\n                placeholder=\"Enter contact name\"\n                data-testid=\"input-edit-contact-name\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"edit-email\">Email</Label>\n                <Input\n                  id=\"edit-email\"\n                  type=\"email\"\n                  value={formEmail}\n                  onChange={(e) => setFormEmail(e.target.value)}\n                  placeholder=\"email@example.com\"\n                  data-testid=\"input-edit-supplier-email\"\n                />\n              </div>\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"edit-phone\">Phone</Label>\n                <Input\n                  id=\"edit-phone\"\n                  value={formPhone}\n                  onChange={(e) => setFormPhone(e.target.value)}\n                  placeholder=\"+353...\"\n                  data-testid=\"input-edit-supplier-phone\"\n                />\n              </div>\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"edit-address\">Address</Label>\n              <Textarea\n                id=\"edit-address\"\n                value={formAddress}\n                onChange={(e) => setFormAddress(e.target.value)}\n                placeholder=\"Enter supplier address\"\n                rows={2}\n                data-testid=\"input-edit-supplier-address\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"edit-notes\">Notes</Label>\n              <Textarea\n                id=\"edit-notes\"\n                value={formNotes}\n                onChange={(e) => setFormNotes(e.target.value)}\n                placeholder=\"Any additional notes...\"\n                rows={2}\n                data-testid=\"input-edit-supplier-notes\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => { setShowEditDialog(false); resetForm(); setSelectedSupplier(null); }}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleUpdateSupplier}\n              disabled={updateSupplierMutation.isPending}\n              data-testid=\"button-update-supplier\"\n            >\n              {updateSupplierMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n              Update Supplier\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showDetailsDialog} onOpenChange={setShowDetailsDialog}>\n        <DialogContent className=\"sm:max-w-[700px] max-h-[90vh]\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5\" />\n              {selectedSupplier?.name}\n            </DialogTitle>\n            <DialogDescription>\n              Supplier details and purchase order history\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedSupplier && (\n            <div className=\"space-y-6 overflow-y-auto max-h-[calc(90vh-180px)]\">\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div className=\"space-y-4\">\n                  <h4 className=\"font-medium\">Contact Information</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    {selectedSupplier.contactName && (\n                      <div className=\"flex items-center gap-2\">\n                        <User className=\"h-4 w-4 text-muted-foreground\" />\n                        {selectedSupplier.contactName}\n                      </div>\n                    )}\n                    {selectedSupplier.email && (\n                      <div className=\"flex items-center gap-2\">\n                        <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                        <a href={`mailto:${selectedSupplier.email}`} className=\"text-primary hover:underline\">\n                          {selectedSupplier.email}\n                        </a>\n                      </div>\n                    )}\n                    {selectedSupplier.phone && (\n                      <div className=\"flex items-center gap-2\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <a href={`tel:${selectedSupplier.phone}`} className=\"text-primary hover:underline\">\n                          {selectedSupplier.phone}\n                        </a>\n                      </div>\n                    )}\n                    {selectedSupplier.address && (\n                      <div className=\"flex items-start gap-2\">\n                        <MapPin className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                        <span className=\"whitespace-pre-line\">{selectedSupplier.address}</span>\n                      </div>\n                    )}\n                    {!selectedSupplier.contactName && !selectedSupplier.email && !selectedSupplier.phone && !selectedSupplier.address && (\n                      <p className=\"text-muted-foreground\">No contact information provided</p>\n                    )}\n                  </div>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <h4 className=\"font-medium\">Statistics</h4>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"p-3 bg-muted/50 rounded-md\">\n                      <div className=\"text-2xl font-bold\" data-testid=\"text-detail-po-count\">\n                        {selectedSupplier.poCount}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">Purchase Orders</div>\n                    </div>\n                    <div className=\"p-3 bg-muted/50 rounded-md\">\n                      <div className=\"text-2xl font-bold\" data-testid=\"text-detail-total-spent\">\n                        {formatCurrency(selectedSupplier.totalSpent)}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">Total Spent</div>\n                    </div>\n                  </div>\n                  {selectedSupplier.notes && (\n                    <div>\n                      <h4 className=\"font-medium mb-2\">Notes</h4>\n                      <p className=\"text-sm text-muted-foreground whitespace-pre-line\">\n                        {selectedSupplier.notes}\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"space-y-3\">\n                <h4 className=\"font-medium flex items-center gap-2\">\n                  <FileText className=\"h-4 w-4\" />\n                  Purchase Order History\n                </h4>\n                \n                {posLoading ? (\n                  <div className=\"space-y-2\">\n                    {[1, 2, 3].map((i) => (\n                      <Skeleton key={i} className=\"h-12 w-full\" />\n                    ))}\n                  </div>\n                ) : !supplierPOs || supplierPOs.length === 0 ? (\n                  <div className=\"text-center py-8 bg-muted/30 rounded-lg\">\n                    <ShoppingCart className=\"h-10 w-10 mx-auto text-muted-foreground mb-2\" />\n                    <p className=\"text-muted-foreground\">No purchase orders yet</p>\n                    <Link href=\"/purchase-orders\">\n                      <Button variant=\"ghost\" className=\"mt-2 text-primary\">\n                        Create Purchase Order\n                      </Button>\n                    </Link>\n                  </div>\n                ) : (\n                  <div className=\"rounded-md border\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>PO Number</TableHead>\n                          <TableHead>Date</TableHead>\n                          <TableHead>Status</TableHead>\n                          <TableHead className=\"text-right\">Total</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {supplierPOs.map((po) => (\n                          <TableRow key={po.id} data-testid={`row-po-${po.id}`}>\n                            <TableCell className=\"font-medium\">\n                              <Link href=\"/purchase-orders\">\n                                <span className=\"text-primary hover:underline cursor-pointer\">\n                                  {po.poNumber}\n                                </span>\n                              </Link>\n                            </TableCell>\n                            <TableCell>{formatDate(po.orderDate)}</TableCell>\n                            <TableCell>{getStatusBadge(po.status)}</TableCell>\n                            <TableCell className=\"text-right font-medium\">\n                              {formatCurrency(po.grandTotal)}\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowDetailsDialog(false)}>\n              Close\n            </Button>\n            <Button onClick={() => { setShowDetailsDialog(false); openEditDialog(selectedSupplier!); }}>\n              <Edit className=\"h-4 w-4 mr-2\" />\n              Edit Supplier\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Deactivate Supplier</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to deactivate \"{selectedSupplier?.name}\"? \n              This supplier will no longer appear in lists, but their purchase order history will be preserved.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => selectedSupplier && deleteSupplierMutation.mutate(selectedSupplier.id)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteSupplierMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n              Deactivate\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </main>\n  );\n}\n","path":null,"size_bytes":36760,"size_tokens":null},"client/src/pages/auth-page.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Loader2, BarChart3, Package, TrendingUp, ShieldCheck } from \"lucide-react\";\n\nexport default function AuthPage() {\n  const { user, loginMutation, registerMutation } = useAuth();\n  const [, setLocation] = useLocation();\n  const [loginUsername, setLoginUsername] = useState(\"\");\n  const [loginPassword, setLoginPassword] = useState(\"\");\n  const [registerUsername, setRegisterUsername] = useState(\"\");\n  const [registerPassword, setRegisterPassword] = useState(\"\");\n  const [registerConfirmPassword, setRegisterConfirmPassword] = useState(\"\");\n\n  if (user) {\n    setLocation(\"/\");\n    return null;\n  }\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate({ username: loginUsername, password: loginPassword });\n  };\n\n  const handleRegister = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (registerPassword !== registerConfirmPassword) {\n      return;\n    }\n    registerMutation.mutate({ username: registerUsername, password: registerPassword });\n  };\n\n  return (\n    <div className=\"min-h-screen flex\">\n      <div className=\"flex-1 flex items-center justify-center p-8\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-2xl font-bold\">WooCommerce Reports</CardTitle>\n            <CardDescription>Sign in to access your dashboard</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Tabs defaultValue=\"login\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"login\" data-testid=\"tab-login\">Login</TabsTrigger>\n                <TabsTrigger value=\"register\" data-testid=\"tab-register\">Register</TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"login\">\n                <form onSubmit={handleLogin} className=\"space-y-4 mt-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"login-username\">Username</Label>\n                    <Input\n                      id=\"login-username\"\n                      type=\"text\"\n                      value={loginUsername}\n                      onChange={(e) => setLoginUsername(e.target.value)}\n                      placeholder=\"Enter your username\"\n                      required\n                      data-testid=\"input-login-username\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"login-password\">Password</Label>\n                    <Input\n                      id=\"login-password\"\n                      type=\"password\"\n                      value={loginPassword}\n                      onChange={(e) => setLoginPassword(e.target.value)}\n                      placeholder=\"Enter your password\"\n                      required\n                      data-testid=\"input-login-password\"\n                    />\n                  </div>\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full\" \n                    disabled={loginMutation.isPending}\n                    data-testid=\"button-login\"\n                  >\n                    {loginMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Signing in...\n                      </>\n                    ) : (\n                      \"Sign In\"\n                    )}\n                  </Button>\n                </form>\n              </TabsContent>\n              \n              <TabsContent value=\"register\">\n                <form onSubmit={handleRegister} className=\"space-y-4 mt-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-username\">Username</Label>\n                    <Input\n                      id=\"register-username\"\n                      type=\"text\"\n                      value={registerUsername}\n                      onChange={(e) => setRegisterUsername(e.target.value)}\n                      placeholder=\"Choose a username\"\n                      required\n                      data-testid=\"input-register-username\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-password\">Password</Label>\n                    <Input\n                      id=\"register-password\"\n                      type=\"password\"\n                      value={registerPassword}\n                      onChange={(e) => setRegisterPassword(e.target.value)}\n                      placeholder=\"Choose a password (min 6 characters)\"\n                      required\n                      minLength={6}\n                      data-testid=\"input-register-password\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"register-confirm-password\">Confirm Password</Label>\n                    <Input\n                      id=\"register-confirm-password\"\n                      type=\"password\"\n                      value={registerConfirmPassword}\n                      onChange={(e) => setRegisterConfirmPassword(e.target.value)}\n                      placeholder=\"Confirm your password\"\n                      required\n                      data-testid=\"input-register-confirm-password\"\n                    />\n                    {registerPassword !== registerConfirmPassword && registerConfirmPassword && (\n                      <p className=\"text-sm text-destructive\">Passwords do not match</p>\n                    )}\n                  </div>\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full\" \n                    disabled={registerMutation.isPending || registerPassword !== registerConfirmPassword}\n                    data-testid=\"button-register\"\n                  >\n                    {registerMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Creating account...\n                      </>\n                    ) : (\n                      \"Create Account\"\n                    )}\n                  </Button>\n                </form>\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"hidden lg:flex flex-1 bg-primary text-primary-foreground p-12 flex-col justify-center\">\n        <div className=\"max-w-md\">\n          <h1 className=\"text-4xl font-bold mb-6\">\n            WooCommerce Order Reports Dashboard\n          </h1>\n          <p className=\"text-lg mb-8 opacity-90\">\n            Comprehensive analytics and reporting for your WooCommerce store. \n            Track orders, manage inventory, and make data-driven decisions.\n          </p>\n          \n          <div className=\"space-y-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"p-2 bg-primary-foreground/10 rounded-lg\">\n                <BarChart3 className=\"h-6 w-6\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold mb-1\">Real-time Analytics</h3>\n                <p className=\"text-sm opacity-80\">\n                  Monitor revenue, orders, and trends with interactive charts\n                </p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-start gap-4\">\n              <div className=\"p-2 bg-primary-foreground/10 rounded-lg\">\n                <Package className=\"h-6 w-6\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold mb-1\">Inventory Management</h3>\n                <p className=\"text-sm opacity-80\">\n                  Track raw materials and manage purchase orders efficiently\n                </p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-start gap-4\">\n              <div className=\"p-2 bg-primary-foreground/10 rounded-lg\">\n                <TrendingUp className=\"h-6 w-6\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold mb-1\">Order Fulfillment</h3>\n                <p className=\"text-sm opacity-80\">\n                  See which orders can be fulfilled with current stock\n                </p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-start gap-4\">\n              <div className=\"p-2 bg-primary-foreground/10 rounded-lg\">\n                <ShieldCheck className=\"h-6 w-6\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold mb-1\">Secure Access</h3>\n                <p className=\"text-sm opacity-80\">\n                  Your store data is protected with secure authentication\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9351,"size_tokens":null},"client/src/pages/customers.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Search,\n  Loader2,\n  Users,\n  Mail,\n  Phone,\n  MapPin,\n  Euro,\n  ShoppingCart,\n  User,\n  Calendar,\n  ArrowUpDown,\n  Eye,\n  Building2\n} from \"lucide-react\";\nimport { useState, useMemo } from \"react\";\nimport { format } from \"date-fns\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface Customer {\n  id: number;\n  email: string;\n  first_name: string;\n  last_name: string;\n  username: string;\n  billing: {\n    first_name: string;\n    last_name: string;\n    company: string;\n    address_1: string;\n    address_2: string;\n    city: string;\n    state: string;\n    postcode: string;\n    country: string;\n    email: string;\n    phone: string;\n  };\n  shipping: {\n    first_name: string;\n    last_name: string;\n    company: string;\n    address_1: string;\n    address_2: string;\n    city: string;\n    state: string;\n    postcode: string;\n    country: string;\n  };\n  is_paying_customer: boolean;\n  avatar_url: string;\n  date_created: string;\n  date_modified: string;\n  orders_count?: number;\n  total_spent?: string;\n}\n\ninterface CustomerOrder {\n  id: number;\n  number: string;\n  status: string;\n  date_created: string;\n  total: string;\n  line_items: Array<{\n    name: string;\n    quantity: number;\n    total: string;\n  }>;\n}\n\ntype SortField = \"name\" | \"email\" | \"country\" | \"orders_count\" | \"total_spent\";\ntype SortDirection = \"asc\" | \"desc\";\n\nfunction getStatusColor(status: string): string {\n  const statusColors: Record<string, string> = {\n    pending: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\",\n    processing: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\",\n    \"on-hold\": \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\",\n    completed: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n    cancelled: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\",\n    refunded: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\",\n    failed: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\",\n  };\n  return statusColors[status] || \"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200\";\n}\n\nfunction formatAddress(address: { address_1: string; address_2: string; city: string; state: string; postcode: string; country: string }): string {\n  const parts = [\n    address.address_1,\n    address.address_2,\n    address.city,\n    address.state,\n    address.postcode,\n    address.country\n  ].filter(Boolean);\n  return parts.join(\", \");\n}\n\nexport default function Customers() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [showDetailsDialog, setShowDetailsDialog] = useState(false);\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n  const [sortField, setSortField] = useState<SortField>(\"name\");\n  const [sortDirection, setSortDirection] = useState<SortDirection>(\"asc\");\n\n  const { data: customers, isLoading, error } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: customerOrders, isLoading: ordersLoading } = useQuery<CustomerOrder[]>({\n    queryKey: [\"/api/customers\", selectedCustomer?.id, \"orders\"],\n    queryFn: async () => {\n      if (!selectedCustomer?.id) return [];\n      const response = await fetch(`/api/customers/${selectedCustomer.id}/orders`);\n      if (!response.ok) throw new Error(\"Failed to fetch customer orders\");\n      return response.json();\n    },\n    enabled: !!selectedCustomer?.id && showDetailsDialog,\n  });\n\n  const handleSort = (field: SortField) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortDirection(\"asc\");\n    }\n  };\n\n  const filteredAndSortedCustomers = useMemo(() => {\n    if (!customers) return [];\n\n    let result = customers;\n\n    if (searchTerm) {\n      const term = searchTerm.toLowerCase();\n      result = result.filter(c => \n        c.first_name?.toLowerCase().includes(term) ||\n        c.last_name?.toLowerCase().includes(term) ||\n        c.email?.toLowerCase().includes(term) ||\n        c.billing?.company?.toLowerCase().includes(term) ||\n        c.billing?.city?.toLowerCase().includes(term) ||\n        c.billing?.country?.toLowerCase().includes(term)\n      );\n    }\n\n    result = [...result].sort((a, b) => {\n      let comparison = 0;\n      if (sortField === \"name\") {\n        const nameA = `${a.first_name} ${a.last_name}`.toLowerCase();\n        const nameB = `${b.first_name} ${b.last_name}`.toLowerCase();\n        comparison = nameA.localeCompare(nameB);\n      } else if (sortField === \"email\") {\n        comparison = (a.email || \"\").localeCompare(b.email || \"\");\n      } else if (sortField === \"country\") {\n        comparison = (a.billing?.country || \"\").localeCompare(b.billing?.country || \"\");\n      } else if (sortField === \"orders_count\") {\n        comparison = (a.orders_count || 0) - (b.orders_count || 0);\n      } else if (sortField === \"total_spent\") {\n        comparison = parseFloat(a.total_spent || \"0\") - parseFloat(b.total_spent || \"0\");\n      }\n      return sortDirection === \"asc\" ? comparison : -comparison;\n    });\n\n    return result;\n  }, [customers, searchTerm, sortField, sortDirection]);\n\n  const handleViewDetails = (customer: Customer) => {\n    setSelectedCustomer(customer);\n    setShowDetailsDialog(true);\n  };\n\n  if (error) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <p className=\"text-destructive\">\n              Error loading customers: {(error as Error).message}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold flex items-center gap-2\" data-testid=\"text-page-title\">\n            <Users className=\"h-6 w-6\" />\n            Customers\n          </h1>\n          <p className=\"text-muted-foreground text-sm mt-1\">\n            View and manage customer information\n          </p>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-4\">\n          <div>\n            <CardTitle className=\"text-lg\">Customer List</CardTitle>\n            <CardDescription>\n              {isLoading ? \"Loading...\" : `${filteredAndSortedCustomers.length} customers`}\n            </CardDescription>\n          </div>\n          <div className=\"relative w-64\">\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search customers...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-9\"\n              data-testid=\"input-customer-search\"\n            />\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-2\">\n              {Array.from({ length: 5 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : (\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 px-2 font-medium\"\n                        onClick={() => handleSort(\"name\")}\n                        data-testid=\"button-sort-name\"\n                      >\n                        Name\n                        <ArrowUpDown className=\"ml-1 h-3 w-3\" />\n                      </Button>\n                    </TableHead>\n                    <TableHead>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 px-2 font-medium\"\n                        onClick={() => handleSort(\"email\")}\n                        data-testid=\"button-sort-email\"\n                      >\n                        Email\n                        <ArrowUpDown className=\"ml-1 h-3 w-3\" />\n                      </Button>\n                    </TableHead>\n                    <TableHead>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 px-2 font-medium\"\n                        onClick={() => handleSort(\"country\")}\n                        data-testid=\"button-sort-country\"\n                      >\n                        Country\n                        <ArrowUpDown className=\"ml-1 h-3 w-3\" />\n                      </Button>\n                    </TableHead>\n                    <TableHead className=\"text-right\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 px-2 font-medium\"\n                        onClick={() => handleSort(\"orders_count\")}\n                        data-testid=\"button-sort-orders\"\n                      >\n                        Orders\n                        <ArrowUpDown className=\"ml-1 h-3 w-3\" />\n                      </Button>\n                    </TableHead>\n                    <TableHead className=\"text-right\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 px-2 font-medium\"\n                        onClick={() => handleSort(\"total_spent\")}\n                        data-testid=\"button-sort-spent\"\n                      >\n                        Total Spent\n                        <ArrowUpDown className=\"ml-1 h-3 w-3\" />\n                      </Button>\n                    </TableHead>\n                    <TableHead className=\"w-16\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredAndSortedCustomers.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={6} className=\"text-center py-8 text-muted-foreground\">\n                        {searchTerm ? \"No customers match your search\" : \"No customers found\"}\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    filteredAndSortedCustomers.map((customer) => (\n                      <TableRow \n                        key={customer.id}\n                        className=\"hover-elevate cursor-pointer\"\n                        onClick={() => handleViewDetails(customer)}\n                        data-testid={`row-customer-${customer.id}`}\n                      >\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"h-8 w-8 rounded-full bg-muted flex items-center justify-center\">\n                              <User className=\"h-4 w-4 text-muted-foreground\" />\n                            </div>\n                            <div>\n                              <div className=\"font-medium\" data-testid={`text-customer-name-${customer.id}`}>\n                                {customer.first_name} {customer.last_name}\n                              </div>\n                              {customer.billing?.company && (\n                                <div className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                                  <Building2 className=\"h-3 w-3\" />\n                                  {customer.billing.company}\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <span className=\"text-muted-foreground\" data-testid={`text-customer-email-${customer.id}`}>\n                            {customer.email}\n                          </span>\n                        </TableCell>\n                        <TableCell>\n                          <span data-testid={`text-customer-country-${customer.id}`}>\n                            {customer.billing?.country || \"-\"}\n                          </span>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <Badge variant=\"secondary\" data-testid={`badge-customer-orders-${customer.id}`}>\n                            {customer.orders_count || 0}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right font-medium\" data-testid={`text-customer-spent-${customer.id}`}>\n                          {parseFloat(customer.total_spent || \"0\").toFixed(2)}\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleViewDetails(customer);\n                            }}\n                            data-testid={`button-view-customer-${customer.id}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={showDetailsDialog} onOpenChange={setShowDetailsDialog}>\n        <DialogContent className=\"max-w-3xl max-h-[85vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <User className=\"h-5 w-5\" />\n              Customer Details\n            </DialogTitle>\n            <DialogDescription>\n              Full information for {selectedCustomer?.first_name} {selectedCustomer?.last_name}\n            </DialogDescription>\n          </DialogHeader>\n\n          {selectedCustomer && (\n            <div className=\"space-y-6 mt-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium\">Contact Information</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"h-4 w-4 text-muted-foreground\" />\n                      <span data-testid=\"text-detail-customer-name\">\n                        {selectedCustomer.first_name} {selectedCustomer.last_name}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                      <a \n                        href={`mailto:${selectedCustomer.email}`}\n                        className=\"text-primary hover:underline\"\n                        data-testid=\"link-detail-customer-email\"\n                      >\n                        {selectedCustomer.email}\n                      </a>\n                    </div>\n                    {selectedCustomer.billing?.phone && (\n                      <div className=\"flex items-center gap-2\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <a \n                          href={`tel:${selectedCustomer.billing.phone}`}\n                          className=\"text-primary hover:underline\"\n                          data-testid=\"link-detail-customer-phone\"\n                        >\n                          {selectedCustomer.billing.phone}\n                        </a>\n                      </div>\n                    )}\n                    {selectedCustomer.billing?.company && (\n                      <div className=\"flex items-center gap-2\">\n                        <Building2 className=\"h-4 w-4 text-muted-foreground\" />\n                        <span data-testid=\"text-detail-customer-company\">\n                          {selectedCustomer.billing.company}\n                        </span>\n                      </div>\n                    )}\n                    <div className=\"flex items-center gap-2\">\n                      <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"text-sm text-muted-foreground\" data-testid=\"text-detail-customer-since\">\n                        Customer since {format(new Date(selectedCustomer.date_created), \"MMM d, yyyy\")}\n                      </span>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium\">Order Summary</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <ShoppingCart className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-sm\">Total Orders</span>\n                      </div>\n                      <Badge variant=\"secondary\" data-testid=\"badge-detail-orders-count\">\n                        {selectedCustomer.orders_count || 0}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Euro className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-sm\">Total Spent</span>\n                      </div>\n                      <span className=\"font-semibold\" data-testid=\"text-detail-total-spent\">\n                        {parseFloat(selectedCustomer.total_spent || \"0\").toFixed(2)}\n                      </span>\n                    </div>\n                    {(selectedCustomer.orders_count ?? 0) > 0 && (\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-sm text-muted-foreground\">Average Order Value</span>\n                        <span className=\"font-medium\" data-testid=\"text-detail-aov\">\n                          {(parseFloat(selectedCustomer.total_spent || \"0\") / (selectedCustomer.orders_count ?? 1)).toFixed(2)}\n                        </span>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                      <MapPin className=\"h-4 w-4\" />\n                      Billing Address\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-sm text-muted-foreground\" data-testid=\"text-detail-billing-address\">\n                      {formatAddress(selectedCustomer.billing) || \"No billing address\"}\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                      <MapPin className=\"h-4 w-4\" />\n                      Shipping Address\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-sm text-muted-foreground\" data-testid=\"text-detail-shipping-address\">\n                      {formatAddress(selectedCustomer.shipping) || \"No shipping address\"}\n                    </p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                    <ShoppingCart className=\"h-4 w-4\" />\n                    Recent Orders\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {ordersLoading ? (\n                    <div className=\"flex items-center justify-center py-4\">\n                      <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : customerOrders && customerOrders.length > 0 ? (\n                    <div className=\"rounded-md border\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow>\n                            <TableHead>Order</TableHead>\n                            <TableHead>Date</TableHead>\n                            <TableHead>Status</TableHead>\n                            <TableHead className=\"text-right\">Total</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {customerOrders.slice(0, 10).map((order) => (\n                            <TableRow key={order.id} data-testid={`row-order-${order.id}`}>\n                              <TableCell className=\"font-medium\" data-testid={`text-order-number-${order.id}`}>\n                                #{order.number}\n                              </TableCell>\n                              <TableCell data-testid={`text-order-date-${order.id}`}>\n                                {format(new Date(order.date_created), \"MMM d, yyyy\")}\n                              </TableCell>\n                              <TableCell>\n                                <Badge \n                                  className={`${getStatusColor(order.status)} border-0`}\n                                  data-testid={`badge-order-status-${order.id}`}\n                                >\n                                  {order.status.replace(/-/g, \" \")}\n                                </Badge>\n                              </TableCell>\n                              <TableCell className=\"text-right font-medium\" data-testid={`text-order-total-${order.id}`}>\n                                {parseFloat(order.total).toFixed(2)}\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground text-center py-4\">\n                      No orders found for this customer\n                    </p>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":23600,"size_tokens":null}},"version":2}